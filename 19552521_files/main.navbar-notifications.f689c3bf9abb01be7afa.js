(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{1349:function(t,e,n){},1831:function(t,e,n){"use strict";var i=n(2),o=n.n(i),a=n(21),c=function(t){return o.a.createElement(a.a,t,o.a.createElement("path",{d:"M8.493 10h12.014c.83 0 1.493.672 1.493 1.5 0 .834-.668 1.5-1.493 1.5H8.493C7.663 13 7 12.328 7 11.5c0-.834.668-1.5 1.493-1.5zm0 6h12.014c.83 0 1.493.672 1.493 1.5 0 .834-.668 1.5-1.493 1.5H8.493C7.663 19 7 18.328 7 17.5c0-.834.668-1.5 1.493-1.5zM3.5 4C4.334 4 5 4.672 5 5.5 5 6.334 4.328 7 3.5 7 2.666 7 2 6.328 2 5.5 2 4.666 2.672 4 3.5 4zm0 6c.834 0 1.5.672 1.5 1.5 0 .834-.672 1.5-1.5 1.5-.834 0-1.5-.672-1.5-1.5 0-.834.672-1.5 1.5-1.5zm0 6c.834 0 1.5.672 1.5 1.5 0 .834-.672 1.5-1.5 1.5-.834 0-1.5-.672-1.5-1.5 0-.834.672-1.5 1.5-1.5zM8.493 4h12.014C21.337 4 22 4.672 22 5.5c0 .834-.668 1.5-1.493 1.5H8.493C7.663 7 7 6.328 7 5.5 7 4.666 7.668 4 8.493 4z",fillRule:"evenodd"}))};c.defaultProps={name:"List"},e.a=c},2698:function(t,e,n){"use strict";n.r(e);var i=n(0),o=n(13),a=n(14),c=n(67),s=n(15),r=n(17),l=n(9),u=n(32),f=n(1),h=n(2),b=n(29),d=n(24),m=n(11),p=n.n(m),O=n(30),j=n(1831),v=n(2586),N=n(2587),C=n(832),w=n(31),P=n(87),k=n(74),g=n(398),T=n(188),y=n(298),L=n(1392),R=n(861),M=n(104),S=n(379),z=n(146),I=n(37),_=n(853);function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(l.a)(t);if(e){var o=Object(l.a)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(r.a)(this,n)}}var B=function(t){Object(s.a)(n,t);var e=D(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var t=this.props.item,e=t.target,n=t.isRead,i=t.content;if(e){var o=e.urlToken,a=e.isOrg;return Object(f.b)(I.Link,{to:"//www.zhihu.com/".concat(a?"org":"people","/").concat(o),className:p()("PushNotifications-item PushNotifications-followItem",{"PushNotifications-newItem":!n}),target:"_blank",children:Object(f.b)(_.a,{author:e,avatarSize:40,noLink:!0,userLinkV2:!0})})}var c=i&&i.actors&&i.actors[0];if(c){var s=c.link,r=c.name;return Object(f.b)(I.Link,{to:s,className:p()("PushNotifications-item PushNotifications-followItem",{"PushNotifications-newItem":!n}),target:"_blank",children:r})}return null}}]),n}(h.Component),E=(n(1349),function(){return Promise.all([n.e(0),n.e(39)]).then(n.bind(null,2647))}),F=function(t){return Object(f.b)(z.a,Object.assign({getComponent:E},t))},x=function(t,e){t.forEach((function(t){var n=t.intersectionRatio,i=t.target;n>=1&&(O.a.trackCardShow(i,{id:5108}),e.unobserve(i))}))},H=function(t){var e=t.isLoading,n=t.isDrained,i=t.items,o=t.currentTab,a=t.onRef,c=t.onLoad,s=t.onCommentsModalOpen,r=!("default"===o||"vote_thank"===o),l=Object(h.useRef)(),u=Object(h.useRef)(),b=Object(h.useCallback)((function(t){a(t),l.current=t}),[a]);Object(h.useEffect)((function(){var t=l.current;return t&&t.el&&(u.current=new IntersectionObserver(x,{root:t.el,threshold:1})),function(){u.current.disconnect()}}),[]);var d=Object(h.useCallback)((function(t){return u.current&&u.current.observe(t),function(){u.current&&u.current.unobserve(t)}}),[]);return Object(f.c)(S.b,{id:"PushNotifications-".concat(o),ref:b,className:p()("PushNotifications-list",{"PushNotifications-followList":r}),isLocal:!0,isLoading:e,isDrained:n,stopPropagation:!0,onLoad:c,getContainer:function(t){return t},threshold:100,placeholder:Object(f.b)(S.a,{className:"PushNotifications-item",small:!0}),children:[i.length>0&&r&&Object(f.b)("div",{className:"PushNotifications-followTitle",children:"这些人最近关注了你"}),i.map((function(t){return r?Object(f.b)(B,{item:t},t.id):Object(f.b)(F,{item:t,onCommentsModalOpen:s,addObserve:d},t.id)}))]})},A=["ids"];function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Object(l.a)(t);if(e){var o=Object(l.a)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(r.a)(this,n)}}var U={ids:[],isFetching:!1,isDrained:!1},V=Object(b.createSelector)((function(t){return t.pushNotifications[t.pushNotifications.currentTab]||U}),(function(t){return t.entities.notifications}),(function(t,e){var n=t.ids,i=Object(u.default)(t,A);return Object.assign(Object.assign({},i),{},{items:n.map((function(t){return e[t]}))})}));var q=function(t){Object(s.a)(n,t);var e=J(n);function n(t){var i;Object(o.a)(this,n),(i=e.call(this,t)).state={commentModalShown:!1},i.handleCommentModalClose=function(){i.setState({commentModalShown:!1})},i.handleCommentModalOpen=function(t){i.setState(Object.assign(Object.assign({},t),{},{commentModalShown:!0})),i.menu&&i.menu.popover&&i.menu.popover.close()};var a=t.dispatch;return i.open=i.open.bind(Object(c.a)(i)),i.close=i.close.bind(Object(c.a)(i)),i.handleSwitchTab=i.handleSwitchTab.bind(Object(c.a)(i)),i.loadNotificationList=i.loadNotificationList.bind(Object(c.a)(i)),i.handleMarkReadAll=function(){a(Object(y.d)())},i}return Object(a.a)(n,[{key:"componentDidUpdate",value:function(t){var e=this,n=this.props,i=n.currentTab,o=n.notificationsCount,a=n.items,c=o[i],s=t.currentTab;i===s||a.length&&!c?i!==s&&a.length&&setTimeout((function(){e.loader&&(e.loader.el.scrollTop=e.state["".concat(i,"-scrollTop")])}),17):this.loadNotificationList()}},{key:"open",value:function(){var t=this.props,e=t.currentTab,n=t.notificationsCount[e];O.a.trackEvent(this,{id:2762,action:"Click"}),n?this.loadNotificationList():this.loader&&(this.loader.el.scrollTop=this.state["".concat(e,"-scrollTop")])}},{key:"close",value:function(){if(this.loader){var t=this.props.currentTab,e="".concat(t,"-scrollTop");this.setState(Object(i.a)({},e,this.loader.el.scrollTop))}}},{key:"handleSwitchTab",value:function(t){var e=this.props,n=e.dispatch,o=e.currentTab;if(this.loader){var a="".concat(o,"-scrollTop");this.setState(Object(i.a)({},a,this.loader.el.scrollTop))}n(Object(y.e)(t))}},{key:"loadNotificationList",value:function(t){var e=this.props,n=e.dispatch,i=e.currentTab,o=e.notificationsCount[i],a=!t&&Boolean(o);n(Object(y.c)(a)),a&&this.handleMarkReadAll()}},{key:"renderCommentModal",value:function(){var t=this.state,e=t.type,n=t.target,i=t.byComment,o=t.href,a=t.commentModalShown,c=t.notificationId;return Object(f.b)(k.b,{size:"fullPage",onClose:this.handleCommentModalClose,children:a&&Object(f.b)(L.a,{type:e,parent:n,byComment:i,notificationId:c,shouldReverse:!1,targetLink:Object(f.c)("span",{className:"Comments-titleLink",children:["（",Object(f.c)("a",{href:o,children:["前往",g.b[e]]}),"）"]})})})}},{key:"render",value:function(){var t=this,e=this.props,n=e.preset,i=e.isFetching,o=e.isDrained,a=e.items,c=e.currentTab,s=e.className,r=e.IconButton,l=e.notificationsCount,u=Object.keys(l).reduce((function(t,e){return t+l[e]}),0),h=!("default"===c||"vote_thank"===c),b=o&&!a.length>0?Object(f.b)("div",{className:p()("PushNotifications-list",{"PushNotifications-followList":h}),children:Object(f.c)(R.k,{children:[Object(f.b)(R.i,{}),Object(f.b)("div",{children:"还没有消息"})]})}):Object(f.b)(H,{onRef:function(e){t.loader=e},isLoading:i,isDrained:o,items:a,currentTab:c,onLoad:function(){return t.loadNotificationList(!0)},onCommentsModalOpen:this.handleCommentModalOpen}),d={};return"new"===n&&(d={boundary:{padding:16},arrowed:!1}),Object(f.c)(f.a,{children:[this.renderCommentModal(),Object(f.b)(P.c,Object.assign(Object.assign({preventCloseOnTarget:!0,ref:function(e){t.menu=e},positionStatus:"fixed",onOpen:this.open,onClose:this.close,menuClassName:"PushNotifications-menu",menuContainerClassName:p()("PushNotifications-menuContainer","PushNotifications-menuContainer--".concat(n)),toggler:Object(f.b)(r,{className:s,count:u,"aria-label":u?"".concat(u,"条通知"):"通知"})},d),{},{children:Object(f.c)("div",{className:"PushNotifications-content",children:[Object(f.c)("div",{className:"PushNotifications-header",role:"tablist",children:[Object(f.c)(w.c,{preset:"plain",role:"tab","aria-controls":"PushNotifications-default",className:"PushNotifications-tab",onClick:function(){return t.handleSwitchTab("default")},"aria-label":"消息",children:[Object(f.b)(j.a,{center:!0,size:22,className:p()("PushNotifications-tabIcon",{"PushNotifications-selectedTabIcon":"default"===c})}),l.default>0&&Object(f.b)("span",{className:"PushNotifications-redbot"})]}),Object(f.c)(w.c,{preset:"plain",role:"tab","aria-controls":"PushNotifications-follow",className:"PushNotifications-tab",onClick:function(){return t.handleSwitchTab("follow")},"aria-label":"用户",children:[Object(f.b)(v.a,{center:!0,size:22,className:p()("PushNotifications-tabIcon",{"PushNotifications-selectedTabIcon":"follow"===c})}),l.follow>0&&Object(f.b)("span",{className:"PushNotifications-redbot"})]}),Object(f.b)(w.c,{preset:"plain",role:"tab","aria-controls":"PushNotifications-vote_thank",className:"PushNotifications-tab",onClick:function(){return t.handleSwitchTab("vote_thank")},"aria-label":"赞同和喜欢",children:Object(f.c)("div",{children:[Object(f.b)(N.a,{center:!0,size:22,className:p()("PushNotifications-tabIcon",{"PushNotifications-selectedTabIcon":"vote_thank"===c})}),l.vote_thank>0&&Object(f.b)("span",{className:"PushNotifications-redbot"})]})})]}),b,Object(f.c)("div",{className:"Notifications-footer",children:[Object(f.c)(M.a,{preset:"plain",a:!0,to:"//www.zhihu.com/settings/notification",children:[Object(f.b)(C.a,{className:"Button-icon",style:{marginRight:5},size:16,center:!0}),"设置"]}),Object(f.b)(M.a,{preset:"plain",a:!0,to:"//www.zhihu.com/notifications",children:"查看全部通知"})]})]})}))]})}}]),n}(h.PureComponent);e.default=Object(d.connect)((function(t){var e=t.pushNotifications,n=e.currentTab,i=e.notificationsCount,o=V(t);return{currentTab:n,notificationsCount:i,items:o.items,isFetching:o.isFetching,isDrained:o.isDrained,preset:"2"===Object(T.a)(t,"web_pcleft")?"new":"old"}}))(q)}}]);
//# sourceMappingURL=main.navbar-notifications.f689c3bf9abb01be7afa.js.map