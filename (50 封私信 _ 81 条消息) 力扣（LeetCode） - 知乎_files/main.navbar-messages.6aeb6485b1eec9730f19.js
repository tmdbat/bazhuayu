(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{2699:function(e,t,s){"use strict";s.r(t);var a=s(0),n=s(13),c=s(14),r=s(67),o=s(15),i=s(17),l=s(9),u=s(32),d=s(1),h=s(2),b=s(18),p=s(24),g=s(29),f=s(11),m=s.n(f),M=s(37),O=s(30),v=s(31),j=s(2592),C=s(379),k=s(87),w=s(188),T=s(1135),y=s(38),N=s(861),S=s(1096),I=s(380),R=s(1059),L=s(991);function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,a=Object(l.a)(e);if(t){var n=Object(l.a)(this).constructor;s=Reflect.construct(a,arguments,n)}else s=a.apply(this,arguments);return Object(i.a)(this,s)}}var B=function(e){Object(o.a)(s,e);var t=P(s);function s(){var e;Object(n.a)(this,s);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).handleMessageClick=function(t){var s=e.props.onMessageClick;t.preventDefault(),s()},e}return Object(c.a)(s,[{key:"render",value:function(){var e=this.props.item,t=e.snippet,s=e.participant,a=e.unreadCount;return Object(d.c)("a",{href:"//www.zhihu.com/messages/".concat(s.id),className:m()("Messages-item Messages-followItem",{"Messages-newItem":a>0}),onClick:this.handleMessageClick,children:[Object(d.b)(R.a,{user:s,avatarProps:{size:40},noLink:!0,noHoverCard:!0}),Object(d.c)("div",{className:"Messages-user",children:[Object(d.b)("div",{className:"Messages-userName",children:Object(d.b)(L.a,{user:s,noLink:!0,noHoverCard:!0})}),Object(d.b)("div",{className:"Messages-itemContent",children:Object(S.stripHTML)(t)})]})]})}}]),s}(h.Component),D=Object(I.a)()(B),A=s(300),z=["ids"];function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,a=Object(l.a)(e);if(t){var n=Object(l.a)(this).constructor;s=Reflect.construct(a,arguments,n)}else s=a.apply(this,arguments);return Object(i.a)(this,s)}}var H={ids:[],isFetching:!1,isDrained:!1},x=Object(g.createSelector)((function(e){return e.messages.data[e.messages.currentTab]||H}),(function(e){return e.entities.messages}),(function(e,t){var s=e.ids,a=Object(u.default)(e,z);return Object.assign(Object.assign({},a),{},{items:s.map((function(e){return t[e]}))})}));var E=function(e){Object(o.a)(s,e);var t=F(s);function s(){var e;Object(n.a)(this,s);for(var c=arguments.length,o=new Array(c),i=0;i<c;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={isChatModalShow:!1},e.handleSwitchTab=function(t){var s=e.props,n=s.currentTab,c=s.setCurrentTab;if(e.loader){var r="".concat(n,"-scrollTop");e.setState(Object(a.a)({},r,e.loader.el.scrollTop))}c(t)},e.loadMessageList=function(t){var s=e.props,a=s.messageCount,n=s.loadMessages,c=s.markMessageRead,r=!t&&Boolean(a);n(r).then((function(){r&&c()}))},e.checkIsInMessagesPage=function(){return e.props.location.pathname.startsWith("/messages")},e.handleMessageClick=function(t){var s=e.props.router,a=t.participant.id;e.checkIsInMessagesPage()?s.replace("/messages/".concat(a)):e.setState({isChatModalShow:!0,curMessageSenderId:a}),e.menu.popover.close()},e.handleCloseChatModal=function(){e.setState({isChatModalShow:!1})},e.handleAddMessageClick=function(t){var s=e.props.router;O.a.trackEvent(t.target,{id:5310,action:"Click"}),e.checkIsInMessagesPage()?s.replace("".concat(location.pathname,"?tab=search")):location.href="//www.zhihu.com/messages?tab=search",e.menu.popover.close()},e.handleCheckAllMessageClick=function(){var t=e.props.router;e.checkIsInMessagesPage()?t.replace("/messages"):location.href="//www.zhihu.com/messages",e.menu.popover.close()},e.handleOpen=function(){var t=e.props,s=t.currentTab,a=t.messageCount;O.a.trackEvent(Object(r.a)(e),{id:2763,action:"Click"}),!e.props.items.length||a?e.loadMessageList():e.loader.el.scrollTop=e.state["".concat(s,"-scrollTop")]},e.handleClose=function(){if(e.loader){var t=e.props.currentTab,s="".concat(t,"-scrollTop");e.setState(Object(a.a)({},s,e.loader.el.scrollTop))}},e}return Object(c.a)(s,[{key:"componentDidUpdate",value:function(e){var t=this,s=this.props,a=s.currentTab,n=s.messageCount,c=s.items,r=e.currentTab;a===r||c.length&&!n?a!==r&&c.length&&setTimeout((function(){t.loader.el.scrollTop=t.state["".concat(a,"-scrollTop")]}),17):this.loadMessageList()}},{key:"render",value:function(){var e=this,t=this.props,s=t.preset,a=t.isFetching,n=t.isDrained,c=t.items,r=t.currentTab,o=t.className,i=t.IconButton,l=t.hasOpenStrangerMessage,u=t.messageCount,h=this.state,b=h.isChatModalShow,p=h.curMessageSenderId,g=n&&!c.length?Object(d.b)("div",{className:"Messages-list",children:Object(d.c)(N.k,{children:[Object(d.b)(N.h,{}),Object(d.b)("div",{children:"还没有私信"})]})}):Object(d.b)(C.b,{id:"Messages-".concat(r),className:"Messages-list",ref:function(t){e.loader=t},isLocal:!0,isLoading:a,isDrained:n,onLoad:function(){return e.loadMessageList(!0)},stopPropagation:!0,getContainer:function(e){return e},threshold:200,placeholder:Object(d.b)(C.a,{className:"Messages-item",small:!0}),children:c.map((function(t,s){return Object(d.b)(D,{item:t,onMessageClick:function(){e.handleMessageClick(t)}},s)}))}),f={};return"new"===s&&(f={boundary:{padding:16},arrowed:!1}),Object(d.c)("div",{children:[Object(d.b)(k.c,Object.assign(Object.assign({menuClassName:"Messages-menu",menuContainerClassName:m()("Messages-menuContainer","Messages-menuContainer--".concat(s)),preventCloseOnTarget:!0,positionStatus:"fixed",onOpen:this.handleOpen,onClose:this.handleClose,ref:function(t){e.menu=t},toggler:Object(d.b)(i,{className:o,count:u,"aria-label":u?"".concat(u,"条私信"):"私信"})},f),{},{children:Object(d.c)("div",{className:"Messages-content",children:[l?Object(d.c)("div",{className:"Messages-header",role:"tablist",children:[Object(d.b)(v.c,{preset:"plain",role:"tab","aria-controls":"Messages-common",className:m()("Messages-tab",{"Messages-currentTab":"common"===r}),onClick:function(){return e.handleSwitchTab("common")},children:"最近联系"}),Object(d.b)(v.c,{preset:"plain",role:"tab","aria-controls":"Messages-stranger",className:m()("Messages-tab",{"Messages-currentTab":"stranger"===r}),onClick:function(t){e.handleSwitchTab("stranger"),O.a.trackEvent(t.target,{id:5311,action:"Click"})},children:"陌生人私信"})]}):Object(d.b)("div",{className:"Messages-header",role:"tablist",children:Object(d.b)(v.c,{preset:"plain",className:"Messages-tab Messages-myMessageTab",children:"我的私信"})}),g,Object(d.c)("div",{className:"Messages-footer",children:[Object(d.c)(v.c,{preset:"plain",onClick:this.handleAddMessageClick,children:[Object(d.b)(j.a,{className:"Button-icon",style:{marginRight:4},size:16,center:!0}),"写新私信"]}),Object(d.b)(v.c,{preset:"plain",onClick:this.handleCheckAllMessageClick,children:"查看全部私信"})]})]})})),Object(d.b)(T.a,{memberHashId:p,handleCloseModal:this.handleCloseChatModal,isModalShow:b})]})}}]),s}(h.PureComponent);t.default=Object(b.compose)(M.withRouter,Object(p.connect)((function(e){var t=e.currentUser,s=e.messages,a=s.currentTab,n=s.messageCount,c=x(e),r=c.items,o=c.isDrained,i=c.isFetching,l=Object(y.b)(e).availableMessageTypes;return{currentUser:t,items:r,currentTab:a,messageCount:n,hasOpenStrangerMessage:(l&&l.length)>1,isFetching:i,isDrained:o,preset:"2"===Object(w.a)(e,"web_pcleft")?"new":"old"}}),{loadMessages:A.c,setCurrentTab:A.e,markMessageRead:A.d}))(E)}}]);
//# sourceMappingURL=main.navbar-messages.6aeb6485b1eec9730f19.js.map