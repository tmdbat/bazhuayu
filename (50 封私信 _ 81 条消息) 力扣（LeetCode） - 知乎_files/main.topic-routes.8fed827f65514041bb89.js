(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{1032:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(0),c=n(26),r=n(5),o=Object(r.a)("promotion",["LIKE"]);function i(t){return function(e,n){var r=n().entities.promotions[t]||{},i=r.voteupCount,l=r.voting,s=l?0:1;return e({API:{types:o.LIKE,endpoint:"v3/promotions/".concat(t,"/voters"),query:{voting:s},method:"POST"},UPDATE:{request:{promotions:Object(a.a)({},t,{voteupCount:i+(l?-1:1),voting:s})},success:function(e){return{promotions:Object(a.a)({},t,e)}},failure:{promotions:Object(a.a)({},t,r)}},NOTIFICATION:{failure:c.a}})}}},1033:function(t,e,n){"use strict";var a=n(42),c=n(1),r=n(2),o=n(853),i=function(t){return"plain"===t||"special-plain"===t},l=i;e.a=function(t,e,n){var s=Object(r.useMemo)((function(){var e=!function(t){return"special-plain"===t}(t)&&Object(c.b)(o.a,Object.assign(Object.assign({},l(t)&&{preset:"plain"}),{},{author:n,userLinkV2:!0}),"authorInfo");return i(t)?[e,null]:[[e,null],null]}),[t,n]),u=Object(a.a)(s,2);return[u[0],u[1]]}},1034:function(t,e,n){},1049:function(t,e,n){"use strict";n.d(e,"a",(function(){return Tt}));var a=n(13),c=n(14),r=n(15),o=n(17),i=n(9),l=n(1),s=n(3),u=n.n(s),d=n(18),p=n(2),b=n(24),h=n(11),f=n.n(h),m=n(123),v=n(30),O=n(2602),j=n(2645),g=n(2646),y=n(585),C=n(31),w=n(19),T=n.n(w),R=n(20),k=n.n(R),I=n(22),N=n.n(I),x=n(23),S=n.n(x),E=n(16),A=n.n(E),B=n(158),M=n(902),P=n(2580),z=n(831),L=n(329),U=n(84),D=n.n(U),W=n(143),V=n(6);function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=A()(t);if(e){var c=A()(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return S()(this,n)}}var F={top:10,left:20},q={top:0,left:0};function H(){var t,e=D()(navigator.userAgent).Mobile?q:F,n=e.top,a=e.left,c=window,r=c.innerWidth,o={left:0,top:0,width:r,height:c.innerHeight},i={x:(t=o).left+t.width/2,y:t.top+t.height/2},l=2*(96+a),s=r,u=0;return r<1e3+l?s=r-l:(s=1e3,u=(r-(1e3+l))/2),{x:i.x,y:i.y,imgContainerWidth:s,imgContainerHeight:o.height-2*n,left:u,top:n}}var G=function(t){N()(n,t);var e=_(n);function n(t){var a;return T()(this,n),(a=e.call(this,t)).getBoundingClientRect=function(t,e){var n=e.width,a=e.height,c={top:0,left:0,width:0,height:0},r=1;return t.width>t.height?(c.height=a,r=a/t.height,c.width=t.width*r,c.left="-".concat((c.width-n)/2)):t.width<t.height?(c.width=n,r=n/t.width,c.height=t.height*r,c.top="-".concat((c.height-a)/2)):(c.width=n,c.height=a),c},a.getParentNode=function(){for(var t,e=a.props.img.parentNode;e&&"BODY"!==e.nodeName;){if(e.classList.contains("Image-Wrapper-Preview"))return t=e;e=e.parentNode}return t},a.getChildImgNode=function(t){if(t){var e=t.childNodes,n=a.state.index,c=n;return{img:(n>=e.length?e[c=e.length-1]:e[c]).querySelector(".Image-Preview"),index:c}}},a.setImageElAttr=function(){var t=a.state,e=t.width,n=t.transition,c=a.props.images,r=a.getParentNode(),o=a.getChildImgNode(r);if(o&&o.img){var i=o.img.getBoundingClientRect(),l=a.getBoundingClientRect(c[o.index],{width:i.width,height:i.height}),s=a.imgEl.getBoundingClientRect(),u=a.containerClientRect,d=u.left,p=u.top,b={x:s.left+s.width/2-d-l.width/2,y:s.top+s.height/2-p-l.height/2},h=e/l.width;"transition"!==n?(a.setState({transition:""},(function(){a.setState({rect:i,transition:"",width:l.width,height:l.height,translate:b,scale:h,transform:"translate(".concat(b.x,"px ,").concat(b.y,"px) scale(").concat(h,")")})})),setTimeout((function(){a.setState({transition:"transition",translate:null,scale:null,transform:"translate(".concat(i.left-d,"px,").concat(i.top-p,"px)"),opacity:-1})}),20)):a.setState({translate:null,scale:null,opacity:-1,transform:"translate(".concat(i.left-d,"px,").concat(i.top-p,"px)")})}},a.getImageSize=function(t){var e=a.containerClientRect,n=e.imgContainerWidth,c=e.imgContainerHeight,r=t.width,o=t.height,i=!1,l=1;return(t.width>n||t.height>c)&&(t.width>n&&(l=n/t.width,r=t.width*l,o=l*t.height),o>c&&(o*=l=c/o,r*=l),i=!0),a.setState({cursorZoomIn:i}),{width:r,height:o}},a.handleResizeCallback=function(){a.containerClientRect=H();var t=a.state.index,e=a.props.images;a.setState(Object.assign({transition:"fixed",transform:""},a.getImageSize(e[t])))},a.handleClick=function(t){var e=a.state.cursorZoomIn,n=t.target;n&&n.classList&&n.classList.contains("ImageGallery-Img")&&e&&a.setState({previewImage:n}),(n.classList.contains("ImageGallery")||n.classList.contains("ImageGallery-Inner"))&&a.setImageElAttr()},a.handleTransEnd=function(){var t=a.state,e=t.translate,n=t.scale,c=a.props.onClose;e&&n||c()},a.handlePreviewImageClose=function(){a.setState({previewImage:null},(function(){L.hide()}))},a.handleKeyUpCallback=function(t){39===t.keyCode?a.handleCutImage(1):37===t.keyCode&&a.handleCutImage(-1)},a.handleCutImage=function(t){var e=a.state.index+t,n=a.props.images;e<n.length&&e>=0&&a.setState(Object.assign({index:e,transition:"fixed",transform:""},a.getImageSize(n[e])))},a.state={transEnded:!1,translate:null,scale:null,url:null,index:t.index||0,width:0,height:0,rect:null,transition:"transition",previewImage:null,transform:"",cursorZoomIn:!1,opacity:1},a.containerClientRect=H(),a}return k()(n,[{key:"componentWillMount",value:function(){var t=this.props,e=t.data,n=t.img.getBoundingClientRect();L.hide();var a=this.containerClientRect,c=a.left,r=a.top,o=this.getBoundingClientRect(e,{width:n.width,height:n.height}),i={left:n.left-c+Number(o.left),top:n.top-r+Number(o.top)};this.setState({rect:o,width:o.width,height:o.height,transform:"translate(".concat(i.left,"px, ").concat(i.top,"px)")})}},{key:"componentDidMount",value:function(){var t=this;setTimeout((function(){t.setState(Object.assign({},t.computeTransition(t.props.index)))}),20),window.addEventListener("keyup",this.handleKeyUpCallback),window.addEventListener("resize",this.handleResizeCallback)}},{key:"componentWillUnmount",value:function(){L.show(),window.removeEventListener("keyup",this.handleKeyUpCallback),window.removeEventListener("resize",this.handleResizeCallback)}},{key:"computeTransition",value:function(t){var e=this.props.images[t],n=this.containerClientRect,a=n.x,c=n.y,r=n.left,o=n.top,i=this.getImageSize(e).width;if(this.imgEl){var l=this.imgEl.getBoundingClientRect(),s=i/l.width,u={x:a-l.width/2-r,y:c-l.height/2-o};return{translate:u,scale:s,transform:"translate(".concat(u.x,"px ,").concat(u.y,"px) scale(").concat(s,")")}}}},{key:"render",value:function(){var t=this,e=this.props.images,n=this.state,a=n.translate,c=n.index,r=n.width,o=n.height,i=n.transition,l=n.previewImage,s=n.transform,u=n.cursorZoomIn,d=n.opacity,p=this.containerClientRect,b=p.left,h=p.top,m=p.imgContainerWidth,v=p.imgContainerHeight,O=(D()(navigator.userAgent).Mobile?q:F).left,j=e[c];return Object(V.g)(W.a,null,Object(V.g)("div",{className:f()("ImageGallery",{"is-active":a}),onClick:this.handleClick},Object(V.g)("div",{className:"ImageGallery-Content",style:{width:"".concat(m+2*(96+O),"px"),height:"".concat(v,"px"),left:"".concat(b,"px"),top:"".concat(h,"px")}},!l&&e.length>1&&Object(V.g)("a",{className:f()("ImageGallery-arrow-left",{"ImageGallery-arrow-disabled":0===c}),style:{left:"".concat(O,"px")},onClick:function(){return t.handleCutImage(-1)}},Object(V.g)(P.a,{fill:"#fff",size:42})),Object(V.g)("div",{className:"ImageGallery-Inner",ref:function(e){t.scrollNode=e}},Object(V.g)("img",{ref:function(e){t.imgEl=e},src:Object(B.imgUrl)(j.url,"r"),className:f()("ImageGallery-Img",{"ImageGallery-transition":"transition"===i,"ImageGallery-fixed":"fixed"===i,"ImageGallery-CursorZoomIn":u}),style:{width:r,height:o,transform:s,opacity:d},onTransitionEnd:this.handleTransEnd,alt:"preview","data-rawwidth":j.width,"data-rawheight":j.height,"data-thumbnail":j.thumbnail,"data-original":Object(B.imgUrl)(j.url,"r"),"data-actualsrc":Object(B.imgUrl)(j.url,"b")})),!l&&e.length>1&&Object(V.g)("a",{className:f()("ImageGallery-arrow-right",{"ImageGallery-arrow-disabled":c>=e.length-1}),onClick:function(){return t.handleCutImage(1)},style:{right:"".concat(O,"px")}},Object(V.g)(z.a,{fill:"#fff",size:42}))),!l&&Object(V.g)("a",{className:"ImageGallery-close",onClick:this.setImageElAttr},Object(V.g)(y.a,{fill:"#fff"})),l&&Object(V.g)(M.a,{img:l,onClose:this.handlePreviewImageClose})))}}]),n}(p.Component);G.propTypes={img:u.a.object.isRequired,data:u.a.object.isRequired,onClose:u.a.func.isRequired};var K=G,Z=n(963);function Q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=A()(t);if(e){var c=A()(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return S()(this,n)}}var X=function(t){N()(n,t);var e=Q(n);function n(t){var a;return T()(this,n),(a=e.call(this,t)).setImageAttr=function(){var t=a.state,e=t.width,n=t.height;if(!e||!n){var c=a.divEl.getBoundingClientRect();e=e||c.width,n=n||c.width,a.setState({width:e,height:n})}var r=a.getBoundingClientRect({width:e,height:n});a.setState({imageWidth:r.width,imageHeight:r.height,imageTop:r.top,imageLeft:r.left})},a.getBoundingClientRect=function(t){var e=t.width,n=t.height,c=a.props.data,r={top:0,let:0,width:0,height:0},o=1;return c.width>c.height?(r.height=n,o=n/c.height,r.width=c.width*o,r.left="-".concat((r.width-e)/2)):(r.width=e,o=e/c.width,r.height=c.height*o,r.top="-".concat((r.height-n)/2)),r},a.handlePreviewImageOpen=function(t){var e=a.props.onPreviewImageOpen;t.persist(),e&&e(t)||a.setState({previewImage:a.imgWrapper.querySelector("img")})},a.handlePreviewImageClose=function(){a.setState({previewImage:null})},a.state={width:t.width||0,height:t.height||0,imageWidth:0,imageHeight:0,imageTop:0,imageLeft:0,previewImage:null},a}return k()(n,[{key:"componentDidMount",value:function(){this.setImageAttr()}},{key:"render",value:function(){var t=this,e=this.state,n=e.width,a=e.height,c=e.previewImage,r=e.imageWidth,o=e.imageHeight,i=e.imageTop,l=e.imageLeft,s=this.props,u=s.data,d=s.images,p=s.index,b=s.surplus,h=s.previewType,m=void 0===h?1:h,v=s.data.isGif,O=s.vague,j=s.previewTransitionType,g=void 0===j?0:j;return Object(V.g)("div",{onClick:this.handlePreviewImageOpen,className:"Thumbnail-Wrapper",ref:function(e){t.divEl=e},style:{width:n?"".concat(n,"px"):"",height:a?"".concat(a,"px"):""}},Object(V.g)("span",{ref:function(e){t.imgWrapper=e},className:f()({"Image-PreviewVague":O})},O?Object(V.g)(Z.a,{className:"Image-Preview",url:v?Object(B.imgUrl)(u.thumbnail,"xl"):Object(B.imgUrl)(u.url,"xl"),width:n,height:a,alt:"cover",thumbnail:v?Object(B.imgUrl)(u.thumbnail,"xl"):Object(B.imgUrl)(u.url,"xl"),"data-rawwidth":u.width,"data-rawheight":u.height,"data-thumbnail":u.thumbnail,"data-original":Object(B.imgUrl)(u.url,"r"),"data-actualsrc":Object(B.imgUrl)(u.url,"b")}):Object(V.g)("img",{className:"Image-Preview",src:v?u.thumbnail:Object(B.imgUrl)(u.url,"r"),width:r,height:o,style:{top:"".concat(i,"px"),left:"".concat(l,"px")},alt:"preview","data-rawwidth":u.width,"data-rawheight":u.height,"data-thumbnail":u.thumbnail,"data-original":Object(B.imgUrl)(u.url,"r"),"data-actualsrc":Object(B.imgUrl)(u.url,"b")})),b>0&&Object(V.g)("em",{className:"Thumbnail-Surplus-Sign"},"+".concat(b)),v&&Object(V.g)("em",{className:"Thumbnail-Gif-Sign"},"GIF"),c&&(1===m?Object(V.g)(K,{img:c,data:u,index:p,images:d,onClose:this.handlePreviewImageClose}):Object(V.g)(M.a,{img:c,isOriginalUrl:!O,transitionType:g,data:u,onClose:this.handlePreviewImageClose})))}}]),n}(p.Component);X.propTypes={width:u.a.number,height:u.a.number,index:u.a.number,surplus:u.a.number,data:u.a.object,images:u.a.array,onPreviewImageOpen:u.a.func};var J=n(395),Y=n(844),$=n(853),tt=n(847),et=n(964),nt=n(875),at=n(892),ct=n(54),rt=n(839),ot=n(860),it=n(393),lt=n(854),st=n(851),ut=n(1504),dt=n(377),pt=n(398),bt=n(25);n(1225);function ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var ft={pin:"updatePinsReaction"},mt=function(t){Object(r.a)(n,t);var e=ht(n);function n(){var t;Object(a.a)(this,n);for(var c=arguments.length,r=new Array(c),o=0;o<c;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).handleToggleVote=t.context.authRequired((function(e){var n=t.props,a=n.reactioned,c=n.type,r=n.id,o=!a;v.a.trackEvent(e.target,{action:o?"Upvote":"UnUpvote",element:"Button"});var i=ft[c];t.props[i](r,o)}),bt.X.vote),t}return Object(c.a)(n,[{key:"render",value:function(){var t=this.props,e=t.reactioned,n=t.count,a=t.className,c=t.disabled;return Object(l.c)(C.c,{className:f()("VoteButton","ReactionButton",{"is-active":e},a),onClick:this.handleToggleVote,disabled:c,children:[Object(l.b)(ut.a,{size:20,center:!0})," ",Object(dt.formatNumber)(n)]})}}]),n}(p.Component);mt.contextTypes={authRequired:u.a.func},mt.propTypes={type:u.a.oneOf(pt.a).isRequired,id:u.a.oneOfType([u.a.number,u.a.string]).isRequired,icon:u.a.string,reactioned:u.a.bool,count:u.a.number};var vt=Object(b.connect)(null,{updatePinsReaction:J.i})(mt),Ot=n(889),jt=n(1055),gt=n(376),yt=n(955);function Ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var wt=function(t){Object(r.a)(n,t);var e=Ct(n);function n(t){var c;Object(a.a)(this,n),(c=e.call(this)).openDeleteModal=function(){c.setState({deleteModalShown:!0})},c.closeDeleteModal=function(){c.setState({deleteModalShown:!1})},c.handleFavlistsShown=function(){v.a.trackEvent(c.favButtonRef,{action:"Collect",element:"Button",is_intent:!0}),c.context.authRequired((function(){return c.setState({favlistsShown:!0})}),bt.X.favlists)()},c.handleFavlistHide=function(){c.setState({favlistsShown:!1})},c.handlePositionStatusChange=function(t){c.setState({positionStatus:t})},c.handleDeletePin=function(){var t=c.context.authRequired,e=c.props,n=e.pin.id;return t((0,e.deletePin)(n),bt.X.deletePin)},c.handleCommentsShown=function(t,e){c.setState(e)},c.handleCommentsHide=function(){c.setState({commentsShown:!1})},c.renderQuoteContents=function(t,e){var n=t.content;return Object(l.b)("blockquote",{className:"PinItem-3lineBlockquote",children:n},e)},c.renderLinkContents=function(t,e,n){var a=t.url,c=t.title,r=t.imageUrl,o=t.subtype;return"text"===n?Object(l.c)("a",{className:f()("link-text",{"PinItem-contentTitle":!!c,"PinItem-contentUrl":!c}),href:a,target:"_blank",rel:"noopener noreferrer",children:[Object(l.b)(O.a,{stroke:"#BBC1CC",text:!0,center:!0})," ",c||a]},e):Object(l.c)("a",{className:"link-box",href:a,target:"_blank",rel:"noopener noreferrer",children:[Object(l.c)("span",{className:"content",children:[Object(l.b)("span",{className:f()("title",{"PinItem-contentTitle":!!c,"PinItem-contentUrl":!c}),children:c||a}),c&&Object(l.c)("span",{children:[(a.match(/^https?:\/\/([^/?#]+)(?:[/?#]|$)/i)||[])[1],o&&Object(l.b)("span",{className:"subtype",children:o})]})]}),r&&Object(l.b)("img",{className:"thumbnail",src:r,alt:"头像"})]},e)},c.renderVideoContents=function(t,e){var n=t.videoId||t.id,a={title:"",thumbnail:t.thumbnail||t.coverInfo&&t.coverInfo.thumbnail,isLens:!0,id:n,isPlayable:!0,url:"https://www.zhihu.com/video/".concat(n)};return Object(l.b)(jt.a,{isAppView:c.isAppView,data:a},e)},c.renderOriginPinContents=function(t){if(!t)return null;if(t.isDeleted)return Object(l.b)("div",{className:f()("PinItem-RichText","PinItem-content-originpin"),children:t.deletedReason});if(t.content&&t.content[0]){var e=c.props.noCollapsed,n=c.state.originPinExpanded,a=t.content.find((function(t){return"text"===t.type}));return Object(l.c)("div",{className:f()("PinItem-RichText","PinItem-content-originpin"),children:[Object(l.c)("div",{children:[t.author.name,"："]}),a&&Object(l.b)(ot.b,{html:a.content,noCollapsed:e,expanded:n}),c.renderPinContents(t.content)]})}return null},c.renderPinContents=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0,n=t.filter((function(t){return t.url&&"image"===t.type})),a=[];return Object(l.c)("div",{className:f()("RichText","ztext","PinItem-remainContentRichText"),children:[t.map((function(t,r){var o=t.type;return"quote"===o?c.renderQuoteContents(t,r):"link"===o?c.renderLinkContents(t,r,e):"video"===o?c.renderVideoContents(t,r):("image"===o&&a.length<4&&t.url&&a.push(Object(l.b)(X,{data:t,vague:!0,index:a.length,images:n,surplus:n.length>4&&3===a.length?n.length-4:0},r)),null)})),a.length>0&&Object(l.b)("div",{className:"Image-Wrapper-Preview",children:a})]})},c.renderRemainContents=function(){var t=c.props.pin,e=t.id,n=t.created,a=t.updated,r=t.originPin,o=t.content,i="//".concat(bt.q,"/pin/").concat(e);return Object(l.c)("div",{children:[c.renderPinContents(o),c.renderOriginPinContents(r),Object(l.b)(ot.a,{href:i,created:n,updated:a})]})};var r=t.pin,o=t.noCollapsed,i=t.showCommentButton;return c.contentHTML=c.getContentHTML(r),c.state={expanded:o,originPinExpanded:o,commentPattern:i?"fixed":"bottom",commentsShown:!i,commentsAutoFocus:i,deleteModalShown:!1,favlistsShown:!1},c}return Object(c.a)(n,[{key:"componentWillReceiveProps",value:function(t){this.contentHTML=this.getContentHTML(t.pin)}},{key:"getContentHTML",value:function(t){var e;if(null==t||null===(e=t.content)||void 0===e||!e[0])return"";var n=t.content,a="";return"text"===n[0].type&&(a=n[0].content),a}},{key:"render",value:function(){var t=this,e=this.props,n=e.pin,a=e.pin,c=a.id,r=a.author,o=a.virtuals,i=(o=void 0===o?{}:o).reactionType,s=a.commentCount,u=a.reactionCount,d=a.adminClosedComment,p=a.reviewingInfo,b=e.preset,h=e.lastreadTouchable,f=e.isSticky,v=e.handleToggleSticky,O=e.noCollapsed,w=e.showFollowAuthorButton,T=e.showCommentButton,R=e.commentInputPosition,k=e.isMobile,I=e.renderOptions,N=this.state,x=N.positionStatus,S=N.expanded,E=N.deleteModalShown,A=N.favlistsShown,B=N.commentsShown,M=N.commentsAutoFocus,P=N.commentPattern,z=this.context.currentUser,L=z&&z.urlToken===r.urlToken,U="plain"===b,D="like"===i,W="function"==typeof v,V="//".concat(bt.q,"/pin/").concat(c);return Object(l.c)(rt.e,{data:n,link:V,meta:U||Object(l.b)("div",{children:Object(l.c)("div",{className:"PinItem-author",children:[Object(l.b)($.a,{author:r,className:"PinItem-authorInfo",userLinkV2:!0,children:(null==p?void 0:p.isReviewing)&&Object(l.b)(m.Text,{color:"GBK06A",fontSize:"15px",children:p.tips})},"authorInfo"),w&&!L&&z&&Object(l.b)(Y.a,{className:"PinItem-followButton",preset:"primary",type:r.type,id:r.urlToken,gender:r.gender,isFollowing:r.isFollowing,onClick:this.handleFollowButtonClick})]})}),className:"PinItem",lastreadTouchable:h,children:[Object(l.c)(ot.b,{prefix:W&&f&&Object(l.b)(et.a,{}),alwaysShowPrefix:!0,data:n,html:this.contentHTML,excerpt:this.contentHTML,noCollapsed:O,expanded:S,onPositionStatusChange:this.handlePositionStatusChange,renderCanExpandExtra:this.renderRemainContents,children:[Object(l.b)(vt,{reactioned:Boolean(D),count:u,id:c,type:"pin"}),T&&Object(l.b)(lt.a,{onClick:this.handleCommentsShown,commentsShown:B,commentClosed:d,count:s,positionStatus:x}),Object(l.b)(tt.a,{id:c,type:"pin",authorName:r&&r.name,href:V,positionStatus:x}),(!z||!z.isOrg)&&Object(l.b)(at.a,{onRef:function(e){return t.favButtonRef=e},onClick:this.handleFavlistsShown,label:k?"":"收藏"}),!L&&Object(l.b)(it.a,{type:"pin",id:c}),!k&&W&&L&&Object(yt.a)(z)&&Object(l.b)(C.c,{preset:"plain",onClick:v,icon:f?j.a:g.a,label:f?"取消置顶":"置顶"}),L&&Object(l.b)(C.c,{preset:"plain",onClick:this.openDeleteModal,icon:y.a,label:"删除"}),I()]}),L&&Object(l.b)(Ot.a,{title:"你确定要删除自己的想法吗？",shown:E,onCancel:this.closeDeleteModal,onSubmit:this.handleDeletePin}),Object(l.b)(st.a,{parent:n,commentPattern:P,commentInputPosition:R,shown:B,showPackupButton:T,autoFocus:M,onClose:this.handleCommentsHide}),Object(l.b)(nt.a,{id:c,type:"pin",shown:A,onClose:this.handleFavlistHide,zaEnabled:!0})]})}}]),n}(p.Component);wt.contextTypes={authRequired:u.a.func,currentUser:u.a.object},wt.propTypes={noCollapsed:u.a.bool,showFollowAuthorButton:u.a.bool,showCommentButton:u.a.bool,commentInputPosition:u.a.oneOf(["top","bottom"])},wt.defaultProps={noCollapsed:!1,showFollowAuthorButton:!1,showCommentButton:!0,commentInputPosition:"bottom",renderOptions:function(){return[null]}};var Tt=Object(d.compose)(Object(gt.b)((function(t){var e=t.pin,n=t.trackCardShow,a=void 0===n||n,c=t.zaInfos,r=(c=void 0===c?{}:c).cardShow;return Object.assign(Object.assign({module:"PinItem",card:{content:{type:"Pin",id:String(e.id),author_member_hash_id:e&&e.author.id}}},r&&{view:{id:r}}),{},{trackCardShow:a})})),Object(b.connect)((function(t,e){var n=e.pin;return Object.assign(Object.assign({},"string"==typeof(null==n?void 0:n.author)&&{pin:Object.assign({},n,{author:t.entities.users[n.author]})}),{},{isMobile:Object(ct.d)(t)})}),{deletePin:J.c}))(wt);n(1078)},1050:function(t,e,n){"use strict";n.d(e,"a",(function(){return pt}));var a=n(4),c=n(42),r=n(1),o=n(2),i=n.n(o),l=n(24),s=n(11),u=n.n(s),d=n(123),p=n(94),b=n(73),h=n(247),f=n.n(h),m=n(74),v=n(87),O=n(31),j=n(258),g=n(2588),y=n(30),C=n(54),w=n(400),T=n(1129),R=n(38),k=n(839),I=n(928),N=n(854),x=n(847),S=n(875),E=n(892),A=n(393),B=n(1118),M=n(392),P=n(1121),z=n(32),L=n(2587),U=n(950),D=["isLiked","onClick","showIcon","authRequired"],W=Object(U.a)((function(t){var e=t.isLiked,n=t.onClick,a=t.showIcon,c=void 0===a||a,o=t.authRequired,i=Object(z.default)(t,D),l=Object(b.c)((function(t){var a=!e,c=a?"Like":"UnLike";y.a.trackEvent(t.target,{id:7448,action:c}),o((function(){return n(a)}))()}));return Object(r.b)(O.c,Object.assign({preset:"plain",onClick:l,icon:c?L.a:null,label:e?"取消喜欢":"喜欢"},i))})),V=n(136),_=Object.assign;var F=function(t){return i.a.createElement(V.a,_({width:"14",height:"16",fill:"none",viewBox:"0 0 14 16"},t),i.a.createElement("path",{fill:"#8590A6",d:"M1 2.666c0-.736.597-1.333 1.334-1.333h9.333c.736 0 1.334.597 1.334 1.333v10.667c0 .736-.598 1.333-1.334 1.333h-1.666a.333.333 0 01-.334-.333v-4A2.333 2.333 0 007.334 8h-6A.333.333 0 011 7.667v-5zm2.667 0a.667.667 0 100 1.334h6.667a.667.667 0 100-1.333H3.667zM3 6c0-.368.299-.667.667-.667H9a.667.667 0 010 1.334H3.667A.667.667 0 013 6zm-2 4.334a1 1 0 011-1h5.333a1 1 0 011 1v3.333a1 1 0 01-1 1H2a1 1 0 01-1-1v-3.333zm5.167 1.377a.333.333 0 010 .578l-2 1.154a.333.333 0 01-.5-.288v-2.31c0-.256.277-.417.5-.288l2 1.154z",fillRule:"evenodd",clipRule:"evenodd"}))},q=["label","onClick"];function H(t,e){var n=t.label,a=t.onClick,c=Object(z.default)(t,q);return Object(r.b)(p.a,{zaText:!0,zaType:"Button",zaBlock:"VideoContributeButton",className:"ContentItem-action",children:Object(r.b)(O.c,Object.assign({ref:e,preset:"plain",onClick:a,icon:F,label:n},c))})}var G=Object(o.forwardRef)(H),K=n(43),Z=n.n(K),Q=n(57),X=n(832),J=n(183),Y=n(961),$=["onClick"],tt=Object(o.forwardRef)((function(t,e){var n=t.onClick,a=Object(z.default)(t,$);return Object(r.b)(O.c,Object.assign({ref:e,preset:"plain",onClick:n,icon:X.a,label:"设置"},a))})),et=function(t){var e=t.className,n=t.zvideo,a=t.onEdit,c=t.onToggleVisibility,i=t.onRemove,s=t.onChangeCommentPermission,p=t.togglerProps,b=Object(l.useDispatch)(),h=n.id,f=n.commentPermission,m=n.isVisible,O=Object(o.useCallback)(function(){var t=Object(Q.a)(Z.a.mark((function t(e){var n;return Z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="视频删除后将不可恢复",t.next=3,b(Object(M.d)(h)).then((function(t){var e=t.payload.message;e&&(n=e)}));case 3:J.a.confirm(Object(r.b)(d.Text,{textAlign:"center",children:n}),{title:"确定删除视频",text:{ok:"删除视频"}}).then((function(){i(e)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[b,h,i]);return Object(r.c)(v.c,{className:u()("ZVideoSettingMenu",e),itemClassName:"ZVideoSettingMenu-item",toggler:Object(r.b)(tt,Object.assign({},p)),reversed:!0,children:[Object(r.b)(v.b,{onClick:a,children:"编辑视频"}),Object(r.b)(v.b,{onClick:c,children:"在视频列表内".concat(m?"隐藏":"显示")}),Object(r.b)(v.a,{}),Object(r.b)(Y.c,{current:f,target:n,onChange:s}),Object(r.b)(v.a,{}),Object(r.b)(v.b,{onClick:O,children:"删除"})]})},nt=n(137),at=n(831),ct=n(2589),rt=n(920),ot=["status","questionId","answerId","children"],it=["item"],lt=function(t){var e=t.status,n=t.questionId,a=t.answerId,c=t.children,o=Object(z.default)(t,ot);return 2===e?Object(r.b)(d.Link,Object.assign(Object.assign({target:"_blank",href:"https://www.zhihu.com/question/".concat(n,"/answer/").concat(a),css:{display:"block",cursor:"pointer"}},o),{},{children:c})):Object(r.b)(d.Box,Object.assign(Object.assign({},o),{},{children:c}))};var st=function(t){var e,n,a,c,o=t.item,i=Object(z.default)(t,it),l=o.startTime,s=o.endTime,u=o.target,p=o.status,b=o.abnormalReason,h=Math.floor(l/1e3),f=Math.floor(s/1e3),m=u.parentObject,v=m.id,O=m.title,j=u.object.id,g=null;return 0===p?(e="已保存草稿",n="GBK06A",g=Object(r.b)(at.a,{}),a="GBK06A"):1===p?(e="发布中...",n="GBK06A",a="GBK06A"):2===p?"审核中"===b?(e="审核中",n="GBL05A",g=Object(r.b)(at.a,{}),a="GBK06A"):(e="已投稿",n="GBL01A",g=Object(r.b)(at.a,{}),a="GBK03A"):3===p&&(e="发布失败",n="GRD03A",g=Object(r.b)(ct.a,{size:12,css:{marginLeft:5}}),a="GBK06A",c=!0),Object(r.c)(lt,Object.assign(Object.assign({py:"20px",css:function(t){return Object.assign(Object.assign({},0===p&&{cursor:"pointer"}),Object(nt.c)({borderTop:"1px solid ".concat(t.colors.GBK09A)}))},status:p,questionId:v,answerId:j},i),{},{children:[Object(r.c)(d.Flex,{color:n,alignItems:"center",mb:"8px",fontSize:"12px",children:[Object(r.b)(d.Text,{children:"".concat(Object(rt.a)(h)," - ").concat(Object(rt.a)(f))}),Object(r.b)(d.Text,{ml:"auto",fontWeight:"bold",children:e}),g]}),Object(r.b)(d.Text,{color:a,fontSize:"14px",children:O}),c&&Object(r.b)(d.Text,{p:"8px",mt:"8px",color:"GBK03A",fontSize:"14px",css:function(t){return{borderRadius:2,backgroundColor:t.colorMod(t.colors.GRD03A).alpha(.08)}},children:b})]}))},ut={up:1,neutral:0,down:-1};function dt(t){var e,i=Object(l.useDispatch)(),s=t.className,h=t.zvideo,B=t.author,z=t.commentsShown,L=void 0!==z&&z,U=t.onCommentButtonClick,D=void 0===U?f.a:U,V=t.renderOptions,_=t.renderActionButtons,F=t.enableContribute,q=void 0!==F&&F,H=h.id,K=h.title,Z=h.description,Q=h.voting,X=h.voteCount,J=h.voteupCount,Y=h.commentCount,$=h.isLiked,tt=h.isFavorited,nt=h.contribute,at=h.video,ct=h.video,rt=(ct=void 0===ct?{}:ct).duration,ot=void 0===rt?0:rt,it=Object(R.o)(B),lt=Object(C.o)(),dt=Object(o.useMemo)((function(){return parseInt(1e3*ot)}),[ot]),pt=Object(o.useMemo)((function(){return{id:H,video:at}}),[H,at]),bt=Object(b.d)((function(){return n.e(20).then(n.bind(null,2690))})),ht=Object(w.p)(H),ft=Object(o.useState)(!1),mt=Object(c.a)(ft,2),vt=mt[0],Ot=mt[1],jt=Object(w.o)(H).answer,gt=(jt=void 0===jt?{}:jt).canContribute,yt=void 0!==gt&&gt,Ct=Boolean((null==nt||null===(e=nt.contributeList)||void 0===e?void 0:e.length)||(null==nt?void 0:nt.totals)),wt=q&&!lt&&it&&Ct,Tt=q&&!lt&&it&&yt&&!Ct,Rt=Object(P.a)("zvideo_toolbar:should_hide_contribution_tooltip"),kt=Object(c.a)(Rt,2),It=kt[0],Nt=kt[1],xt=Object(o.useRef)();Object(b.i)((function(){return Nt(!0)}),!It&&Tt?5e3:null);var St=Object(o.useCallback)((function(){Ot(!0),i(Object(w.h)(H,"edit"))}),[H,i]),Et=Object(o.useCallback)((function(){return i(Object(w.g)({zvideoId:H,target:"answer",duration:dt}))}),[i,H,dt]),At=Object(o.useCallback)((function(t){return i(Object(M.t)(H,ut[t]))}),[H,i]),Bt=Object(o.useCallback)((function(t){i(Object(M.e)(H,t))}),[i,H]),Mt=Object(o.useState)(!1),Pt=Object(c.a)(Mt,2),zt=Pt[0],Lt=Pt[1],Ut=Object(o.useCallback)((function(t){Lt(!0),y.a.trackEvent(t.target,{id:8213,action:"Collect",is_intent:!tt})}),[tt]),Dt=Object(o.useCallback)((function(){Lt(!1)}),[]),Wt=Object(o.useCallback)((function(t,e){i(Object(M.a)(H,e))}),[H,i]),Vt=Object(o.useCallback)((function(){i(Object(M.r)(H))}),[H,i]),_t=Object(o.useCallback)((function(){i(Object(M.p)(H)).then((function(){var t="https://www.zhihu.com/people/".concat(B.urlToken,"/zvideos");window.location.href=t}))}),[H,B,i]),Ft=Object(o.useState)(null),qt=Object(c.a)(Ft,2),Ht=qt[0],Gt=qt[1],Kt=Object(o.useState)(!1),Zt=Object(c.a)(Kt,2),Qt=Zt[0],Xt=Zt[1],Jt=Object(o.useState)(!1),Yt=Object(c.a)(Jt,2),$t=Yt[0],te=Yt[1];Object(o.useEffect)((function(){Qt&&!Ht&&i(Object(M.c)(H)).then((function(t){var e=t.payload;Gt(e)}))}),[H,Qt,Ht,i]),Object(o.useEffect)((function(){it&&!lt&&q&&Et()}),[it,Et,lt,q]);var ee=Object(o.useCallback)((function(t){i(Object(M.n)(H,t)).then((function(){i(Object(w.k)(H)),t.clubId&&i(Object(M.q)(H,t.clubId));var e="https://www.zhihu.com/zvideo/".concat(H);window.location.href=e}))}),[H,i]),ne=Object(o.useState)(!1),ae=Object(c.a)(ne,2),ce=ae[0],re=ae[1],oe=_({componentList:[{name:"favlist",component:Object(r.b)(E.a,{onClick:Ut,label:"收藏",showIcon:!lt},"favlist")},{name:"like",component:Object(r.b)(W,{isLiked:$,onClick:Bt,showIcon:!lt},"like")},{name:"report",component:!it&&Object(r.b)(A.a,{id:H,type:"zvideo",onModalShown:re},"report")}]}).filter(Boolean),ie=Object(o.useMemo)((function(){return"1328062627923550208"===H||"zhi-hu-zheng-wu"===B.urlToken}),[H,B.urlToken]),le=Object(o.useCallback)((function(){Gt(null),Xt(!1),i(Object(M.l)(H))}),[i,H]);return Object(r.c)(r.a,{children:[Object(r.c)(k.a,{className:u()("ZVideoToolbar",s),children:[!ie&&Object(r.b)(I.a,{type:"zvideo",count:J||X,voting:Q,onVote:At,isOwner:it,zaIds:{voteUp:6599,voteDown:6600}}),Object(r.b)(N.a,{onClick:D,commentsShown:L,count:Y,positionStatus:"normal"}),Object(r.b)(x.a,{id:H,type:"zvideo",url:"https://www.zhihu.com/zvideo/".concat(H),title:K,authorName:B.name,positionStatus:"normal"}),lt?Object(r.c)(v.c,{preventCloseOnTarget:!0,globalClose:!ce,menuContainerClassName:"ZVideoToolbar-menuContainer",toggler:Object(r.b)(O.c,{preset:"plain",icon:g.a,"aria-label":"更多"}),children:[oe.map((function(t){return Object(r.b)(v.b,{className:"ZVideoToolbar-menuItem",children:t},t.key)})),V()]}):[].concat(Object(a.a)(oe),Object(a.a)(V())),wt&&Object(r.b)(G,{label:"全部投稿",onClick:function(){i(Object(w.h)(H)),te(!0)}}),Tt&&Object(r.c)(r.a,{children:[Object(r.b)(G,{ref:xt,label:"添加投稿",onClick:St}),Object(r.b)(j.a,{placement:"top",isOpen:!It,target:xt.current,children:"投稿到问题，让更多人看到你的视频"})]}),it&&Object(r.b)(et,Object.assign({zvideo:h,onEdit:function(){return Xt(!0)},onToggleVisibility:Vt,onChangeCommentPermission:Wt,onRemove:_t},lt&&{togglerProps:{label:null}}))]}),it&&Object(r.b)(m.b,{className:"ZVideoToolbar-videoFormModal",title:"编辑视频",size:"fullPage",onClose:le,css:{width:"734px",".Modal-inner":{"::-webkit-scrollbar":{display:"none"}},".Modal-title":{marginLeft:32}},children:Qt&&Ht&&Object(r.b)(T.a,{defaultVideo:Ht,onSubmit:ee,onRemove:le,isEditing:!0})}),Object(r.b)(S.a,{id:H,type:"zvideo",shown:zt,onClose:Dt,zaEnabled:!0}),q&&!lt&&it&&Object(r.c)(r.a,{children:[Object(r.b)(m.b,{title:Object(r.c)(d.Flex,{px:"24px",justifyContent:"space-between",children:[Object(r.b)(d.Text,{fontSize:"24px",color:"GBK02A",children:"全部视频回答投稿"}),yt&&Object(r.b)("button",{css:function(t){return{width:90,height:34,border:"none",borderRadius:3,fontSize:14,fontWeight:"normal",color:t.colors.GBL01A,backgroundColor:t.colorMod(t.colors.GBL01A).alpha(.08)}},onClick:function(){St(),te(!1)},children:"添加投稿"})]}),css:function(t){return{width:536,height:554,backgroundColor:t.colors.GBK99A,".Modal-title":{marginTop:24},".Modal-inner::-webkit-scrollbar":{display:"none"}}},onClose:function(){return te(!1)},children:$t&&ht.map((function(t){return Object(r.b)(st,Object.assign({item:t},0===t.status&&{onClick:function(){St(),i(Object(w.l)(t.id)),te(!1)}}),t.id)}))}),Boolean(bt)&&Object(r.b)(p.b,{block:"Contribution",children:Object(r.b)(bt,{show:vt,defaultVideo:pt,title:K,description:Z,duration:dt,onClose:function(){Et(),i(Object(M.l)(H)),Ot(!1)},shouldPublish:!0})})]})]})}dt.defaultProps={renderOptions:function(){return[null]},renderActionButtons:B.a};var pt=dt},1053:function(t,e,n){"use strict";n.d(e,"a",(function(){return g}));var a=n(42),c=n(1),r=n(2),o=n(24),i=n(900),l=n.n(i),s=n(2579),u=n(1085),d=n(38),p=n(899),b=n(1050),h=n(1136),f=n(839),m=n(851),v=n(860),O=n(1033);n(1034);function j(t){var e,n,i=t.zvideo,j=t.zvideo,g=j.id,y=j.description,C=void 0===y?"":y,w=j.title,T=j.author,R=j.isVisible,k=t.lastreadTouchable,I=t.preset,N=void 0===I?"primary":I,x=t.onToggleExpand,S=t.renderOptions,E=t.couldShowHiddenSign,A=t.renderActionButtons,B=t.shouldAlwaysShowPlayer,M=t.truncateDisabled,P=t.limit,z=t.showMetaAfterPlayer,L=t.videoRef,U=t.alwaysShowVolumeButton;i.thumbnailExtraInfo&&(e=i.thumbnailExtraInfo.videoId,n=i.thumbnailExtraInfo.url),i.video&&(e=i.video.videoId,n=i.video.thumbnail);var D=Object(o.useSelector)((function(t){return l()(T)?t.entities.users[T]:T})),W=Object(d.o)(D),V=Object(r.useState)(!1),_=Object(a.a)(V,2),F=_[0],q=_[1],H=Object(r.useState)({commentsShown:!1,commentsAutoFocus:!0,commentPattern:"fixed"}),G=Object(a.a)(H,2),K=G[0],Z=G[1],Q=Object(O.a)(N,F,D),X=Object(a.a)(Q,1)[0],J=W&&!R&&E,Y="https://www.zhihu.com/zvideo/".concat(g),$=e&&(B||F);return Object(c.c)(f.e,{className:"ZVideoItem",data:i,title:Object(c.c)(c.a,{children:[J&&Object(c.c)("span",{className:"ZVideoItem-hiddenSign",children:[Object(c.b)(s.a,{text:!0,center:!0}),"隐藏"]}),Object(c.b)("a",{href:Y,target:"_blank",rel:"noopener noreferrer",children:w})]}),link:Y,meta:z?null:X,expandedHeight:0,lastreadTouchable:k,"data-zop":JSON.stringify({authorName:null==D?void 0:D.name,itemId:g,title:w,type:"zvideo"}),children:[W&&(i.isReviewing||i.isUpdateReviewing)&&Object(c.b)(h.a,{}),$&&Object(c.b)("div",{className:"ZVideoItem-video",children:Object(c.b)(u.a,{ref:L,className:"ZVideoItem-player",type:"video",src:"https://www.zhihu.com/video/".concat(e),iframeProps:{allowFullScreen:!0},griffithProps:{alwaysShowVolumeButton:U}})}),z&&X,Object(c.b)(v.b,Object.assign(Object.assign({excerpt:Object(p.c)(C),html:C,cover:B?null:n,hasVideo:!B},P?{limit:P}:{}),{},{truncateDisabled:M,allowCollapseWithEmptyExcerpt:!0,expanded:F,onToggleExpend:function(t){q(t),x&&x(t)},data:Object.assign(Object.assign({},i),{},{id:g}),children:Object(c.b)(b.a,{className:"ZVideoItem-toolbar",zvideo:i,author:D,commentsShown:K.commentsShown,onCommentButtonClick:function(t,e){return Z(e)},renderOptions:S,renderActionButtons:A})})),Object(c.b)(m.a,{className:"ZVideoItem-comment",containerClassName:"ZVideoItem-commentContainer",parent:i,shown:K.commentsShown,commentPattern:K.commentPattern,autoFocus:K.autoFocus,onClose:function(){return Z(Object.assign(Object.assign({},K),{},{commentsShown:!1}))},commentInputPosition:"bottom",showPackupButton:!0})]})}j.defaultProps={renderOptions:function(){return[null]},truncateDisabled:!0};var g=j},1075:function(t,e,n){},1078:function(t,e,n){t.exports=n.p+"assets/ReviewingPlaceholder.b2c9d906.svg"},1088:function(t,e,n){"use strict";var a=n(13),c=n(14),r=n(15),o=n(17),i=n(9),l=n(1),s=n(3),u=n.n(s),d=n(2),p=n.n(d),b=n(2579),h=n(21),f=function(t){return p.a.createElement(h.a,t,p.a.createElement("path",{d:"M4.5 4h15a1.5 1.5 0 0 1 0 3h-15a1.5 1.5 0 0 1 0-3zm0 6h15a1.5 1.5 0 0 1 0 3h-15a1.5 1.5 0 0 1 0-3zm0 6H12a1.5 1.5 0 0 1 0 3H4.5a1.5 1.5 0 0 1 0-3z",fillRule:"evenodd"}))};f.defaultProps={name:"Answer"};var m=f,v=n(182),O=n(377),j=n(11),g=n.n(j),y=n(2589);function C(t){var e=t.annotationDetail,n=t.className;if(!e)return null;var a=e.detail,c=e.member,r=e.reasonDescription,o=e.type,i=c?"".concat(c.name,"："):"";return Object(l.c)("section",{className:g()("Annotation-mark",n),children:[Object(l.c)("header",{className:"Annotation-header",children:["strong"===o&&Object(l.b)(y.a,{size:16,center:!0,text:!0,className:"Annotation-alert"}),Object(l.b)("h1",{className:"Annotation-markTitle",children:r||"该内容已被标记"})]}),(a||i)&&Object(l.b)("div",{className:"Annotation-markSummary",dangerouslySetInnerHTML:{__html:"".concat(i).concat(a||"未填写原因")}})]})}C.propTypes={annotationDetail:u.a.shape({reason:u.a.number.isRequired,reasonDescription:u.a.string,type:u.a.oneOf(["strong","weak"]).isRequired,detail:u.a.string,member:u.a.shape({name:u.a.string.isRequired}),showOuter:u.a.bool}).isRequired};var w=n(985),T=n(839),R=n(860),k=n(847),I=n(104),N=n(854),x=n(851),S=n(844),E=n(376);n(1075);function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var B={placeholders:{img:" [图片] "}},M=function(t){Object(r.a)(n,t);var e=A(n);function n(){var t;Object(a.a)(this,n);for(var c=arguments.length,r=new Array(c),o=0;o<c;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={collapsed:!0,commentPattern:"fixed",commentsShown:!1,commentsAutoFocus:!0},t.handleOpenComment=function(e){var n=e.target.parentNode.className.includes("is-fixed")?"fixed":"bottom",a=t.state.modalShown,c=!("bottom"===n&&a);t.setState({modalShown:c,commentPattern:n})},t.handleCommentsShown=function(e,n){t.setState(n)},t.handleCommentsHide=function(){t.setState({commentsShown:!1})},t.handlePackupButton=function(){t.setState({modalShown:!1}),t.CommentsButtonEl.scrollIntoView({block:"start",behavior:"smooth"}),window.scrollTo(0,window.pageYOffset-window.screen.height/2)},t.handleContentToggleExpand=function(e){t.setState({collapsed:!e})},t}return Object(c.a)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.preset,a=e.question,c=e.question,r=c.id,o=c.title,i=c.type,s=c.created,u=c.answerCount,d=c.followerCount,p=c.isMuted,h=c.questionType,f=c.detail,j=c.commentCount,g=c.adminClosedComment,y=c.relationship,E=void 0===y?{}:y,A=c.annotationDetail,M=e.action,P=(e.isConcise,e.isAnonymousFollowing),z=e.lastreadTouchable,L=e.zaInfos,U=L.title,D=L.expand,W=L.follow,V=L.options,_=e.renderOptions,F=this.state,q=F.commentsShown,H=F.commentsAutoFocus,G=F.commentPattern,K=F.collapsed,Z={id:r,type:i},Q="/question/".concat(r);return Object(l.c)(T.e,{data:a,link:Q,lastreadTouchable:z,onRef:function(e){t.contentItem=e},title:Object(l.c)("div",{className:"QuestionItem-title",children:[Object(l.b)("a",Object.assign(Object.assign({href:Q,target:"_blank",rel:"noopener noreferrer","data-za-detail-view-name":"Title"},U&&{"data-za-detail-view-id":U}),{},{children:o})),P&&Object(l.b)(b.a,{className:"QuestionItem-icon"}),"commercial"===h&&p&&Object(l.b)("span",{className:"QuestionItem-muteStatus",children:"待推广"})]}),children:[!K&&A&&Object(l.b)(C,{annotationDetail:A}),n===T.c.default&&Object(l.c)(T.d,{children:[Object(v.toSmartString)(s),"".concat(Object(O.formatNumber)(u)," 个回答"),"".concat(Object(O.formatNumber)(d)," 个关注")]}),n===T.c.interactive&&Object(l.c)(R.b,{data:a,html:f||"",excerpt:a.excerpt,limit:60,limitWithImage:60,truncateHTMLOptions:B,onToggleExpend:this.handleContentToggleExpand,zaIds:{expand:D},children:[M||Object(l.b)(S.a,Object.assign(Object.assign({},Z),{},{isFollowing:(E&&{}.hasOwnProperty.call(E,"isFollowing")?E:a).isFollowing,zaId:W})),[Object(l.b)(N.a,{onClick:this.handleCommentsShown,commentsShown:q,commentClosed:g,count:j},"comment"),Object(l.b)(k.a,Object.assign(Object.assign({},Z),{},{title:o,href:Q}),"share"),Boolean(u)&&Object(l.c)(I.a,{preset:"plain",to:Q,target:"_blank",children:[Object(l.b)(m,{style:{marginRight:"4px"},center:!0,text:!0}),Object(O.formatNumber)(u)," 个回答"]},"linkbutton"),_&&_((function(){return t.contentItem}),V),K&&A&&Object(l.b)(w.a,{annotationDetail:A})]]}),Object(l.b)(x.a,{parent:a,commentPattern:G,shown:q,autoFocus:H,onClose:this.handleCommentsHide})]})}}]),n}(d.Component);M.propTypes={preset:u.a.oneOf(Object.keys(T.c)).isRequired,isAnonymousFollowing:u.a.bool,contentShown:u.a.bool,zaInfos:u.a.shape({title:u.a.number,expand:u.a.number,follow:u.a.number,options:u.a.number}),renderOptions:u.a.func},M.contextTypes={currentUser:u.a.object},M.defaultProps={preset:T.c.default,zaInfos:{}};e.a=Object(E.b)((function(t){var e=t.question,n=t.trackCardShow,a=void 0===n||n;return{module:"QuestionItem",card:{content:{type:"Question",token:e.id.toString(),item_num:e.answerCount,comment_num:e.commentCount,follower_num:e.followerCount,publish_timestamp:1e3*e.created}},trackCardShow:a}}))(M)},1122:function(t,e,n){"use strict";var a=function(t,e,n){var a=n<0?t.length+n:n,c=t.splice(e,1)[0];t.splice(a,0,c)},c=function(t,e,n){return t=t.slice(),a(t,e,n),t};t.exports=c,t.exports.default=c,t.exports.mutate=a},1132:function(t,e,n){"use strict";var a=n(32),c=n(13),r=n(14),o=n(15),i=n(17),l=n(9),s=n(1),u=n(2),d=n(11),p=n.n(d),b=["className","alt"];function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(l.a)(t);if(e){var c=Object(l.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(i.a)(this,n)}}var f=function(t){Object(o.a)(n,t);var e=h(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var t=this.props,e=t.className,n=t.alt,c=Object(a.default)(t,b);return Object(s.b)("img",Object.assign({className:p()("ImageAlias",e),alt:n},c))}}]),n}(u.Component);e.a=f},1228:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var a=function(t){return t.filter((function(t){var e=t.name;return!/^创建[\s\S]*话题$/.test(e)&&!e.includes("（知乎用户）")}))}},1318:function(t,e,n){"use strict";var a=n(1),c=n(833),r=n(873),o=n(379),i=n(861),l=n(376),s=n(13),u=n(14),d=n(15),p=n(17),b=n(9),h=n(3),f=n.n(h),m=n(2),v=n(382),O=n(843),j=n(944),g=n(962),y=n(947),C=n(1053),w=n(931),T=n(1011),R=n(885);function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(b.a)(t);if(e){var c=Object(b.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(p.a)(this,n)}}function I(t){var e=t.target,n=t.showLabelProps,c=t.sort;switch(e.type){case"answer":return Object(a.b)(j.a,Object.assign(Object.assign({preset:"plain",answer:e},n),{},{lessExcerpt:!0,isTopic:!0}));case"article":return Object(a.b)(g.a,Object.assign(Object.assign({preset:"plain",article:e},n),{},{lessExcerpt:!0}));case"question":return Object(a.b)(y.a,{className:"TopicFeedItem-question",question:e,showTime:"questions"===c});case"zvideo":return Object(a.b)(C.a,{zvideo:e,preset:"plain"});default:return null}}var N=function(t){Object(d.a)(n,t);var e=k(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleWriteAnswerInMobile=function(){var e=t.props.item.target;Object(v.e)(Object(R.a)(e))},t}return Object(u.a)(n,[{key:"renderSource",value:function(){var t=this.props.item.sourceTopic;return t&&Object(a.c)("div",{className:"TopicQuestion-source",children:["来自子话题：",Object(a.b)(w.a,{topic:t})]})}},{key:"render",value:function(){var t=this.props,e=t.item.target,n=t.showLabelProps,c=t.sort;return"zvideo"===e.type?null:Object(a.c)(O.a,{className:"TopicFeedItem",children:[this.renderSource(),Object(a.b)(I,{target:e,showLabelProps:n,sort:c})]})}}]),n}(m.Component);N.contextTypes={authRequired:f.a.func};var x=Object(T.d)(N);e.a=Object(l.b)({module:"ContentList"})((function(t){var e=t.isFetching,n=void 0!==e&&e,l=t.isDrained,s=void 0!==l&&l,u=t.items,d=void 0===u?[]:u,p=t.onLoad,b=t.onRef,h=(t.header,t.sort);return Object(a.b)(c.d,{className:"TopicFeedList",children:!d.length&&s?Object(a.c)(i.k,{py:"120px",children:[Object(a.b)(i.a,{}),Object(a.b)("div",{children:"暂时还没有内容"})]}):Object(a.c)(r.b,{children:[!1,Object(a.b)(o.b,{isLoading:n,isDrained:s,onLoad:p,onRef:b,placeholder:Object(a.b)(r.a,{children:Object(a.b)(o.a,{})}),threshold:600,children:d.map((function(t){return t.target?Object(a.b)(x,{item:t,sort:h},t.target.id):null}))})]})})}))},1327:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var a=n(13),c=n(14),r=n(15),o=n(17),i=n(9),l=n(1),s=n(2),u=n(184),d=n(11),p=n.n(d);function b(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var h=function(t){Object(r.a)(n,t);var e=b(n);function n(){return Object(a.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var t=this.props,e=t.url,n=t.className,a=t.style;return Object(l.b)("div",{className:p()("UserAvatar",n),style:a,children:Object(l.b)(u.a,{className:"UserAvatar-inner",url:e,size:160})})}}]),n}(s.Component),f=function(t){var e=t.className;return Object(l.b)("div",{className:p()(e,"UserAvatar","UserAvatar-holder")})};e.b=h},1330:function(t,e,n){"use strict";n.d(e,"a",(function(){return j}));var a=n(13),c=n(14),r=n(15),o=n(17),i=n(9),l=n(1),s=n(2),u=n.n(s),d=n(3),p=n.n(d),b=n(1107),h=n.n(b),f=n(31),m=n(74),v=n(1086);function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var j=function(t){Object(r.a)(n,t);var e=O(n);function n(){var t;Object(a.a)(this,n);for(var c=arguments.length,r=new Array(c),o=0;o<c;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={range:1,image:t.props.image},t.handleSave=function(){var e=t.editorEl.getImageScaledToCanvas(),n=t.props.type;e&&e.toBlob(t.uploadBlob,n)},t.uploadBlob=function(e){(0,t.props.uploadImage)(e,"avatar")},t.resetUpload=function(){t.setState({range:1,image:""}),t.props.resetUpload()},t}return Object(c.a)(n,[{key:"render",value:function(){var t=this,e=this.state,n=e.range,a=e.image,c=this.props,r=c.title,o=c.width,i=c.height,s=c.canvasStyle;return Object(l.b)(m.b,{onClose:this.resetUpload,className:"UploadImageModal-modal",title:"编辑".concat(r),subtitle:"调整".concat(r,"尺寸和位置"),children:Object(l.c)("div",{children:[Object(l.b)("div",{className:"UploadImageModal-container",children:Object(l.b)(h.a,{ref:function(e){t.editorEl=e},image:a,width:o,height:i,border:parseInt(o/4),color:[247,248,250,.9],scale:parseFloat(n),style:s})}),Object(l.b)(v.a,{value:n,onChange:function(e){return t.setState({range:e.target.value})}}),Object(l.b)(m.a,{children:Object(l.b)(f.c,{color:"blue",preset:"primary",onClick:this.handleSave,children:"保存"})})]})})}}]),n}(u.a.Component);j.propTypes={resetUpload:p.a.func,uploadImage:p.a.func,image:p.a.string,type:p.a.string,width:p.a.number,height:p.a.number,title:p.a.string},j.defaultProps={title:"头像",type:"image/png",width:160,height:160,canvasStyle:{width:"240px",height:"240px"}}},1391:function(t,e,n){"use strict";var a=n(43),c=n.n(a),r=n(57),o=n(13),i=n(14),l=n(15),s=n(17),u=n(9),d=n(1),p=n(3),b=n.n(p),h=n(2),f=n(11),m=n.n(f),v=n(1652),O=n(1325),j=n(982),g=n(256),y=n(1327),C=n(1330);function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var T=function(t){Object(l.a)(n,t);var e=w(n);function n(){var t;return Object(o.a)(this,n),(t=e.call(this)).loadImage=function(t){return new Promise((function(e,n){var a=new Image;a.src=window.URL.createObjectURL(t),a.onload=function(){return e({width:a.width,height:a.height})},a.onerror=n}))},t.beforeUpload=function(){var e=Object(r.a)(c.a.mark((function e(n){var a,r,o,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return t.resetUpload(),e.abrupt("return",!1);case 3:if(!(n.size>5242880)){e.next=7;break}return t.props.handleShowNotifcation("请上传小于 ".concat(5,"M 的图片。")),t.resetUpload(),e.abrupt("return",!1);case 7:return e.prev=7,e.next=10,t.loadImage(n);case 10:a=e.sent,r=a.width,o=a.height,l=(i=r>o?o:r)>1440?1440:i,t.setState({width:l,height:l}),e.next=23;break;case 18:return e.prev=18,e.t0=e.catch(7),t.props.handleShowNotifcation("上传错误，请重新上传"),t.resetUpload(),e.abrupt("return",!1);case 23:Object(g.a)(n).then((function(e){t.setState({modalShown:!0,image:window.URL.createObjectURL(e),type:n.type})}));case 24:case"end":return e.stop()}}),e,null,[[7,18]])})));return function(t){return e.apply(this,arguments)}}(),t.resetUpload=function(){t.setState({modalShown:!1},(function(){t.inputEl.value=""}))},t.state={modalShown:!1,maskShown:!1,width:0,height:0},t}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(t){var e=this,n=this.props,a=n.avatarUpload,c=n.updateProfile,r=t.avatarUpload;(r&&!a||a&&r&&a.id!==r.id)&&c({avatarUrl:r.url},{avatarHash:r.id}).then((function(){return e.resetUpload()}))}},{key:"render",value:function(){var t=this,e=this.props,n=e.url,a=e.className,c=e.style,r=e.inEditPage,o=e.round,i=e.uploadImage,l=this.state,s=l.modalShown,u=l.maskShown,p=l.image,b=l.type,h=l.width,f=l.height;return Object(d.c)("div",{className:m()("UserAvatarEditor",a),onMouseEnter:function(){return t.setState({maskShown:!0})},onMouseLeave:function(){return t.setState({maskShown:!1})},style:c,children:[Object(d.b)(y.b,{url:n,className:m()({"UserAvatar-round":o})}),Object(d.b)(j.a,{accept:"image/png,image/jpeg",onRef:function(e){t.inputEl=e},beforeUpload:this.beforeUpload,children:Object(d.c)(O.a,{className:"UserAvatarEditor-mask",maskClassName:m()("UserAvatarEditor-maskInner",{"UserAvatarEditor-maskRoundInner":o}),shown:r||u,children:[Object(d.b)(v.a,{size:36,className:"UserAvatarEditor-cameraIcon"}),Object(d.b)("div",{className:"UserAvatarEditor-maskInnerText",children:"修改我的头像"})]})}),s&&Object(d.b)(C.a,{resetUpload:this.resetUpload,image:p,uploadImage:i,type:b,width:h,height:f})]})}}]),n}(h.Component);T.propTypes={url:b.a.string,handleShowNotifcation:b.a.func,avatarUpload:b.a.object,updateProfile:b.a.func.isRequired,inEditPage:b.a.bool,round:b.a.bool},T.defaultProps={inEditPage:!0};e.a=T},1504:function(t,e,n){"use strict";var a=n(2),c=n.n(a),r=n(21),o=function(t){return c.a.createElement(r.a,t,c.a.createElement("path",{d:"M17.917 6.713a.166.166 0 0 1-.274-.142l.252-2.887a.164.164 0 0 1 .02-.065.165.165 0 0 1 .225-.067l1.919 1.037a.167.167 0 0 1 .029.274l-2.171 1.85zm2.893-.257l.13 1.47c0 .014 0 .03-.003.044a.168.168 0 0 1-.195.133l-2.17-.409a.17.17 0 0 1-.118-.087.167.167 0 0 1 .072-.225l2.041-1.059a.166.166 0 0 1 .243.133zm-4.387-.017l-1.75-1.78a.167.167 0 0 1 .058-.272l1.547-.607a.167.167 0 0 1 .227.141l.203 2.387a.167.167 0 0 1-.285.131zm1.76 2.284l1.57 4.292a4.774 4.774 0 0 1-1.65 5.462l-.259.19a5.48 5.48 0 0 1-3.252 1.073c-.355 0-.709-.048-1.059-.117a4.779 4.779 0 0 1-1.658.3 4.89 4.89 0 0 1-3.144-1.139 45.328 45.328 0 0 0-.716-.587c-.498-.399-1.649-1.52-3.516-3.43a1.847 1.847 0 0 1-.225-2.287c.036-.056.077-.11.134-.176a1.749 1.749 0 0 1-.196-2.367c.125-.144.248-.256.375-.344a1.839 1.839 0 0 1 .3-1.595l.085-.106c.3-.335.707-.53 1.15-.556.338-.024.667.08.954.258.036-.06.065-.125.108-.182l.104-.127a1.86 1.86 0 0 1 1.82-.568 1.91 1.91 0 0 1 2.771-.28l.447.393.112-.135c.205-.247.473-.437.775-.547a1.799 1.799 0 0 1 1.385.06 1.8 1.8 0 0 1 .937 1.022l.114.311a1.967 1.967 0 0 1 1.506.066c.48.223.845.62 1.027 1.116zm-1.138 8.855l.26-.19a3.419 3.419 0 0 0 1.18-3.909l-1.572-4.292a.634.634 0 0 0-.904-.333l-.157.09a.796.796 0 0 0-.36.964l.228.64a.428.428 0 0 1-.252.542.499.499 0 0 1-.429-.08l-4.05-3.559a.553.553 0 0 0-.78.051.59.59 0 0 0 .022.803l2.742 2.48a.35.35 0 1 1-.476.514l-2.71-2.45-.038-.037-.734-.663a.513.513 0 0 0-.72.036c-.244.322-.208.721.055.963l3.371 3.106a.35.35 0 0 1-.47.52l-2.97-2.643a.485.485 0 0 0-.687.04.614.614 0 0 0 .05.844l3.028 2.763a.35.35 0 0 1-.467.521l-1.943-1.704a.38.38 0 0 0-.27-.092.375.375 0 0 0-.257.127c-.21.316-.177.672.051.906 1.901 1.958 3.1 3.14 3.56 3.508.207.165.556.402 1.036.704a4.127 4.127 0 0 0 4.663-.17zm-11.76-3.58c1.811 1.851 2.96 2.974 3.417 3.34.166.132.411.333.734.603.607.507 1.33.78 2.068.848a12.302 12.302 0 0 1-1-.69c-.518-.414-1.689-1.565-3.686-3.62a2.038 2.038 0 0 1-.55-1.116l-.435-.373a.428.428 0 0 0-.279-.103l-.033.001a.429.429 0 0 0-.292.147c-.224.337-.187.714.056.963zm.18-3.585a.534.534 0 0 0-.37.182.651.651 0 0 0 .057.9l1.156 1.04c.055-.208.141-.41.264-.6l.034-.05a1.952 1.952 0 0 1-.49-1.11l-.262-.23a.514.514 0 0 0-.39-.132zm.718-1.979a.562.562 0 0 0-.387.186c-.259.342-.219.764.062 1.02l.341.31a1.92 1.92 0 0 1 .383-.673c.074-.083.153-.158.237-.224-.02-.098-.024-.198-.03-.297l-.2-.18a.589.589 0 0 0-.406-.142zm7.102-1.038l-.132.16 1.203 1.056c.092-.169.208-.324.343-.463l-.198-.543a.714.714 0 0 0-1.216-.21z",fillRule:"evenodd"}))};o.defaultProps={name:"Clap"},e.a=o},1523:function(t,e,n){"use strict";n.d(e,"a",(function(){return A}));var a=n(13),c=n(14),r=n(15),o=n(17),i=n(9),l=n(1),s=n(2),u=n(3),d=n.n(u),p=n(11),b=n.n(p),h=n(2627),f="TopicVoteCheckbox";function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var v=[0,1,2,3,4,5,6,7].map((function(t){return Object(l.b)("div",{className:"".concat(f,"-Sparkle")},t)}));function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var j={Recommend:function(t){Object(r.a)(n,t);var e=m(n);function n(){return Object(a.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var t=this.props,e=t.className,n=t.onChange,a=t.checked,c=t.onClick,r=t.tooltipPosition;return Object(l.c)("div",Object.assign(Object.assign({className:b()(f,"".concat(f,"--recommend"),e),"data-tooltip":"推荐"},r&&{"data-tooltip-position":r}),{},{children:[Object(l.b)("input",{id:"topic-recommend",type:"checkbox",checked:a,onChange:n,onClick:c}),Object(l.c)("label",{htmlFor:"topic-recommend",children:[Object(l.b)(h.a,{size:19}),v]})]}))}}]),n}(s.Component),Against:function(t){Object(r.a)(n,t);var e=O(n);function n(){return Object(a.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var t=this.props,e=t.className,n=t.onChange,a=t.checked,c=t.onClick,r=t.tooltipPosition;return Object(l.c)("div",Object.assign(Object.assign({className:b()(f,"".concat(f,"--against"),e),"data-tooltip":"不推荐"},r&&{"data-tooltip-position":r}),{},{children:[Object(l.b)("input",{id:"topic-against",type:"checkbox",checked:a,onChange:n,onClick:c}),Object(l.b)("label",{htmlFor:"topic-against",children:Object(l.b)(h.a,{size:19})})]}))}}]),n}(s.Component)};function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var y=function(t){return t.stopPropagation()},C=function(t){Object(r.a)(n,t);var e=g(n);function n(){return Object(a.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var t=this.props,e=t.noAnimation,n=t.status,a=t.onVoteChange,c=t.tooltipPosition;return Object(l.b)("span",{className:"VotableTopicCard",onClick:y,children:Object(l.c)("span",{className:b()("VotableTopicCard-RecommendStatus",{"VotableTopicCard-VoteActions--noAnimation":e}),children:[Object(l.b)(j.Recommend,{className:"".concat("VotableTopicCard","-VoteCheckbox"),checked:"like"===n,onChange:function(t){a(t,"recommend")},tooltipPosition:c}),Object(l.b)(j.Against,{className:"".concat("VotableTopicCard","-VoteCheckbox"),checked:"dislike"===n,onChange:function(t){a(t,"unrecommend")},tooltipPosition:c})]})})}}]),n}(s.Component);C.propTypes={noAnimation:d.a.bool.isRequired,status:d.a.oneOf(["like","dislike","none"]).isRequired,noBorder:d.a.bool.isRequired,onVoteChange:d.a.func.isRequired,tooltipPosition:d.a.string};var w=C,T=n(30),R=n(377),k=n(25);function I(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var N="Upvote",x="UnUpvote",S="Downvote",E="UnDownvote",A=function(t){Object(r.a)(n,t);var e=I(n);function n(){var t;Object(a.a)(this,n);for(var c=arguments.length,r=new Array(c),o=0;o<c;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={noAnimation:!!t.props.metaInfo.vote&&"none"!==t.props.metaInfo.vote.status},t.handleVoteChange=t.context.authRequired((function(e,n){var a=t.props,c=a.metaInfo.vote.status,r=a.onUpdateVoteTopic;t.state.noAnimation&&t.setState({noAnimation:!1});var o={actionType:"",voteFor:"",method:""};"recommend"===n?"like"===c?(o.actionType=x,o.voteFor="like",o.method="DELETE"):(o.actionType=N,o.voteFor="like",o.method="POST"):"dislike"===c?(o.actionType=E,o.voteFor="dislike",o.method="DELETE"):(o.actionType=S,o.voteFor="dislike",o.method="POST"),o.actionType&&(T.a.trackEvent(e.target,{action:o.actionType,id:4176}),r(o))}),k.X.vote),t}return Object(c.a)(n,[{key:"renderVotableTopicCard",value:function(){var t=this.state.noAnimation,e=this.props,n=e.tooltipPosition,a=e.metaInfo,c=(a=void 0===a?{}:a).vote,r=(c=void 0===c?{}:c).status;return Object(l.b)(w,{noBorder:!0,status:r,noAnimation:t,onVoteChange:this.handleVoteChange,tooltipPosition:n})}},{key:"renderReviewCardExtraInfo",value:function(){var t=this.props,e=t.metaInfo,n=e.name,a=e.vote,c=e.meta,r=(c=void 0===c?{}:c).title,o=t.ReviewCardExtraInfoComponent,i=t.reviewerCountFormatter;if(!o)return null;var s,u=a.totalVotes,d=a.ratio,p=a.ratioStatus,b=a.status,h=(10*d).toFixed(1),f=i(u);return s="none"===b?"你推荐么？":"like"===b?"已推荐":"不推荐",Object(l.b)(o,{reviewerCount:f,insufficientText:s,percent:h,ratioStatus:p,title:r||n})}},{key:"render",value:function(){return Object(l.c)(s.Fragment,{children:[this.renderReviewCardExtraInfo(),this.props.children,this.renderVotableTopicCard()]})}}]),n}(s.Component);A.propTypes={onUpdateVoteTopic:d.a.func.isRequired,metaInfo:d.a.shape({meta:d.a.object,vote:d.a.shape({status:d.a.oneOf(["none","dislike","like"]).isRequired})}),ReviewCardExtraInfoComponent:d.a.oneOfType([d.a.func,d.a.string,d.a.object]).isRequired,reviewerCountFormatter:d.a.func.isRequired,tooltipPosition:d.a.string},A.defaultProps={reviewerCountFormatter:function(t){return Object(R.cnNiceNumber)(t).trim()}},A.contextTypes={authRequired:d.a.func}},1652:function(t,e,n){"use strict";var a=n(2),c=n.n(a),r=n(21),o=function(t){return c.a.createElement(r.a,t,c.a.createElement("path",{d:"M20.094 6S22 6 22 8v10.017S22 20 19 20H4.036S2 20 2 18V7.967S2 6 4 6h3s1-2 2-2h6c1 0 2 2 2 2h3.094zM12 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0 1.5a5 5 0 1 0-.001-10.001A5 5 0 0 0 12 17.5zm7.5-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z",fillRule:"evenodd"}))};o.defaultProps={name:"Camera"},e.a=o},1831:function(t,e,n){"use strict";var a=n(2),c=n.n(a),r=n(21),o=function(t){return c.a.createElement(r.a,t,c.a.createElement("path",{d:"M8.493 10h12.014c.83 0 1.493.672 1.493 1.5 0 .834-.668 1.5-1.493 1.5H8.493C7.663 13 7 12.328 7 11.5c0-.834.668-1.5 1.493-1.5zm0 6h12.014c.83 0 1.493.672 1.493 1.5 0 .834-.668 1.5-1.493 1.5H8.493C7.663 19 7 18.328 7 17.5c0-.834.668-1.5 1.493-1.5zM3.5 4C4.334 4 5 4.672 5 5.5 5 6.334 4.328 7 3.5 7 2.666 7 2 6.328 2 5.5 2 4.666 2.672 4 3.5 4zm0 6c.834 0 1.5.672 1.5 1.5 0 .834-.672 1.5-1.5 1.5-.834 0-1.5-.672-1.5-1.5 0-.834.672-1.5 1.5-1.5zm0 6c.834 0 1.5.672 1.5 1.5 0 .834-.672 1.5-1.5 1.5-.834 0-1.5-.672-1.5-1.5 0-.834.672-1.5 1.5-1.5zM8.493 4h12.014C21.337 4 22 4.672 22 5.5c0 .834-.668 1.5-1.493 1.5H8.493C7.663 7 7 6.328 7 5.5 7 4.666 7.668 4 8.493 4z",fillRule:"evenodd"}))};o.defaultProps={name:"List"},e.a=o},2193:function(t,e,n){"use strict";var a=n(2),c=n.n(a),r=n(21),o=function(t){return c.a.createElement(r.a,t,c.a.createElement("path",{d:"M9.035 19.433a.5.5 0 1 1-.37.93 8.981 8.981 0 0 1-2.682-1.668.5.5 0 1 1 .669-.744 7.974 7.974 0 0 0 2.383 1.482zm-4.938-6.186c.136.871.414 1.709.825 2.489a.5.5 0 1 1-.883.467 8.966 8.966 0 0 1-.931-2.802.5.5 0 0 1 .989-.154zm8.009-9.246A.501.501 0 0 1 12.113 3h.007a8.959 8.959 0 0 1 3.103.594.5.5 0 1 1-.358.934 8.003 8.003 0 0 0-2.759-.527zM6.73 5.831a.502.502 0 0 1-.311-.892 8.977 8.977 0 0 1 2.583-1.428.5.5 0 0 1 .333.943A7.95 7.95 0 0 0 7.04 5.723a.498.498 0 0 1-.31.108zM5.01 7.136a.501.501 0 0 1 .165.688 7.942 7.942 0 0 0-1.023 2.614.5.5 0 0 1-.981-.194 8.922 8.922 0 0 1 1.151-2.943.5.5 0 0 1 .688-.165zm12.917-1.908a8.981 8.981 0 0 1 1.874 2.28.5.5 0 0 1-.866.5 8.023 8.023 0 0 0-1.666-2.027.5.5 0 0 1 .658-.753zm2.367 4.843a.498.498 0 0 1 .577.408 9.19 9.19 0 0 1-.02 3.159.501.501 0 0 1-.984-.18A8.23 8.23 0 0 0 20 11.999c0-.455-.038-.911-.114-1.351a.5.5 0 0 1 .408-.577zm-.728 5.839a.498.498 0 0 1 .173.686 9.033 9.033 0 0 1-1.903 2.255.498.498 0 0 1-.705-.057.501.501 0 0 1 .057-.705 8.003 8.003 0 0 0 1.692-2.005.5.5 0 0 1 .686-.174zm-4.8 3.6a.498.498 0 1 1 .345.937A8.962 8.962 0 0 1 12 21l-.24-.002a.501.501 0 0 1-.487-.513.489.489 0 0 1 .513-.487l.208.002c.958 0 1.888-.165 2.772-.49zM12.8 11.2h1.9a.8.8 0 1 1 0 1.6h-1.9v1.9a.8.8 0 1 1-1.6 0v-1.9H9.3a.8.8 0 1 1 0-1.6h1.9V9.3a.8.8 0 1 1 1.6 0v1.9z",fillRule:"evenodd"}))};o.defaultProps={name:"Add"},e.a=o},2204:function(t,e,n){"use strict";var a=n(2),c=n.n(a),r=n(21),o=function(t){return c.a.createElement(r.a,t,c.a.createElement("path",{d:"M13.004 7V4.232c0-.405.35-.733.781-.733.183 0 .36.06.501.17l6.437 5.033c.331.26.376.722.1 1.033a.803.803 0 0 1-.601.264H2.75a.75.75 0 0 1-.75-.75V7.75A.75.75 0 0 1 2.75 7h10.254zm-1.997 9.999v2.768c0 .405-.35.733-.782.733a.814.814 0 0 1-.5-.17l-6.437-5.034a.702.702 0 0 1-.1-1.032.803.803 0 0 1 .6-.264H21.25a.75.75 0 0 1 .75.75v1.499a.75.75 0 0 1-.75.75H11.007z",fillRule:"evenodd"}))};o.defaultProps={name:"Switch"},e.a=o},2205:function(t,e,n){t.exports=n.p+"assets/sogou.cedc2606.png"},2206:function(t,e,n){var a=n(229),c=n(612),r=Object.prototype.hasOwnProperty,o=c((function(t,e,n){r.call(t,n)?t[n].push(e):a(t,n,[e])}));t.exports=o},2660:function(t,e,n){"use strict";n.r(e);var a=n(42),c=n(1),r=n(37),o=n(13),i=n(14),l=n(15),s=n(17),u=n(9),d=n(2),p=n.n(d),b=n(112),h=n.n(b),f=n(24),m=n(184),v=n(833),O=n(30),j=n(51),g=function(t){var e=t.sidebar,n=t.children;return Object(c.c)("div",{className:"ContentLayout",children:[Object(c.b)("div",{className:"ContentLayout-mainColumn",children:n}),Object(c.b)("div",{className:"ContentLayout-sideColumn",children:e})]})},y=n(844),C=n(1008),w=n(107),T={n_game:"游戏",n_edu:"学校",n_artist:"娱乐人物",n_esports:"电子竞技",n_movie:"电影",n_tv:"电视剧",n_variety_show:"综艺节目",n_team:"球队",n_sports:"赛事",n_wiki:"百科",n_goods:"商品",n_wiki_zhihu:"知乎百科",n_city:"城市",n_trip:"旅游",n_food:"美食",n_place:"景点",n_car:"汽车品牌"},R={0:"rectangle",1:"square",2:"round",10:"smallRectangle",11:"smallSquare",12:"smallRound"},k="n_wiki_zhihu",I=n(18),N=n(31),x=n(1391),S=n(158),E=n(839),A=n(1132),B=n(3),M=n.n(B),P=n(139),z=n(403),L=n(1010),U=n(328),D=n(1001);function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var V=function(t){Object(l.a)(n,t);var e=W(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={editing:!1,value:t.props.value},t.handleToggleEditing=function(){t.setState({editing:!t.state.editing})},t.handleChange=function(e){t.setState({value:e.target.value})},t.handleSubmit=function(e){e.preventDefault(),t.props.onSave(t.state.value),t.handleToggleEditing()},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.className,n=t.canEdit,a=t.children,r=t.placeholder,o=t.max,i=t.rich,l=this.state,s=l.editing,u=l.value,d={value:u,onChange:this.handleChange,placeholder:r,autoFocus:!0,className:"ModifyField-input"};return s?Object(c.c)("form",{className:e,onSubmit:this.handleSubmit,noValidate:!0,children:[i?Object(c.b)(L.a,Object.assign({rows:3},d)):Object(c.b)(P.a,Object.assign({spread:!0},d)),Object(c.c)("div",{className:"ModifyField-actionBar",children:[Object(c.c)("div",{className:"ModifyField-buttonGroup",children:[Object(c.b)(N.c,{color:"blue",preset:"primary",type:"submit",children:"保存"}),Object(c.b)(N.c,{onClick:this.handleToggleEditing,children:"取消"})]}),o&&Object(c.b)(z.a,{current:Math.round(Object(U.stringWidth)(u)/2),max:o})]})]}):Object(c.c)("div",{className:e,children:[a||u,n&&Object(c.b)(D.a,Object.assign({preset:"plain",className:"ModifyField-modifyButton",onClick:this.handleToggleEditing},u?null:{text:r}))]})}}]),n}(d.Component);V.propTypes={placeholder:M.a.string},V.defaultProps={placeholder:"编辑"};var _=V,F=function(){var t=document.getElementById("TopicMain"),e=document.querySelector(".AppHeader"),n=t.offsetTop-e.offsetHeight-10;window.scroll(0,n)},q=n(11),H=n.n(q),G=n(21),K=function(t){return p.a.createElement(G.a,t,p.a.createElement("path",{d:"M16.886 3A4.114 4.114 0 0 1 21 7.114v9.772A4.114 4.114 0 0 1 16.886 21H7.114A4.114 4.114 0 0 1 3 16.886V7.114A4.114 4.114 0 0 1 7.114 3h9.772zM7.542 14.793l-.595 1.985a.22.22 0 0 0 .275.275l1.984-.595a2.36 2.36 0 0 0 .991-.592l4.82-4.82a.295.295 0 0 0 0-.416L13.37 8.983a.295.295 0 0 0-.417 0l-4.82 4.82c-.275.277-.478.617-.59.99zm9.272-6.826l-.781-.78a.849.849 0 0 0-1.202 0l-.952.951c-.11.11-.11.29 0 .4l1.582 1.583a.283.283 0 0 0 .4 0l.953-.952a.85.85 0 0 0 0-1.202z"}))};K.defaultProps={name:"EditRounded"};var Z=K,Q=n(832),X=n(1831),J=n(2193),Y=n(2578),$=n(2592),tt=n(159),et=n(104),nt=n(847),at=n(190),ct=n(74);function rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var ot=function(t){Object(l.a)(n,t);var e=rt(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={shown:!1,value:"",items:[]},t.handleToggle=function(){t.checkItems().then((function(){return t.setState({shown:!t.state.shown})}))},t.handleChange=function(e){return t.setState({input:e})},t.handleSelect=function(e,n){return t.setState({value:n.id})},t.handleClick=function(){var e=t.props,n=e.params.id,a=e.router,c=t.state.value;a.push("/topic/".concat(n,"/create/").concat(c))},t.checkItems=function(){var e=t.props,n=e.items,a=e.loadMetaCategories;return Promise.resolve(n||a())},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.state,e=t.shown,n=t.input,a=t.value,r=(this.props.items||[]).filter((function(t){return t.desc.includes(n||"")})).map((function(t){return{id:t.name,name:t.desc}}));return Object(c.c)(d.Fragment,{children:[Object(c.b)(N.c,Object.assign(Object.assign({},this.props),{},{onClick:this.handleToggle})),Object(c.b)(ct.b,{title:"选择话题类型",subtitle:"请为话题选择对应合适实体类型",onClose:this.handleToggle,children:e&&Object(c.c)("div",{className:"TopicCreateMeta",children:[Object(c.b)(at.b,{value:n,items:r,menuProps:{menuClassName:"TopicCreateMeta-selectMenu"},onChange:this.handleChange,onSelect:this.handleSelect,inputProps:{placeholder:"选择话题类型",autoFocus:!0}}),Object(c.b)(N.c,{className:"TopicCreateMeta-submit",preset:"primary",color:"blue",onClick:this.handleClick,disabled:!a,children:"下一步"})]})})]})}}]),n}(d.Component),it=Object(I.compose)(r.withRouter,Object(f.connect)((function(t){return{items:Object(tt.J)(t)}}),{loadMetaCategories:tt.v}))(ot),lt=function(t){var e=t.headerCard,n=(e=void 0===e?{}:e).config,a=(n=void 0===n?{}:n).avatarType;return["rectangle","square"][void 0===a?0:a]};function st(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var ut=function(t){Object(l.a)(n,t);var e=st(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props;(0,t.loadTopicWikiEditInfo)(t.params.id)}},{key:"render",value:function(){var t=this.props,e=t.className,n=t.topic,a=t.currentUser,r=void 0===a?{}:a,o=t.hasTopicIntro,i=t.wikiEditInfo,l=(i=void 0===i?{}:i).canEdit,s=i.hasCommit,u=n.id,d=n.type,p=n.name,b=n.meta,h=n.isFollowing,f=n.isIndexEditable,m=n.relationship,v=void 0===m?{}:m,O="/topic/".concat(u),j="square"===lt(n);return Object(c.c)("div",{className:H()("TopicActions",e),children:[Object(c.b)(y.a,{className:H()("TopicActions-followButton",{"TopicActions-followButton--large":j}),preset:"primary",id:u,type:d,isFollowing:h}),f&&Object(c.b)(et.a,{icon:Z,className:"TopicActions-link",preset:"plain",to:"".concat(O,"/index_edit"),label:"编辑索引",a:!0}),!r.isOrg&&Object(c.b)(et.a,{className:"TopicActions-link",icon:Q.a,preset:"plain",to:"".concat(O,"/organize"),label:"管理",a:!0}),Object(c.b)(et.a,{className:"TopicActions-link",preset:"plain",to:"".concat(O,"/log"),icon:X.a,label:"日志",a:!0}),Object(c.b)(nt.a,{className:"TopicActions-shareMenu",id:u,type:d,title:p}),!b&&v.isMetaEditable&&Object(c.b)(it,{icon:J.a,className:"TopicActions-link",preset:"plain",label:"添加更多信息"}),s&&Object(c.b)(et.a,{className:"TopicActions-link",preset:"plain",to:"/topic/".concat(u,"/my-contribution"),icon:Y.a,label:"查看提交内容",a:!0}),!s&&l&&Object(c.b)(et.a,{className:"TopicActions-link",preset:"plain",to:"/topic/".concat(u,"/wiki-editor"),icon:$.a,label:o?"编辑百科":"新建百科",a:!0})]})}}]),n}(d.Component),dt=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{wikiEditInfo:Object(tt.eb)(t,{id:n.id}),hasTopicIntro:Object(tt.i)(t,{id:n.id})}}),{loadTopicWikiEditInfo:tt.G}))(ut),pt=n(252),bt=n(46),ht=n(26),ft=n(38),mt=n(899);function vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ot,jt=function(t){Object(l.a)(n,t);var e=vt(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={shouldShowMoreIcon:!1},t.introContainer=Object(d.createRef)(),t.handleToggleExpand=function(){var e=t.props,n=e.router,a=e.topic.id;n.push("/topic/".concat(a,"/intro")),F()},t.handleUpload=function(e){var n=t.props;return(0,n.uploadImage)(e,n.uploadId)},t.handleUpdateAvatar=function(e,n){return t.handleUpdate(n)},t.handleUpdateName=function(e){return t.handleUpdate({name:e})},t.handleUpdateIntroduction=function(e){return t.handleUpdate({introduction:e})},t.handleUpdate=function(e){var n=t.props;return(0,n.updateTopic)(n.topic.id,e)},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.introContainer.current;if(t){(0,this.props.fillCurrentUserIfNeeded)(["canEditTopic"]);var e=t.offsetHeight,n=this.props,a=n.topic.id,c=n.setShowIntro,r=e>78;this.setState({shouldShowMoreIcon:r}),r&&c(a)}}},{key:"renderIntroText",value:function(){return this.state.shouldShowMoreIcon?Object(c.b)(N.c,{preset:"link",className:"TopicCard-linkIcon",onClick:this.handleToggleExpand,children:"查看全部内容"}):null}},{key:"render",value:function(){var t=this.state.shouldShowMoreIcon,e=this.props,n=e.currentUser,a=e.topic,r=e.topicAvatar,o=a.name,i=a.introduction,l=a.type,s=a.longExcerpt,u=a.excerpt,d=i||"暂无话题描述";"topic"===l&&(d=s||u||"暂无话题描述");var p=n&&n.canEditTopic,b=Object(S.imgUrl)(a.avatarUrl);return Object(c.c)("div",{className:"TopicCard",children:[Object(c.b)(E.e,{className:"TopicCard-content",title:Object(c.b)(_,{className:"TopicCard-title",value:o,onSave:this.handleUpdateName,canEdit:p,placeholder:"编辑话题标题",max:54,children:Object(c.b)("h1",{className:"TopicCard-titleText",children:o})}),image:p?Object(c.b)(x.a,{inEditPage:!1,url:b,className:"TopicCard-image ImageAlias",updateProfile:this.handleUpdateAvatar,uploadImage:this.handleUpload,handleShowNotifcation:this.props.showNotification,avatarUpload:r}):Object(c.b)(A.a,{className:"TopicCard-image",src:b,alt:""}),meta:Object(c.b)(_,{className:"TopicCard-description",canEdit:p,value:d,onSave:this.handleUpdateIntroduction,placeholder:"添加话题描述",max:350,rich:!0,children:Object(c.c)("div",{className:"TopicCard-ztext",ref:this.introContainer,children:[t?Object(mt.b)(d,95):d,this.renderIntroText()]})})}),Object(c.b)("div",{className:"TopicCard-actions",children:Object(c.b)(dt,{topic:a})})]})}}]),n}(d.Component),gt=Object(I.compose)(Object(f.connect)((function(t,e){var n=e.topic;if(!n)return{};var a=function(t){return"topic_".concat(t.id,"_avatar")}(n);return{uploadId:a,topicAvatar:Object(pt.c)(t,{id:a}),currentUser:Object(ft.b)(t)}}),{updateTopic:tt.jb,uploadImage:pt.b,showNotification:ht.h,fillCurrentUserIfNeeded:ft.e,setShowIntro:bt.J}),r.withRouter)(jt),yt=n(0),Ct=n(280),wt=n(1526),Tt=n(376),Rt=n(380),kt=n(1523),It=Object(I.compose)(Object(f.connect)((function(t,e){return{metaInfo:t.entities.topics[e.topicId]}}),(function(t,e){var n=e.topicId;return{onUpdateVoteTopic:function(e){var a=e.voteFor,c=e.method;return t(Object(bt.I)({id:n,voteFor:a,method:c}))}}})),r.withRouter)(kt.a),Nt=n(837),xt=n(383),St=n.n(xt),Et=function(t){var e=t.percent,n=t.reviewerCount,a=t.insufficientText,r=t.ratioStatus;return Object(c.b)("div",{className:"TopicVoteReviewCardExtraInfo-RecommendData",children:"normal"===r?Object(c.c)(d.Fragment,{children:[Object(c.b)("div",{className:"TopicVoteReviewCardExtraInfo-RecommendPercent",children:"".concat((10*e).toFixed(),"%")}),Object(c.c)("div",{children:[Object(c.b)("div",{className:"TopicVoteReviewCardExtraInfo-RecommendText",children:"知友推荐"}),Object(c.b)("div",{className:"TopicVoteReviewCardExtraInfo-RecommendSubText",children:St()(Ot||(Ot=Object(Nt.a)(["","人评价"])),n)})]})]}):Object(c.c)(d.Fragment,{children:[Object(c.b)("div",{className:"TopicVoteReviewCardExtraInfo-RecommendNoData TopicVoteReviewCardExtraInfo-RecommendText",children:a}),Object(c.b)("div",{className:"TopicVoteReviewCardExtraInfo-RecommendSubText",children:Object(c.c)("p",{className:"TopicVoteReviewCardExtraInfo-LessPeople",children:["评价人数不足",Object(c.b)("br",{}),"数据积累中"]})})]})})};function At(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Bt=function(t){Object(l.a)(n,t);var e=At(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.topicId,n=t.metaInfo,a=n.vote,r=n.isVote;if(!a||!r)return null;var o=["like","dislike"].includes(a.status);return Object(c.b)(Tt.a,{view:{id:4174,name:o?"已评价":"未评价"},card:{content:{type:"Topic",token:e}},trackCardShow:!0,children:Object(c.b)(v.d,{className:"TopicVoteReviewCard-RecommendContainer",children:Object(c.b)(It,{topicId:e,ReviewCardExtraInfoComponent:Et,tooltipPosition:"bottom"})})})}}]),n}(d.Component),Mt=Object(I.compose)(Object(Rt.a)(null),Object(f.connect)((function(t,e){return{metaInfo:t.entities.topics[e.topicId]}})))(Bt);function Pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var zt=["variety_show","tv","movie","book","game","n_artist","n_sports","n_game","n_variety_show","n_movie","n_tv"];var Lt=function(t){Object(l.a)(n,t);var e=Pt(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleReadMore=function(){var e=t.props,n=e.router,a=e.topic.id;n.push("/topic/".concat(a,"/intro")),F()},t}return Object(i.a)(n,[{key:"renderDesc",value:function(){var t,e,n,a=this.props,r=a.topic,o=r.category,i=r.headerCard,l=r.isVote,s=r.vote,u=a.item,d=i.description1,p=i.description2,b=i.wikiDescription,h=null==u||null===(t=u.modules)||void 0===t||null===(e=t.find((function(t){return"introduction"===t.target.name})))||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value,f=null;if(b&&(f=b.length<108?b+"...":Object(mt.b)(b,98)),o&&o.startsWith("n_wiki"))return Object(c.c)("div",{className:"TopicMetaCard-description TopicMetaCard-wikiDescription",children:[f,b&&Object(c.b)(Ct.c,{preset:"link",className:"TopicMetaCard-linkIcon",onClick:this.handleReadMore,children:"查看全部内容"})]});var m=zt.includes(o);return Object(c.c)("div",{className:"TopicMetaCard-description",children:[m?Object(c.c)("div",{className:"TopicMetaCard-description-container",children:[Object(c.b)("div",{className:"TopicMetaCard-description1",children:d}),Object(c.b)("div",{className:"TopicMetaCard-description2",children:p})]}):Object(mt.b)(h||d+p||"",l&&s?75:98),!m&&Object(c.b)(Ct.c,{preset:"link",className:"TopicMetaCard-linkIcon",onClick:this.handleReadMore,children:"查看全部内容"})]})}},{key:"renderUnpublishedCard",value:function(t){return Object(c.c)("div",{className:"TopicMetaCard-UnpublishedContainer",children:[Object(c.b)("div",{className:"TopicMetaCard-UnpublishedText",children:"暂无评分"}),Object(c.b)("div",{className:"TopicMetaCard-UnpublishedSubText",children:t}),Boolean(t)&&Object(c.b)("div",{className:"TopicMetaCard-UnpublishedSubText",children:"上映"})]})}},{key:"render",value:function(){var t=this.props,e=t.topic,n=e.headerCard,a=e.id,r=t.topic,o=t.currentUser;if(!n)return null;var i=n.title,l=n.subtitle,s=n.avatarUrl,u=n.pubInfo,d=void 0===u?{}:u,p=d.pubDate,b=1===d.status||2===d.status,h=lt(r);return Object(c.c)("div",{className:H()("TopicMetaCard",Object(yt.a)({},"TopicMetaCard--".concat(h,"Image"),h)),children:[Object(c.b)("div",{className:"TopicMetaCard-voteCard",children:b?this.renderUnpublishedCard(p):Object(c.b)(Mt,{topicId:a})}),Object(c.b)(E.e,{className:"TopicMetaCard-item",image:Object(c.b)(A.a,{className:"TopicMetaCard-image",alt:"",src:Object(S.imgUrl)(s)}),title:Object(c.b)("div",{className:"TopicMetaCard-title",children:i}),meta:Object(c.c)("div",{className:"TopicMetaCard-MetaMagicWrapper",children:[Object(c.c)("div",{className:"TopicMetaCard-content",children:[l&&Object(c.b)("div",{className:"TopicMetaCard-label",children:l}),this.renderDesc()]}),Object(c.b)(dt,{className:"TopicMetaCard-actions",topic:r,currentUser:o})]})})]})}}]),n}(d.Component);Lt.Badge=function(t){var e=t.url,n=t.from,a=t.score,r=t.text,o=r?Object(c.b)(wt.b,{children:r}):Object(c.c)(wt.b,{children:[Object(c.b)("strong",{className:"TopicMetaCard-badgeScore",children:a}),n]});return e?Object(c.b)("a",{className:"TopicMetaCard-badge",href:e,target:"_blank",rel:"noopener noreferrer",children:o}):Object(c.b)("span",{className:"TopicMetaCard-badge",children:o})};var Ut=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{item:Object(tt.X)(t,{id:n.id})}}),null))(Lt);function Dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Wt=function(t){Object(l.a)(n,t);var e=Dt(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"renderMeta",value:function(){var t=this.props.topic;if(t){var e=t.excerpt,n=t.id,a=t.name,r=t.avatarUrl,o=t.bestAnswersCount,i=t.unansweredCount,l=t.questionsCount,s={description:e,url:"https://www.zhihu.com/topic/".concat(n),name:a,image:r,"zhihu:bestAnswersCount":o,"zhihu:unansweredCount":i,"zhihu:questionsCount":l};return Object.keys(s).map((function(t){return Object(c.b)("meta",{itemProp:t,content:s[t]},t)}))}}},{key:"render",value:function(){var t=this.props,e=t.topic,n=t.topic.meta;return Object(c.c)("div",{itemType:"http://schema.org/Thing",itemScope:!0,children:[this.renderMeta(),n?Object(c.b)(Ut,{topic:e}):Object(c.b)(gt,{topic:e})]})}}]),n}(d.Component),Vt=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){return{topic:Object(tt.bb)(t,{id:e.params.id})}})))(Wt),_t=n(978),Ft=n(954),qt=n(929),Ht=n(1396);function Gt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Kt=function(t){Object(l.a)(n,t);var e=Gt(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={shown:!1},t.handleToggleFollowers=function(){return t.setState({shown:!t.state.shown})},t.handleLoad=function(){var e=t.props;return(0,e.loadTopicFollowers)(e.params.id)},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.state.shown,e=this.props,n=e.isFetching,a=e.isDrained,r=e.items,o=e.topic,i=o.id,l=o.followersCount,s=o.questionsCount;return Object(c.c)(v.d,{children:[Object(c.c)(qt.a,{divider:!0,children:[Object(c.b)(qt.a.Item,{className:"TopicNumberBoard-item",name:"关注者",value:l,onClick:this.handleToggleFollowers}),Object(c.b)(qt.a.Item,{className:"TopicNumberBoard-item",name:"问题数",value:s,href:"/topic/".concat(i,"/questions")})]}),Object(c.b)(ct.b,{size:"fullPage",onClose:this.handleToggleFollowers,children:t&&Object(c.b)(Ht.a,{isFetching:n,isDrained:a,items:r,voteupCount:l,onLoad:this.handleLoad,text:"关注了"})})]})}}]),n}(d.Component),Zt=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return Object.assign({topic:Object(tt.bb)(t,{id:n.id})},Object(tt.U)(t,{id:n.id}))}),{loadTopicFollowers:tt.E}))(Kt),Qt=n(377),Xt=n(853);function Jt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Yt=function(t){Object(l.a)(n,t);var e=Jt(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.params.id;(0,t.loadBestAnswerers)(e)}},{key:"render",value:function(){var t=this.props,e=t.answerers,a=t.params.id;return e&&e.length?Object(c.b)(Tt.a,{module:"UserList",moduleName:"活跃回答者",children:Object(c.c)(v.d,{children:[Object(c.b)(v.b,{options:Object(c.b)(et.a,{preset:"plain",className:"TopicTopWriterBoard-link",to:"/topic/".concat(a,"/top-writer"),"data-za-detail-view-element_name":"ViewAll",children:"查看全部"}),children:"优秀答主"}),Object(c.b)("div",{className:"TopicTopWriterBoard-section",children:e.map((function(t){var e=t.member,r=t.answerCount,o=t.totalVotes;return Object(c.b)("div",{className:"TopicTopWriterBoard-author",children:Object(c.b)(Xt.a,{author:e,target:"_blank",children:Object(c.b)("a",{className:"TopicTopWriterBoard-authorDesc",href:"/people/".concat(e.urlToken,"/creations/").concat(a),target:"_blank",rel:"noopener noreferrer",children:n.getAnswererDescription({answerCount:r,totalVotes:o})})})},e.urlToken)}))})]})}):null}}],[{key:"getAnswererDescription",value:function(t){var e=t.answerCount,n=t.totalVotes;return"话题下 ".concat([{count:e,text:"回答"},{count:n,text:"赞同"}].filter((function(t){var e=t.count;return Boolean(e)})).map((function(t){var e=t.count,n=t.text;return"".concat(Object(Qt.cnNiceNumber)(e)).concat(n)})).join(", "))}}]),n}(d.Component),$t=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params.id;return{answerers:Object(tt.P)(t,{id:n})}}),{loadBestAnswerers:tt.k}))(Yt),te=n(425),ee=n(931);function ne(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function ae(t){var e=t.children,n=t.className;return Object(c.b)("div",{className:H()("TopicTagsContainer",n),children:e})}var ce=function(t){Object(l.a)(n,t);var e=ne(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.className,n=t.topic;return Object(c.b)(Tt.a,{module:"TopicItem",children:Object(c.b)(ee.a,{className:H()(e,"TopicTag"),topic:n,children:Object(c.b)(te.a,{children:n.name})})})}}]),n}(d.Component);function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var oe=function(t){Object(l.a)(n,t);var e=re(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.loadTopicParent,n=t.loadTopicChildren,a=t.topic,c=a.id;a.fatherCount&&e(c),n(c)}},{key:"render",value:function(){var t=this.props,e=t.parent,n=void 0===e?[]:e,a=t.children,r=void 0===a?[]:a,o=t.topic.id,i=t.currentUser,l=void 0===i?{}:i;return n.length||r.length?Object(c.b)(v.d,{children:Object(c.c)(v.c,{children:[Boolean(n.length)&&Object(c.b)(Tt.a,{module:"TopicList",moduleName:"子话题",children:Object(c.c)("div",{className:"TopicRelativeBoard-item",children:[Object(c.b)("div",{className:"TopicRelativeBoard-title",children:"父话题"}),Object(c.b)(ae,{className:"TopicRelativeBoard-topics",children:n.map((function(t){return Object(c.b)(ce,{topic:t},t.id)}))})]})}),Boolean(r.length)&&Object(c.b)(Tt.a,{module:"TopicList",moduleName:"子话题",children:Object(c.c)("div",{className:"TopicRelativeBoard-item",children:[Object(c.b)("div",{className:"TopicRelativeBoard-title",children:"子话题"}),Object(c.b)(ae,{className:"TopicRelativeBoard-topics",children:r.map((function(t){return Object(c.b)(ce,{topic:t},t.id)}))})]})}),!l.isOrg&&Object(c.b)("a",{className:"TopicRelativeBoard-link",href:"/topic/".concat(o,"/organize/entire#anchor-children-topic"),target:"_blank",rel:"noopener noreferrer",children:"查看全部话题结构"})]})}):null}}]),n}(d.Component),ie=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params.id;return{topic:Object(tt.bb)(t,{id:n}),parent:Object(tt.Z)(t,{id:n}),children:Object(tt.Q)(t,{id:n}),currentUser:Object(ft.b)(t)}}),{loadTopicParent:tt.F,loadTopicChildren:tt.B}))(oe),le=n(873),se=n(379),ue=n(1133),de=n(939);function pe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var be=function(t){Object(l.a)(n,t);var e=pe(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).generateMeta=function(t){var e=t.editNum,n=t.createNum,a=e?"".concat(Object(Qt.cnNiceNumber)(e),"次简介编辑"):"",c=n?"".concat(Object(Qt.cnNiceNumber)(n),"次创建"):"",r=a&&c?", ":"";return"".concat(a).concat(r).concat(c)},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.isFetching,a=e.isDrained,r=e.items,o=e.total,i=e.onLoad,l=e.handleFollowButtonClick,s={getContainer:function(t){return t}};return Object(c.c)("div",{className:"TopicContributorList",children:[Object(c.b)(ue.a,{header:"".concat(Object(Qt.formatNumber)(o)," 名话题贡献者")}),Object(c.b)(se.b,Object.assign(Object.assign({className:"".concat("TopicContributorList","-content"),isLoading:n,isDrained:a,onLoad:i,placeholder:Object(c.b)(se.a,{className:"List-item",withAvatar:!0})},s),{},{children:r.map((function(e,n){return Object(c.b)(le.a,{children:Object(c.b)(de.a,{user:e.author,meta:t.generateMeta(e),onClick:function(){return l(e.author)}})},"".concat(n,".").concat(e.author.urlToken))}))}))]})}}]),n}(d.Component);be.propTypes={isFetching:M.a.bool.isRequired,isDrained:M.a.bool.isRequired,items:M.a.array.isRequired,total:M.a.number.isRequired,onLoad:M.a.func.isRequired};var he=be;function fe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var me=function(t){Object(l.a)(n,t);var e=fe(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={shown:!1},t.handleToggleContributors=function(){return t.setState({shown:!t.state.shown})},t.handleLoad=function(){var e=t.props;return(0,e.loadTopicContributors)(e.params.id)},t.handleFollowButtonClick=function(e){var n=t.props;(0,n.toggleTopicContributorFollowers)(n.params.id,e.urlToken,!e.isFollowing)},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.isFetching,n=t.isDrained,a=t.items,r=t.total,o=t.contributors,i=this.state.shown;if(!o.length)return null;var l=o.slice(0,3);return Object(c.c)(v.d,{children:[Object(c.b)(v.b,{options:r>3?Object(c.c)(et.a,{preset:"plain",className:"".concat("TopicContributorBoard","-link"),onClick:this.handleToggleContributors,children:["查看全部 (",Object(Qt.cnNiceNumber)(r).trim(),")"]}):null,children:"话题贡献者"}),Object(c.b)("div",{className:"".concat("TopicContributorBoard","-section"),children:l.map((function(t){var e=t.author,n=t.authorityType,a=void 0===n?"":n,r=t.editNum,o=t.createNum,i=e.urlToken,l=e.isOrg,s=Boolean(r),u=Boolean(o);return Object(c.b)("div",{className:"".concat("TopicContributorBoard","-author"),children:Object(c.b)(Xt.a,{author:e,target:"_blank",children:Object(c.b)("a",{className:"".concat("TopicContributorBoard","-authorInfo"),href:"/".concat(l?"org":"people","/").concat(i),target:"_blank",rel:"noopener noreferrer",children:a||Object(c.c)("span",{children:[s&&Object(c.c)("span",{title:r,children:[Object(Qt.cnNiceNumber)(r),"次简介编辑"]}),s&&u&&"，",u&&Object(c.c)("span",{title:o,children:[Object(Qt.cnNiceNumber)(o),"次创建"]})]})})})},i)}))}),Object(c.b)(ct.b,{size:"fullPage",onClose:this.handleToggleContributors,children:i&&Object(c.b)(he,{isFetching:e,isDrained:n,items:a,total:r,onLoad:this.handleLoad,handleFollowButtonClick:this.handleFollowButtonClick})})]})}}]),n}(d.Component);me.propTypes={total:M.a.number.isRequired,contributors:M.a.arrayOf(M.a.shape({author:M.a.object,createNum:M.a.number,editNum:M.a.number})).isRequired},me.defaultProps={total:0,contributors:[]};var ve=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return Object.assign({},Object(tt.S)(t,{id:n.id}))}),{loadTopicContributors:tt.D,toggleTopicContributorFollowers:tt.N}))(me),Oe=n(216),je=n.n(Oe),ge=n(1504);function ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ce=function(t){Object(l.a)(n,t);var e=ye(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).toggleVote=je()((function(){var e=t.props,n=e.topic.id,a=e.voted;(0,e.toggleVoteTopicWiki)(n,!a)}),300),t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.voted,n=t.voteInfo,a=(n=void 0===n?{}:n).num,r=void 0===a?0:a;return Object(c.b)(v.d,{children:Object(c.c)("div",{className:"TopicVoteBoard",children:["认为本内容有帮助",Object(c.c)(N.c,{className:H()("".concat("TopicVoteBoard","-button"),{voted:e}),preset:"primary",onClick:this.toggleVote,children:[Object(c.b)(ge.a,{center:!0,size:20}),Object(c.b)("span",{className:"".concat("TopicVoteBoard","-voteCount"),children:Object(Qt.formatNumber)(r)})]})]})})}}]),n}(d.Component);Ce.propTypes={voted:M.a.bool.isRequired,voteInfo:M.a.shape({num:M.a.number}).isRequired};var we=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params.id;return{state:t,topic:Object(tt.bb)(t,{id:n})}}),{toggleVoteTopicWiki:tt.O}))(Ce);function Te(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Re=function(t){Object(l.a)(n,t);var e=Te(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.params.id;(0,t.loadTopicWikiMeta)(e)}},{key:"render",value:function(){var t=this.props.wikiMeta;if(!t)return null;var e=t.contributorTotal,n=t.contributors,a=t.hasVoted,r=t.voteInfo;return Object(c.c)(d.Fragment,{children:[Object(c.b)(ve,{total:e,contributors:n}),Object(c.b)(we,{voted:a,voteInfo:r})]})}}]),n}(d.Component),ke=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{wikiMeta:Object(tt.fb)(t,{id:n.id})}}),{loadTopicWikiMeta:tt.H}))(Re);function Ie(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ne=function(t){Object(l.a)(n,t);var e=Ie(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={userList:[]},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.params.id;(0,e.loadCreatorWall)({id:n,isEntry:!0}).then((function(e){var n=e.payload.data;0!==n.length&&t.setState({userList:n.map((function(t){return t.member})).slice(0,5)})}))}},{key:"render",value:function(){var t=this.state.userList,e=this.props.params.id;return 0===t.length?null:Object(c.c)(v.d,{children:[Object(c.b)(v.b,{options:Object(c.b)(et.a,{preset:"plain",className:"TopicCreatorWallEntry-link",to:"/topic/".concat(e,"/creator_wall"),"data-za-detail-view-id":3920,children:"查看全部"}),children:"话题创作知友墙"}),Object(c.b)(r.Link,{className:"TopicCreatorWallEntry-itemList",to:"/topic/".concat(e,"/creator_wall"),"data-za-detail-view-id":3920,children:t.map((function(e,n){var a=Object(c.b)(m.a,{size:38,url:e.avatarUrl},e.urlToken);return n<t.length-1?a:Object(c.c)("div",{className:"TopicCreatorWallEntry-itemContainer",children:[a,Object(c.b)("div",{className:"TopicCreatorWallEntry-itemMask",children:"···"})]},e.urlToken)}))})]})}}]),n}(d.Component),xe=Object(I.compose)(Object(f.connect)(null,{loadCreatorWall:bt.i}),Object(Rt.a)(),r.withRouter)(Ne),Se=n(25);function Ee(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ae=function(t){Object(l.a)(n,t);var e=Ee(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(t){!this.props.isDrained&&t.isDrained&&this.dynamicSticky&&this.dynamicSticky.check()}},{key:"render",value:function(){var t=this,e=this.props.isWiki;return Object(c.c)(Ft.a,{className:"TopicSideBar",offset:Se.i+10,ref:function(e){t.dynamicSticky=e},children:[Object(c.b)(Zt,{}),!e&&Object(c.b)($t,{}),Object(c.b)(xe,{}),Object(c.b)(ie,{}),Boolean(e)&&Object(c.b)(ke,{}),Object(c.b)(_t.a,{})]})}}]),n}(d.Component);Ae.propTypes={isWiki:M.a.bool},Ae.defaultProps={isWiki:!1};var Be=Object(I.compose)(Object(Rt.a)(null),r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{isDrained:Object(tt.T)(t,{id:n.id})}})))(Ae),Me=n(2204),Pe=n(217);function ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Le={hot:"热门排序",newest:"时间排序",unanswered:"热门排序",questions:"时间排序"},Ue=function(t){Object(l.a)(n,t);var e=ze(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.params.id,n=t.path,a=t.topic,o=t.borderTop,i=t.borderBottom,l=t.hasTopicIntro,s="/topic/".concat(e),u=a.category===k?"百科":"简介";return Object(c.c)("div",{className:H()("Topic-bar",{"Topic-bar--borderTop":o,"Topic-bar--borderBottom":i}),children:[Object(c.c)(Pe.b,{className:"Topic-tabs",children:[a.isIndexVisible&&Object(c.b)(Pe.a,{"aria-controls":"Topic-index",children:Object(c.b)(r.IndexLink,{to:"".concat(s,"/index"),children:"索引"})},"index"),l&&Object(c.b)(Pe.a,{"aria-controls":"Topic-intro",children:Object(c.b)(r.IndexLink,{to:"".concat(s,"/intro"),children:u})},"intro"),Object(c.b)(Pe.a,{"aria-controls":"Topic-hot",children:Object(c.b)(r.Link,{to:"".concat(s,"/hot"),className:H()({"is-active":"hot"===n}),children:"讨论"})}),Object(c.b)(Pe.a,{"aria-controls":"Topic-top",children:Object(c.b)(r.Link,{to:"".concat(s,"/top-answers"),children:"精华"})}),Object(c.b)(Pe.a,{"aria-controls":"Topic-wait",children:Object(c.b)(r.Link,{to:"".concat(s,"/unanswered"),className:H()({"is-active":"unanswered"===n}),children:"等待回答"})})]}),n&&Object(c.b)(et.a,{preset:"plain",to:"/topic/".concat(e,"/").concat(n),className:"Topic-headerLink","data-za-detail-view-name":"切换为".concat(Le[n]),icon:Me.a,label:"切换为".concat(Le[n])})]})}}]),n}(d.Component),De=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{topic:Object(tt.bb)(t,{id:n.id}),hasTopicIntro:Object(tt.i)(t,{id:n.id})}})))(Ue),We=n(165);function Ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var _e={hot:"newest",newest:"hot",unanswered:"questions",questions:"unanswered"},Fe=function(t){Object(l.a)(n,t);var e=Ve(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={signFlowModalShown:!1},t}return Object(i.a)(n,[{key:"componentWillMount",value:function(){var t=this.props.topic,e=(t=void 0===t?{}:t).redirection,a=t.headerCard;e&&e.to&&e.to.id?n.redirectTo("/topic/".concat(e.to.id)):a&&a.specialUrl&&n.redirectTo(a.specialUrl)}},{key:"componentDidMount",value:function(){var t=this.props,e=t.topic,n=t.currentUser;O.a.trackPageShow({id:10405}),e?this.nextTopicReady():this.nextTopic(),n&&"guest"!==n.userType||this.setState({signFlowModalShown:!0})}},{key:"handleSignFlowModalClose",value:function(){this.setState({signFlowModalShown:!1})}},{key:"componentWillReceiveProps",value:function(t){var e=this.props,n=e.params.id,a=e.topic,c=e.location,r=t.params.id,o=t.topic,i=t.location;(!a&&o||a&&o&&a.id!==o.id)&&this.nextTopicReady(t),n===r&&c!==i&&this.nextUrl()}},{key:"nextTopic",value:function(t){var e=t||this.props,n=e.params.id;(0,e.loadFullTopic)(n)}},{key:"nextTopicReady",value:function(t){this.checkRedirect(t)||this.nextUrl(t)}},{key:"nextUrl",value:function(t){var e=(t||this.props).topic.meta,n=void 0===e?{}:e;O.a.trackCardShow(this,{name:n.category||"default"})}},{key:"checkRedirect",value:function(t){var e=t||this.props,n=e.router,a=e.params.id,c=e.topic.isBlack,r="/topic/".concat(a,"/").concat(c?"intro":"hot");return!!n.isActive("/topic/".concat(a),!0)&&(n.replace(r),!0)}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,a=e.topic,r=e.routes,o=e.isIntro,i=this.state.signFlowModalShown;if(!a)return null;var l=a.avatarUrl,s=a.id,u=a.type,p=a.meta,b=a.isFollowing,f=a.name,O=a.excerpt,j=a.category,T=_e[r[r.length-1].path],R=Object(c.b)(C.a,{children:Object(c.c)("div",{className:"Topic-pageHeader",children:[Object(c.c)("div",{className:"Topic-pageHeaderMain",children:[Object(c.b)(m.a,{url:l,size:38}),Object(c.b)(De,{path:T})]}),Object(c.b)("div",{children:Object(c.b)(y.a,{type:u,id:s,isFollowing:b,preset:"primary"})})]})});return Object(c.b)(Tt.a,{module:"TopicItem",moduleName:a.meta?a.meta.category:"default",card:{content:Object.assign(Object.assign({type:"Topic"},Object(We.a)(a.type,a.id)),a.meta&&{sub_type:"MetaCard"})},children:Object(c.c)(g,{sidebar:Object(c.b)(Be,{isWiki:o&&j===k}),children:[i&&Object(c.b)(w.b,{maskClosable:!1,showQrcodeFirst:!0,defaultType:"login",onClose:function(){t.handleSignFlowModalClose()}}),Object(c.c)(v.d,{children:[Object(c.b)(h.a,{title:f,meta:[{name:"keywords",content:f},{name:"image",content:l},{name:"description",content:O}]}),Object(c.b)(Vt,{})]}),Object(c.c)("div",{id:"TopicMain",children:[p&&Object(c.c)(d.Fragment,{children:[Object(c.b)(De,{path:T,borderTop:!0}),R]}),!p&&Object(c.c)(d.Fragment,{children:[Object(c.b)(De,{path:T,borderBottom:!0}),R]}),n]})]})})}}],[{key:"redirectTo",value:function(t){if(Object(j.isNode)()){var e=new Error;throw e.status=302,e.redirect=t,e}location.href=t}}]),n}(d.Component);Fe.fetchData=function(t){var e=t.dispatch,n=t.params.id;return e(Object(tt.l)(n))};var qe=Object(f.connect)((function(t,e){return{currentUser:Object(ft.b)(t),topic:Object(tt.bb)(t,{id:e.params.id}),isIntro:/\/topic\/\d+\/intro/.test(e.location.pathname)}}),{loadFullTopic:tt.l})(Fe),He=n(44),Ge=n(2600),Ke=n(382),Ze=n(250),Qe=n(54),Xe=n(885);function Je(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function Ye(t){var e=t.type,n=t.id,a=t.question,c=(a=void 0===a?{}:a).id;switch(e){case"question":return"/question/".concat(n);case"article":return"//zhuanlan.zhihu.com/p/".concat(n);case"answer":return"/question/".concat(c,"/answer/").concat(n);default:return""}}function $e(t){var e=t.item,n="answer"===e.type?e.question.title:e.title;return Object(c.b)("div",{className:"TopicIndexModule-item",children:Object(c.b)("a",{href:Ye(e),children:n})})}var tn=function(t){Object(l.a)(n,t);var e=Je(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props.item,e=t.title,n=t.relatedtopics,a=t.items,r=t.id;return Object(c.c)("div",{className:"TopicIndexModule",children:[Object(c.b)("a",{id:"module-".concat(r),children:Object(c.b)("h2",{className:"TopicIndexModule-title",children:e})}),Object(c.b)("div",{children:a.map((function(t){return Object(c.b)($e,{item:t},t.id)}))}),n&&Boolean(n.length)&&Object(c.b)(Tt.a,{module:"TopicList",moduleName:"相关话题",children:Object(c.c)(ae,{className:"TopicIndexModule-topics",children:[Object(c.b)("h3",{className:"TopicIndexModule-topicsTitle",children:"相关话题："}),n.map((function(t){return Object(c.b)(ce,{topic:t},t.id)}))]})})]})}}]),n}(d.Component),en=Object(Tt.b)({module:"TopicIndexItem",trackCardShow:!0})(tn),nn=n(148);function an(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function cn(t){return"module-".concat(t)}function rn(t){return document.querySelector("#".concat(cn(t))).offsetTop}function on(t){document.querySelector(t).scrollIntoView({behavior:"smooth",block:"start"})}var ln=function(t){Object(l.a)(n,t);var e=an(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={activeId:0},t.heights=null,t.handleScroll=function(){var e=window.pageYOffset,n=window.innerHeight/2+e,a=t.heights.find((function(t){return t.height<=n}));a&&t.setState({activeId:a.id})},t.handleClick=function(e){e.preventDefault();var n=e.target.hash;t.props.router.push(Object.assign(Object.assign({},t.props.location),{},{hash:n})),on(n)},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.modules,n=t.location;this.heights=e.map((function(t){var e=t.id;return{id:e,height:rn(e)}})).reverse(),n.hash&&on(n.hash),this.subscription=Object(nn.subscribe)("scroll",this.handleScroll)}},{key:"componentWillUnmount",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"render",value:function(){var t=this,e=this.props.modules,n=this.state.activeId;return Object(c.b)("ol",{className:"TopicIndexCatalog",children:e.map((function(e){return Object(c.b)("li",{className:H()("TopicIndexCatalog-item",{"is-active":n===e.id}),children:Object(c.b)("a",{href:"#".concat(cn(e.id)),onClick:t.handleClick,children:e.title})},e.id)}))})}}]),n}(d.Component),sn=Object(r.withRouter)(ln);function un(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var dn=function(t){Object(l.a)(n,t);var e=un(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={overflow:!1},t.handleToggleShowOiaModal=function(){var e=t.props.params.id;Object(Ke.e)(Object(Xe.a)({type:"topic",id:e}))},t.checkOverflow=function(){var e=t.content?Object(He.findDOMNode)(t.content):null;e&&e.offsetHeight>1e3&&t.setState({overflow:!0})},t.handleUserClick=function(){var e=t.props,n=e.shouldOia,a=e.params.id;return!n||(Object(Ke.e)(Object(Xe.a)({type:"topic",id:a})),!1)},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.topic;t.route.path;e&&this.nextTopicReady()}},{key:"componentWillReceiveProps",value:function(t){var e=this.props.topic,n=t.topic;n&&(e||{}).id!==n.id&&this.nextTopic(t)}},{key:"componentDidUpdate",value:function(t){0}},{key:"nextTopicReady",value:function(t){var e=t||this.props,n=e.topic,a=e.item,c=e.loadIndex,r=e.params.id;void 0===a&&n.isIndexVisible&&c(r)}},{key:"renderModules",value:function(){var t=this,e=(this.props.item||{}).topicIndexModules;if(!e||!e.length)return null;var n=this.state.overflow;return Object(c.c)(v.d,{className:H()("TopicIndex-content",{"TopicIndex-mobileContent":!1}),onRef:function(e){t.content=e},children:[Object(c.b)(Tt.a,{module:"TopicIndexList",children:Object(c.c)("div",{className:H()("TopicIndex-contentMain",{"TopicIndex-overflowContent":n}),children:[!1,e.map((function(t){return Object(c.b)(en,{item:t},t.id)}))]})}),n&&Object(c.c)("button",{className:"TopicIndex-overflowButton",onClick:this.handleToggleShowOiaModal,children:["展开阅读全文",Object(c.b)(Ge.a,{text:!0,center:!0,width:20,height:20})]}),Object(c.b)("div",{className:"TopicIndex-contentSide",ref:function(e){t.contentSide=e},children:Object(c.b)(Ze.a,{offset:52,container:function(){return t.contentSide},children:Object(c.b)("div",{children:Object(c.b)(sn,{modules:e})})})})]})}},{key:"renderEditors",value:function(){var t=this,e=(this.props.item||{}).topicIndexEditors;return e&&e.length?Object(c.b)(Tt.a,{module:"UserList",moduleName:"编辑者",trackCardShow:!0,children:Object(c.c)(v.d,{children:[Object(c.b)(v.b,{children:"编辑者"}),e.map((function(e){return Object(c.b)(le.a,{children:Object(c.b)(de.a,{user:e,onClick:t.handleUserClick})},e.id)}))]})}):null}},{key:"render",value:function(){return this.props.item?Object(c.c)("div",{children:[this.renderModules(),this.renderEditors()]}):null}}]),n}(d.Component);dn.fetchData=function(t){var e=t.dispatch,n=t.params.id;return e(Object(tt.n)(n)).catch((function(t){if(404===t.status){var e=new Error;throw e.status=302,e.redirect="/topic/".concat(n),e}throw t}))},dn.contextTypes={authRequired:M.a.func};var pn=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{topic:Object(tt.bb)(t,{id:n.id}),item:Object(tt.W)(t,{id:n.id}),shouldOia:Object(Qe.h)(t)}}),{loadIndex:tt.n}))(dn),bn=n(4),hn=n(2584);function fn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var mn=function(t){Object(l.a)(n,t);var e=fn(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.title,n=t.children,a=t.className;return Object(c.c)("div",{className:H()("TopicIntroSection",a),children:[e&&Object(c.b)("h2",{className:"TopicIntroSection-title",children:e}),n]})}}]),n}(d.Component);function vn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}d.Component;var On=n(825),jn=n(384);var gn=n(816),yn=n(862);var Cn=function(t){var e=t.avatar,n=t.name,a=t.desc,r=t.relatedTopic,o=Object(d.useRef)(null),i=Boolean(r),l=Object(d.useCallback)((function(){i&&(O.a.trackEvent(null,{id:7590,action:"OpenUrl"}),window.open("/topic/".concat(r,"/intro")))}),[i,r]);return Object(d.useEffect)((function(){Object(yn.onViewedOnce)(o.current,(function(){O.a.trackCardShow(o.current,{id:7589,name:i?"HasLink":"NoLink"})}))}),[i]),Object(c.c)("div",{className:"TopicMovieIntro-celebrityItem",ref:o,children:[Object(c.b)("div",{className:"TopicMovieIntro-celebrityItemAvatarContainer",children:e&&/zhimg\.com/.test(e)?Object(c.b)(m.a,{className:H()("TopicMovieIntro-celebrityItemAvatar",{"TopicMovieIntro-celebrityItemAvatar--withLink":i}),size:36,round:!0,onClick:l,url:e}):Object(c.b)("div",{className:H()("TopicMovieIntro-celebrityDefaultAvatar",{"TopicMovieIntro-celebrityDefaultAvatar--withLink":i}),role:"button",tabIndex:0,"aria-label":"打开相关话题",onClick:l,children:Object(c.b)(gn.a,{className:"TopicMovieIntro-celebrityDefaultAvatar--icon"})})}),Object(c.c)("div",{className:"TopicMovieIntro-celebrityItemContent",children:[Object(c.b)("div",{className:"TopicMovieIntro-celebrityItemName",children:Object(c.b)("span",{className:H()("TopicMovieIntro-celebrityItemNameInner",{"TopicMovieIntro-celebrityItemNameInner--withLink":i}),role:"button",tabIndex:0,onClick:l,children:n})}),Object(c.b)("div",{className:"TopicMovieIntro-celebrityItemPlay",children:a})]})]})},wn=n(32);function Tn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Rn=function(t){Object(l.a)(n,t);var e=Tn(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.margin,n=t.column,a=t.children,r=t.className,o=this.props,i=o.marginBottom,l=void 0===i?e:i,s=o.marginRight,u=void 0===s?e:s;return Object(c.b)("div",{className:H()("SquareGrid",r),style:{marginRight:-u,marginBottom:-l},children:d.Children.toArray(a).map((function(t){return Object(c.b)("div",{style:{marginRight:u,marginBottom:l,width:"calc(".concat(100/n,"% - ").concat(u,"px)")},children:t},t.key)}))})}}]),n}(d.Component);Rn.propTypes={margin:M.a.number,marginBottom:M.a.number,marginRight:M.a.number,column:M.a.number},Rn.defaultProps={margin:2,column:4};var kn=Rn,In=n(143),Nn=n(2580),xn=n(831),Sn=n(585),En=n(329),An=n(394),Bn=n.n(An);function Mn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function Pn(t){return{x:t.left+t.width/2,y:t.top+t.height/2}}function zn(t,e){var n=t.width/e.width,a=Pn(t),c=Pn(e);return{translate:{x:a.x-c.x,y:a.y-c.y},scale:n}}var Ln=function(t){Object(l.a)(n,t);var e=Mn(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={active:!1,translate:null,scale:null},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.trans()}},{key:"componentWillReceiveProps",value:function(t){Bn()(t.from,this.props.from)||Bn()(t.to,this.props.to)||this.trans(t)}},{key:"trans",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,n=e.timeout,a=e.onClose;this.timeout&&clearTimeout(this.timeout),this.setState(Object.assign({active:!0},zn(this.props.from,this.props.to)),(function(){t.node.offsetWidth,t.setState({translate:null,scale:null})})),this.timeout=setTimeout((function(){t.setState({active:!1}),a&&a()}),n)}},{key:"componentWillUnmount",value:function(){this.timeout&&clearTimeout(this.timeout)}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,a=e.timeout,c=e.to,r=c.top,o=c.left,i=c.width,l=c.height,s=this.state,u=s.active,p=s.opacity,b=this.state.translate||{x:0,y:0},h=this.state.scale||1;return Object(d.cloneElement)(n,{style:Object.assign(Object.assign({position:"fixed",top:r,left:o,width:i,height:l},u&&{opacity:p,transition:"transform ".concat(a,"ms ease-in-out, opacity ").concat(a,"ms ease-in-out"),transform:"translate3d(".concat(b.x,"px, ").concat(b.y,"px, 0) scale3d(").concat(h,", ").concat(h,", 1)")}),n.props.style),ref:function(e){t.node=e}})}}]),n}(d.Component);Ln.propTypes={timeout:M.a.number},Ln.defaultProps={timeout:300};var Un=Ln;function Dn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Wn={vertical:20,horizontal:20},Vn={vertical:0,horizontal:0};function _n(t){var e={},n=window,a=n.innerWidth,c=n.innerHeight;if(!t)return e.width=Math.min(800,innerWidth),e.height="auto",e;var r=t.width,o=t.height,i=a/2,l=c/2,s=r/o;if(s>4/3){var u=Math.min(800,r,innerWidth,innerHeight*s);e.width=u,e.height=Math.round(u*o/r)}else{var d=Math.min(600,o,innerHeight,innerWidth/s);e.height=d,e.width=Math.round(d*r/o)}return e.top=l-e.height/2,e.left=i-e.width/2,e}var Fn=function(t){Object(l.a)(n,t);var e=Dn(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={entered:!1,index:t.props.index||0,from:null,to:_n(null),padding:null,sizeCollection:[]},t.images=[],t.trans=function(e){var n=t.state.index,a=t.props.images,c=_n(e);t.setState({from:t.getEnterFromRect(),to:c}),t.setCollectionSizeValue(n,c),a[n-1]&&t.loadImage(n-1,t.getImageSize),a[n+1]&&t.loadImage(n+1,t.getImageSize)},t.toImage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=t.state.index+e;t.setState({index:n,to:t.state.sizeCollection[n]||_n(null)});var a=n+e;t.state.sizeCollection[a]||t.loadImage(n+e,t.getImageSize)},t.handleRef=function(e){t.image=e},t.handleEnterImageLoad=function(){var e=t.image,n=e.naturalWidth,a=e.naturalHeight;t.trans({width:n,height:a})},t.getImageSize=function(e,n){var a=n.target,c=a.width,r=a.height;t.setCollectionSizeValue(e,_n({width:c,height:r}))},t.setCollectionSizeValue=function(e,n){var a=t.state.sizeCollection,c=Object(bn.a)(a);c[e]=n,t.setState({sizeCollection:c})},t.handleNext=function(){return t.toImage()},t.handlePrev=function(){return t.toImage(-1)},t.handleTransEnd=function(){return t.setState({entered:!0})},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){En.hide();var t=window.innerWidth>690?Wn:Vn;this.setState({padding:t}),this.timeout=setTimeout(this.handleTransEnd,500)}},{key:"componentWillUnmount",value:function(){En.show()}},{key:"loadImage",value:function(t,e){var n=(this.props.images[t]||{}).origin;return n?function(t,e){var n=new Image;return n.addEventListener("load",e),n.src=t,n}(n,(function(){for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return e.apply(void 0,[t].concat(a))})):null}},{key:"getEnterFromRect",value:function(){var t=this.props,e=t.getImage,n=t.getEnterFromRect;return e?e().getBoundingClientRect():n()}},{key:"render",value:function(){var t=this.props,e=t.images,n=t.enterToSize,a=t.onClose,r=this.state,o=r.index,i=r.entered,l=r.from,s=r.to,u=s||{},d=u.width,p=u.height,b=e[o]||this.props,h=b.origin,f=b.thumbnail,m=o===this.props.index;return Object(c.b)(In.a,{children:Object(c.c)("div",{className:"ImageViewAlias",children:[Object(c.b)("div",{className:"ImageViewAlias-mask",role:"button",tabIndex:0,"aria-label":"关闭",onClick:a}),Object(c.c)("div",{className:"ImageViewAlias-controls",children:[Object(c.b)(N.c,{onClick:this.handlePrev,disabled:0===o,preset:"plain",className:"ImageViewAlias-controlsLeft",children:Object(c.b)(Nn.a,{fill:"#fff",size:42})}),Object(c.b)(N.c,{onClick:this.handleNext,disabled:o===e.length-1,preset:"plain",className:"ImageViewAlias-controlsRight",children:Object(c.b)(xn.a,{fill:"#fff",size:42})}),Object(c.b)(N.c,{className:"ImageViewAlias-controlsClose",onClick:a,preset:"plain",children:Object(c.b)(Sn.a,{fill:"#fff"})})]}),Object(c.b)("div",{className:"ImageViewAlias-viewPort",children:Object(c.b)("img",Object.assign(Object.assign({className:"ImageViewAlias-image",src:h,alt:"",width:d,height:p},m&&!n&&!i&&{onLoad:this.handleEnterImageLoad,ref:this.handleRef}),!i&&{style:{opacity:0}}))}),l&&s&&!i&&Object(c.b)(Un,{from:l,to:s,onClose:this.handleTransEnd,children:Object(c.b)("img",{src:f,alt:""})})]})})}}]),n}(d.Component);Fn.propTypes={getImage:M.a.func,getEnterFromRect:M.a.func,getLeaveToRect:M.a.func,enterToSize:M.a.object,images:M.a.array,index:M.a.number},Fn.defaultProps={images:[]};var qn=Fn,Hn=["image","index","images","className","surplus","total","onClickPlus"];function Gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Kn=function(t){Object(l.a)(n,t);var e=Gn(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={previewing:!1},t.handleTogglePreview=function(){return t.setState({previewing:!t.state.previewing})},t.handleRef=function(e){t.imageEl=e},t.getImage=function(){return t.imageEl},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.image,n=t.index,a=t.images,r=t.className,o=t.surplus,i=t.total,l=t.onClickPlus,s=Object(wn.default)(t,Hn),u=this.state.previewing,d="string"==typeof e?{src:e}:e,p=a&&a[n]||{thumbnail:e,origin:this.props.origin};return Object(c.c)("div",Object.assign(Object.assign({className:H()("ThumbnailAlias",r)},s),{},{children:[Object(c.b)("img",Object.assign(Object.assign({alt:"",className:"ThumbnailAlias-image",ref:this.handleRef},d),p.origin&&{className:H()("ThumbnailAlias-image","ThumbnailAlias-image--zoomIn"),onClick:this.handleTogglePreview})),u&&Object(c.b)(qn,Object.assign({getImage:this.getImage,onClose:this.handleTogglePreview},a?{images:a,index:n}:p)),o>0&&Object(c.b)("em",Object.assign(Object.assign({className:"ThumbnailAlias-surplus"},p.origin&&{className:H()("ThumbnailAlias-surplus",{"ThumbnailAlias-image--zoomIn":!l,"ThumbnailAlias-image--pointer":l}),onClick:l||this.handleTogglePreview}),{},{children:Object(c.c)("span",{children:["点击查看",Object(c.b)("br",{}),"全部 ",i," 张"]})}))]}))}}]),n}(d.Component),Zn=["max","images","onClickPlus"];function Qn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Xn=function(t){Object(l.a)(n,t);var e=Qn(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.max,n=void 0===e?8:e,a=t.images,r=t.onClickPlus,o=Object(wn.default)(t,Zn);return Object(c.b)(kn,Object.assign(Object.assign({},o),{},{children:a.slice(0,n).map((function(t,e){return Object(c.b)(Kn,{image:t.thumbnail,index:e,images:a,onClickPlus:r,surplus:e>=n-1&&a.length-n,total:e>=n-1&&a.length},e)}))}))}}]),n}(d.Component);function Jn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function Yn(t){var e=t.icon,n=t.desc,a=t.title;return Object(c.c)("div",{className:"TopicMovieIntro-awardItem",children:[Object(c.c)("div",{className:"TopicMovieIntro-awardItemTitle",children:[Object(c.b)(m.a,{url:e}),a]}),Object(c.b)("div",{className:"TopicMovieIntro-awardContent",dangerouslySetInnerHTML:{__html:n}})]})}function $n(t){var e=t.title,n=t.desc;return Object(c.c)("div",{className:"TopicMovieIntro-moreInfoItem",children:[Object(c.b)("h3",{className:"TopicMovieIntro-moreInfoItemTitle",children:e}),Object(c.b)("div",{className:"TopicMovieIntro-moreInfoItemDetail",children:n})]})}var ta=function(t){Object(l.a)(n,t);var e=Jn(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={celebritiesExpanded:!1,dramaExpanded:!1},t.handleToggleExpanded=function(){t.setState({celebritiesExpanded:!t.state.celebritiesExpanded})},t.handleToggleShowOiaModal=!1,t}return Object(i.a)(n,[{key:"renderCelebrities",value:function(t){var e=this.state.celebritiesExpanded,n=(t||[]).map((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.role,n=t.list;return n&&n.map((function(t){return Object.assign(Object.assign({},t),{},{role:e})}))})).reduce((function(t,e){return[].concat(Object(bn.a)(t),Object(bn.a)(e||[]))}),[]),a=e?n:n.slice(0,6);return a.length?Object(c.c)(mn,{title:"影人",children:[Object(c.b)("div",{className:H()({"TopicMovieIntro-sectionCelebritiesContainer":!1}),children:Object(c.b)("div",{className:H()({"TopicMovieIntro-sectionCelebrities":!1}),children:a.map((function(t){var e=t.movieAvatar,n=t.avatar,a=t.desc,r=t.name,o=t.role,i=t.relatedTopic;return Object(c.b)(Cn,{relatedTopic:i,avatar:e||n,name:r,desc:a?"".concat("演员"===o?"饰 ":"").concat(a):o},r)}))})}),n.length>6&&Object(c.c)(N.c,{className:"TopicMovieIntro-celebrityMore",preset:"plain",onClick:this.handleToggleExpanded,children:[e?"收起":"查看全部",e?Object(c.b)(hn.a,{size:16,center:!0}):Object(c.b)(Ge.a,{size:16,center:!0})]})]}):null}},{key:"render",value:function(){var t=this.props,e=t.item,n=t.params.id;if(!e||!e.content.meta)return null;var a=e.content.meta,r=a.content,o=r.drama,i=r.celebrities,l=r.awards,s=r.parameters,u=a.content,d=(e.content.relatedTopicsV2,((u||{}).photos||[]).filter((function(t){return t&&t.olonk&&/zhimg\.com/.test(t.olonk)})).map((function(t){return t&&t.olonk&&{thumbnail:t.olonk,origin:Object(S.imgUrl)(t.olonk,"r")}})));return Object(c.c)(v.d,{className:H()({"TopicMovieIntro-mobile":!1}),children:[Object(c.b)(mn,{title:"".concat("","简介"),children:Object(c.b)("div",{className:"OldTopicIntro-intro TopicMovieIntro-sectionDrama",children:o})}),this.renderCelebrities(i),l&&Boolean(l.length)&&Object(c.b)(mn,{title:"奖项",children:l.map((function(t,e){return Object(c.b)(Yn,Object.assign({},t),e)}))}),Boolean(d&&d.length)&&Object(c.b)(mn,{title:"图片",children:Object(c.b)(Xn,{max:8,images:d,onClickPlus:function(){return location.href="/topic/".concat(n,"/images")}})}),s&&Boolean(s.length)&&Object(c.b)(mn,{title:"更多信息",children:s.map((function(t,e){return Object(c.b)($n,Object.assign({},t),e)}))}),Object(c.b)(mn,{children:Object(c.b)("div",{className:"OldTopicIntro-source",children:Object(c.b)("div",{children:Object(c.b)("p",{children:"数据由猫眼电影提供"})})})}),!1]})}}]),n}(d.Component);ta.contextTypes={authRequired:M.a.func};var ea=ta;function na(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var aa=function(t){Object(l.a)(n,t);var e=na(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.label,n=t.value;return Object(c.c)("div",{children:[Object(c.b)("span",{className:"TopicIntro-moreInfoItemLabel",children:e}),Object(c.b)("span",{className:"TopicIntro-moreInfoItemValue",children:n})]})}}]),n}(d.Component);function ca(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function ra(t){var e=t.abstract;return Object(c.b)("div",{children:e&&Object(c.b)(jn.a,{className:"TopicBookIntro-authorItemContent",html:e})})}function oa(t){var e=t.translators,n=t.publishTime,a=t.paperNum,r=t.wordCount,o={"译者":e&&e.length&&e.map((function(t){return t.name})).join(),"出版时间":n,"页数":a,"字数":r},i=Object.keys(o).filter((function(t){return o[t]}));return Boolean(i.length)&&Object(c.b)(mn,{title:"更多信息",children:i.map((function(t){return Object(c.b)(aa,{label:t,value:o[t]},t)}))})}function ia(t){var e=t.source;return e.from&&Object(c.c)("div",{className:"OldTopicIntro-source TopicBookIntro-source",children:["数据由",e.from,"提供"]})}var la=function(t){Object(l.a)(n,t);var e=ca(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleToggleShowOiaModal=!1,t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props.item;if(!t||!t.content.meta)return null;var e=t.content.meta,n=e.content,a=e.content,r=a.summary,o=a.authors,i=a.tableContent,l=a.source,s=(t.content.relatedTopics,Object(c.b)(jn.a,{html:r})),u=Object(c.b)(jn.a,{html:i}),d=o.map((function(t,e){return Object(c.b)(ra,Object.assign({},t),e)}));return Object(c.c)(v.d,{className:"TopicBookIntro",children:[r&&Object(c.b)(mn,{title:"".concat("","简介"),children:Object(c.b)("div",{className:"OldTopicIntro-intro",children:s})}),o&&Boolean(o.length)&&Object(c.b)(mn,{title:"作者简介",children:Object(c.b)("div",{className:"OldTopicIntro-intro",children:d})}),i&&Object(c.b)(mn,{title:"目录",children:Object(c.b)("div",{className:"OldTopicIntro-intro",children:u})}),Object(c.b)(oa,Object.assign({},n)),Object(c.b)(mn,{children:Object(c.b)(ia,{source:l})}),!1]})}}]),n}(d.Component);la.contextTypes={authRequired:M.a.func};var sa=Object(r.withRouter)(la),ua=n(182);function da(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function pa(t){var e=t.gameGenres,n=t.publisher,a=t.producer,r=t.platforms,o=t.marketTime,i=t.officialSite,l={"类型":Boolean(e&&e.length)&&e.map((function(t){return t.text})).join(" / "),"制作":n,"发行":a,"平台":Boolean(r&&r.length)&&r.map((function(t){return t.text})).join(" / "),"发行时间":o&&Object(ua.toDateString)(o),"官方网址":i&&Object(c.b)("a",{href:i,target:"_blank",rel:"noopener noreferrer",children:i})},s=Object.keys(l).filter((function(t){return l[t]}));return Boolean(s.length)&&Object(c.b)(mn,{title:"更多信息",children:s.map((function(t){return Object(c.b)(aa,{label:t,value:l[t]},t)}))})}var ba=function(t){Object(l.a)(n,t);var e=da(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleToggleShowOiaModal=!1,t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.item,n=t.params.id;if(!e||!e.content.meta)return null;var a=e.content.meta,r=a.content,o=a.content,i=o.introduction,l=o.screenshotsCollection,s=(e.content.relatedTopics,Object(c.b)(jn.a,{html:i})),u=l.map((function(t){return{thumbnail:t,origin:Object(S.imgUrl)(t,"r")}}));return Object(c.c)(v.d,{className:"TopicGameIntro",children:[i&&Object(c.b)(mn,{title:"".concat("","简介"),children:s}),Boolean(u&&u.length)&&Object(c.b)(mn,{title:"游戏截图",children:Object(c.b)(Xn,{max:8,images:u,onClickPlus:function(){return location.href="/topic/".concat(n,"/images")}})}),Object(c.b)(pa,Object.assign({},r)),!1]})}}]),n}(d.Component);ba.contextTypes={authRequired:M.a.func};var ha=Object(r.withRouter)(ba),fa=n(257),ma=n(2205),va=n.n(ma);function Oa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var ja=function(t){var e=t.value,n=t.style,a=e.topic,r=e.remark,o=a.name,i=a.avatarUrl,l=n.imageTemplate;return Object(c.c)("div",{className:"TopicColumnMeta-line TopicColumnMeta-singleLine",children:[Object(c.b)(m.a,{className:H()("TopicColumnMeta-avatar","TopicColumnMeta-avatar--".concat(R[l]||"smallSquare")),size:36,url:i}),Object(c.c)("div",{className:"TopicColumnMeta-topic",children:[Object(c.b)("div",{className:"TopicColumnMeta-name",children:o}),r&&Object(c.b)("div",{className:"TopicColumnMeta-remark",children:r})]})]})},ga=function(t){var e=t.value,n=t.style,a=e.topic,r=e.remark,o=a.name,i=a.avatarUrl,l=n.imageTemplate;return Object(c.c)("div",{className:"TopicColumnMeta-line TopicColumnMeta-doubleLine",children:[Object(c.c)("div",{className:"TopicColumnMeta-topic",children:[Object(c.b)(m.a,{className:H()("TopicColumnMeta-avatar","TopicColumnMeta-avatar--".concat(R[l]||"smallSquare")),size:36,url:i}),Object(c.b)("div",{className:"TopicColumnMeta-name",children:o})]}),r&&Object(c.b)("div",{className:"TopicColumnMeta-remark",children:r})]})},ya=function(t){Object(l.a)(n,t);var e=Oa(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.style,n=t.value,a=e.layout,r=(n||[]).map((function(t){return"3-2"===a||"row"===a?Object(c.b)(ja,{value:t,style:e}):Object(c.b)(ga,{value:t,style:e})}));return Object(c.b)("div",{className:"TopicColumnMeta",children:Object(c.b)("div",{className:"TopicColumnMeta-main",children:r})})}}]),n}(d.Component),Ca=n(1084);function wa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ta=function(t){Object(l.a)(n,t);var e=wa(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.target,n=e.type,a=e.value,r=t.style,o=t.isZhihuWiki;switch(n){case"String":return o?Object(c.b)(Ca.a,{html:a,className:"TopicCommonField-zhihuWiki--text",style:r}):Object(c.b)("div",{className:"TopicCommonField-text",style:r,dangerouslySetInnerHTML:{__html:a}});case"Datetime":return Object(c.b)("span",{className:"TopicCommonField-text",style:r,children:Object(ua.toDateString)(a)});case"Image":var i=a;return Object(c.b)(Kn,{image:i,origin:Object(S.imgUrl)(i,"r"),style:r});case"Topic":var l=a.name;return Object(c.b)("span",{className:"TopicCommonField-topicText",children:l});default:return null}}}]),n}(d.Component),Ra=["target","preset","topicId"];function ka(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ia=function(t){Object(l.a)(n,t);var e=ka(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.target,n=e.type,a=e.value,r=void 0===a?[]:a,o=e.style,i=void 0===o?{}:o,l=t.preset,s=t.topicId,u=Object(wn.default)(t,Ra);if(!r||!r.length)return null;var d=n.replace(/^Array<([^>]+)>/,"$1"),p=i.layout;if("WrappedTopic"===d)return Object(c.b)(ya,{value:r,style:i});var b=i["".concat(p,"s")],h=[];return h="Image"===d?Object(c.b)(Xn,{images:r.map((function(t){return{thumbnail:t,origin:Object(S.imgUrl)(t,"r")}})),max:8,onClickPlus:function(){return location.href="/topic/".concat(s,"/images")}}):r.map((function(t,e){return Object(c.b)(Ta,Object.assign({target:{type:d,value:t},preset:l},b&&{style:{flex:"0 0 ".concat(1/b*100,"%")}}),function(t){var e=t.topic||t;return e.id||e.name}(t||e))})),Object(c.b)("div",Object.assign(Object.assign({},u),{},{className:H()("TopicCommonArray",{"TopicCommonArray--topic":"Topic"===d,"TopicCommonArray--image":"Image"===d,"TopicCommonArray--primary":"primary"===l}),children:h}))}}]),n}(d.Component);function Na(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var xa=function(t){Object(l.a)(n,t);var e=Na(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.target,n=t.target.value,a=t.topicId;return n?e.type.includes("Array")?Object(c.b)(Ia,Object.assign(Object.assign({},this.props),{},{topicId:a})):Object(c.b)(Ta,Object.assign({},this.props)):null}}]),n}(d.Component),Sa=Object(Rt.a)()(xa),Ea=function(t){var e=t.target.value;return Object(c.b)("div",{children:e.map((function(t){var e=t.target.value;return!e||Array.isArray(e)&&0===e.length?null:Object(c.c)("div",{className:"TopicCommonIntroTable-item",children:[Object(c.b)("div",{className:"TopicCommonIntroTable-name",children:t.name}),Object(c.b)("div",{className:"TopicCommonIntroTable-value",children:Object(c.b)(Sa,{target:t.target,preset:"primary"})})]},t.name)}))})};function Aa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ba=function(t){Object(l.a)(n,t);var e=Aa(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.modules,n=t.id,a=t.isZhihuWiki,r=t.sectionClassName;if(!e)return null;var o=e.filter((function(t){var e=t.target;return e&&e.value}));return o.length?Object(c.b)("div",{className:"TopicIntroContent",children:o.map((function(t,e){return Object(c.b)(mn,{className:r,title:a?null:t.name,children:"Table"===t.target.type?Object(c.b)(Ea,{target:t.target}):Object(c.b)(Sa,{target:t.target,topicId:n,preset:"primary",isZhihuWiki:a})},t.name+e)}))}):null}}]),n}(d.Component),Ma=n(65),Pa=n.n(Ma),za=n(1546);function La(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ua=function(t){Object(l.a)(n,t);var e=La(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={expanded:!1},t.handleTrackExpandOnce=Pa()((function(){O.a.trackEvent(null,{id:6391,action:"Expand"})})),t.handleToggleExpanded=function(){t.handleTrackExpandOnce(),t.setState((function(t){return Object.assign(Object.assign({},t),{},{expanded:!t.expanded})}))},t}return Object(i.a)(n,[{key:"shownAbstracts",get:function(){var t=this.props.abstracts;return this.state.expanded?t:t.slice(0,3)}},{key:"abstractsCount",get:function(){return this.props.abstracts.length}},{key:"hasMoreAbstracts",get:function(){return this.abstractsCount>3}},{key:"componentDidMount",value:function(){Object(yn.onViewedOnce)(this.node,(function(){O.a.trackCardShow(null,{id:6390})}))}},{key:"render",value:function(){var t=this,e=this.props,n=e.id,a=e.hasEditPermission,r=this.state.expanded;return Object(c.c)("div",{className:"TopicAbstract",ref:function(e){t.node=e},children:[Object(c.c)("div",{className:"TopicAbstract-header",children:[Object(c.b)("div",{className:"TopicAbstract-title",children:"百科摘录"}),Object(c.b)("span",{className:"TopicAbstract-count",children:this.abstractsCount}),a&&Object(c.b)(et.a,{className:"TopicAbstract-button",preset:"plain",to:"/topic/".concat(n,"/abstract-edit"),icon:$.a,label:"编辑百科摘录",a:!0})]}),Object(c.b)("div",{className:"TopicAbstract-content",children:this.shownAbstracts.map((function(t){var e=t.objectType,n=t.author,a=t.member,r=t.title,o=t.url,i=t.content,l=t.sid,s=t.created;return Object(c.b)(za.a,{type:e,author:n,member:a,title:r,url:o,content:i,created:s,theme:"expand"},l)}))}),this.hasMoreAbstracts&&Object(c.b)(Ze.a,{bottom:r,children:Object(c.b)("div",{className:H()("TopicAbstract-footer",{"TopicAbstract-footer--expanded":r}),children:Object(c.c)(N.c,{className:"TopicAbstract-action",preset:"plain",onClick:this.handleToggleExpanded,children:[r?"收起摘录":"查看全部 ".concat(this.abstractsCount," 个摘录"),r?Object(c.b)(hn.a,{size:16,center:!0}):Object(c.b)(Ge.a,{size:16,center:!0})]})})})]})}}]),n}(d.Component);function Da(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Wa={sogou:"搜狗百科"},Va=function(t){Object(l.a)(n,t);var e=Da(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"hasAddBaikeSummaryPermission",get:function(){var t=this.props.currentUser;return t&&t.hasAddBaikeSummaryPermission}},{key:"render",value:function(){var t=this.props,e=t.item,n=t.item,a=n.copyright,r=(a=void 0===a?{}:a).dataSource,o=a.sourceLink,i=n.references,l=void 0===i?[]:i,s=n.abstract,u=t.params.id;if(!e||!e.modules)return null;var p=e.modules.filter((function(t){var e=t.target;return e&&e.value})),b=e.category===k,h=Boolean(s&&s.length),f=Boolean(p.length);return Object(c.c)(d.Fragment,{children:[f&&Object(c.c)(v.d,{children:[Object(c.b)(Ba,{modules:p,id:u,isZhihuWiki:b}),Array.isArray(l)&&l.length>0&&Object(c.c)("div",{className:"ReferenceMeta",children:[Object(c.b)("h2",{children:"参考文献"}),Object(c.b)("ol",{children:l.map((function(t){var e=t.text,n=t.link;return e||n?Object(c.b)("li",{children:n?Object(c.b)("a",{className:"ReferenceMeta-link",href:n,children:e||n}):Object(c.b)("span",{className:"ReferenceMeta-text",children:e})},e+n):null}))})]}),!b&&Wa[r]&&Object(c.c)("div",{className:"CopyRightMeta",children:[Object(c.c)("div",{className:"CopyRightInfo",children:[Object(c.b)("img",{src:va.a,alt:""}),Object(c.c)("p",{children:["数据由",Wa[r],"提供"]})]}),Object(c.c)("a",{className:"CopyRightSource",href:o,children:["查看百科全文 ",Object(c.b)(xn.a,{text:!0,center:!0})]})]})]}),h&&Object(c.b)(v.d,{children:Object(c.b)(Ua,{abstracts:s,id:u,hasEditPermission:this.hasAddBaikeSummaryPermission})})]})}}]),n}(d.Component),_a=Object(I.compose)(Object(fa.b)(),r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{topic:Object(tt.bb)(t,{id:n.id})}})))(Va);function Fa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var qa=function(t){Object(l.a)(n,t);var e=Fa(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props.topic.introduction;return Object(c.b)(v.d,{children:Object(c.b)(mn,{title:"简介",children:Object(c.b)(jn.a,{className:"OldTopicIntro-intro TopicMovieIntro-sectionDrama",html:t})})})}}]),n}(d.Component);function Ha(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ga=function(t){Object(l.a)(n,t);var e=Ha(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.topic;t.route.path;e&&this.nextTopicReady()}},{key:"componentWillReceiveProps",value:function(t){var e=this.props.topic,n=t.topic;n&&(e||{}).id!==n.id&&this.nextTopic(t)}},{key:"nextTopicReady",value:function(t){var e=t||this.props,n=e.topic,a=e.item,c=e.loadIntro,r=e.loadTopicWikiEditInfo,o=e.params.id;n.meta&&void 0===a&&c(o),r(o)}},{key:"render",value:function(){var t=this.props,e=t.item,n="topic"===t.topic.type?Object(c.b)(qa,Object.assign({},this.props)):null;if(!e)return n;switch(e.category){case"variety_show":case"tv":case"movie":return Object(c.b)(ea,Object.assign({},this.props));case"book":return Object(c.b)(sa,Object.assign({},this.props));case"game":return Object(c.b)(ha,Object.assign({},this.props));default:return e.category&&e.category.startsWith("n_")?Object(c.b)(_a,Object.assign({},this.props)):null}}}]),n}(d.Component);Ga.fetchData=function(t){var e=t.dispatch,n=t.params.id;return e(Object(tt.o)(n)).then((function(t){if(t&&t.payload&&"topic"===t.payload.category){var e=new Error;throw e.status=302,e.redirect="/topic/".concat(n),e}return t}))};var Ka=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params;return{topic:Object(tt.bb)(t,{id:n.id}),item:Object(tt.X)(t,{id:n.id}),wikiEditInfo:Object(tt.eb)(t,{id:n.id})}}),{loadIntro:tt.o,loadTopicWikiEditInfo:tt.G}))(Ga),Za=n(218),Qa=n(1318),Xa=n(944),Ja=n(962),Ya=n(1049),$a=n(1088);function tc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function ec(t){var e=function(t){var e=t.item;switch(e.type){case"answer":return Object(c.b)(Xa.a,{answer:e});case"article":return Object(c.b)(Ja.a,{article:e});case"pin":return Object(c.b)(Ya.a,{pin:e});case"people":return Object(c.b)(de.a,{user:e});case"question":return Object(c.b)($a.a,{question:e});default:return null}}({item:t.item.target});return e?Object(c.b)(le.a,{children:e}):null}var nc=function(t){Object(l.a)(n,t);var e=tc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={expanded:!1},t.handleClick=function(){return t.setState({expanded:!t.state.expanded})},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props.item||{},e=t.title,n=t.data;if(!n||!n.length)return null;var a=this.state.expanded,r=!a&&n.length>2,o=r?n.slice(0,2):n;return Object(c.c)(v.d,{className:"TopicCreatorModule",children:[e&&Object(c.b)(v.b,{children:e}),o.map((function(t,e){return Object(c.b)(ec,{item:t},e)})),r&&Object(c.b)(N.c,{className:"TopicCreatorModule-more",onClick:this.handleClick,children:a?"收起":"查看更多"})]})}}]),n}(d.Component),ac=Object(Rt.a)()(nc);function cc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var rc=function(t){Object(l.a)(n,t);var e=cc(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t,e=this.props,n=e.topic,a=e.topic,r=a.meta,o=a.id,i=e.intro;if(!r)return null;var l=i.content.meta,s=l.category,u=l.content;switch(s){case"variety_show":case"tv":case"movie":var d=u.drama,p=(u.celebrities||[]).map((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.role,n=t.list;return n&&n.map((function(t){return Object.assign(Object.assign({},t),{},{role:e})}))})).reduce((function(t,e){return[].concat(Object(bn.a)(t),Object(bn.a)(e||[]))}),[]),b=Object.assign(Object.assign({},d&&{"剧情概要":d}),p.length&&{"影人":p.map((function(t){var e=t.name,n=t.role;return"".concat(e).concat("导演"===n?"（导演）":"")})).join(" / ")});t=Object.keys(b).filter((function(t){return Boolean(b[t])})).map((function(t){return Object(c.c)("p",{className:"TopicHot-introItem",children:[Object(c.c)("b",{children:[t,"："]}),b[t]]},t)}));break;case"book":var h=u.summary,f=((u.authors||[]).slice(0,1)||{}).abstract,m=Object.assign(Object.assign({},h&&{"书籍介绍":Object(c.b)(jn.a,{html:h,inline:!0})}),f&&{"作者简介":f});t=Object.keys(m).filter((function(t){return Boolean(m[t])})).map((function(t){return Object(c.c)("p",{className:"TopicHot-introItem",children:[Object(c.c)("b",{children:[t,"："]}),m[t]]},t)}));break;default:t=r.summary&&Object(c.b)("p",{className:"TopicHot-introItem",dangerouslySetInnerHTML:{__html:r.summary}})}var O=((u||{}).screenshotsCollection||[]).filter(Boolean),j=((u||{}).photos||[]).filter((function(t){return t&&t.olonk&&/zhimg\.com/.test(t.olonk)})),g=[].concat(Object(bn.a)(O),Object(bn.a)(j.map((function(t){return t.olonk})))).map((function(t){return{thumbnail:t,origin:Object(S.imgUrl)(t,"r")}})),y=Boolean(g.length)&&Object(c.c)("div",{children:[Object(c.c)("div",{children:[Object(c.b)("b",{children:"图片"}),Object(c.b)("span",{className:"TopicHotIntroItem-imagesLength",children:g.length})]}),Object(c.b)("div",{className:"TopicHotIntroItem-images",children:Object(c.b)(Xn,{max:8,images:g,onClickPlus:function(){return location.href="/topic/".concat(o,"/images")}})})]});return t||y?Object(c.b)(v.d,{children:Object(c.c)(v.c,{children:[t&&Object(c.c)("div",{className:"TopicHotIntroItem-item",children:[t,Object(c.b)(et.a,{preset:"link",to:"/topic/".concat(n.id,"/intro"),children:"查看更多简介"})]}),y&&Object(c.b)("div",{className:"TopicHotIntroItem-item",children:y})]})}):null}}]),n}(d.Component),oc=Object(Rt.a)()(rc);function ic(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var lc={hot:{load:tt.m,selector:tt.V},newest:{load:tt.x,selector:tt.Y}};function sc(){for(var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hot",n=arguments.length,a=new Array(n>1?n-1:0),c=1;c<n;c++)a[c-1]=arguments[c];return(t=lc[e]).load.apply(t,a)}var uc=function(t){Object(l.a)(n,t);var e=ic(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleLoad=function(e){var n=e||t.props,a=n.load,c=n.params.id,r=n.route.path;n.items.length<10?a(r,c,{limit:10}):a(r,c)},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.params.id,n=(t.route.path,t.intro),a=t.topic,c=t.loadIntro;a.meta&&!n&&c(e)}},{key:"componentWillReceiveProps",value:function(t){var e=this.props,n=e.params.id,a=e.route.path;n===t.params.id&&a===t.route.path||this.handleLoad(t)}},{key:"render",value:function(){var t=this.props,e=t.isDrained,n=t.isFetching,a=t.items,o=t.topic,i=t.route.path,l=t.stickyModule,s=t.intro,u=o.id,d=o.meta,p=Object(c.c)(le.a,{className:"TopicFeedList-header",children:[Object(c.b)("div",{className:"TopicFeedList-sort",children:"".concat("hot"===i?"热门":"时间","排序")}),Object(c.b)(r.Link,{className:"TopicFeedList-sortSwitch",to:"/topic/".concat(u,"/").concat("hot"===i?"newest":"hot"),children:"切换为".concat("hot"===i?"时间":"热门","排序")})]}),b=Object(c.b)(Qa.a,{header:p,isDrained:e,isFetching:n,items:a,onLoad:this.handleLoad});return"newest"===i?b:Object(c.c)(Za.b,{selector:".List-item,.TopicCreatorModule-more",children:[d&&s&&Object(c.b)(oc,{topic:o,intro:s}),Object(c.b)(ac,{item:l}),b]})}}]),n}(d.Component);uc.fetchData=function(t){var e=t.dispatch,n=t.params.id;return e(sc(t.route.path,n,{limit:10}))};var dc=Object(f.connect)((function(t,e){var n=e.route,a=e.params;return Object.assign({topic:Object(tt.bb)(t,{id:a.id}),intro:Object(tt.X)(t,{id:a.id})},function(){for(var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hot",n=arguments.length,a=new Array(n>1?n-1:0),c=1;c<n;c++)a[c-1]=arguments[c];return(t=lc[e]).selector.apply(t,a)}(n.path,t,{id:a.id}))}),{load:sc,loadIntro:tt.o})(uc),pc=n(1011);function bc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var hc=function(t){Object(l.a)(n,t);var e=bc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleLoad=function(){var e=t.props,n=(e.items,e.loadTop),a=e.next;n(e.params.id,{endpoint:a})},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.props.route.path}},{key:"render",value:function(){var t=this.props,e=t.isDrained,n=t.isFetching,a=t.items;return Object(c.b)(pc.b,{value:{showLabels:!0,showLabelInfo:!1},children:Object(c.b)(Za.b,{selector:".List-item",children:Object(c.b)(Qa.a,{isDrained:e,isFetching:n,items:a,onLoad:this.handleLoad})})})}}]),n}(d.Component);hc.fetchData=function(t){var e=t.dispatch,n=t.params;return e(Object(tt.z)(n.id))};var fc=Object(f.connect)((function(t,e){return Object.assign({},Object(tt.cb)(t,{id:e.params.id}))}),{loadTop:tt.z})(hc);function mc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var vc={unanswered:{load:tt.I,selector:tt.db},questions:{load:tt.y,selector:tt.ab}};function Oc(t){for(var e,n=arguments.length,a=new Array(n>1?n-1:0),c=1;c<n;c++)a[c-1]=arguments[c];return(e=vc[t]).load.apply(e,a)}var jc=function(t){Object(l.a)(n,t);var e=mc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleLoad=function(e){var n=e||t.props,a=n.load,c=n.params.id,r=n.route.path;n.items;a(r,c)},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.props.route.path}},{key:"componentWillReceiveProps",value:function(t){var e=this.props,n=e.params.id,a=e.route.path;n===t.params.id&&a===t.route.path||this.handleLoad(t)}},{key:"render",value:function(){var t=this.props,e=t.isDrained,n=t.isFetching,a=t.items,o=t.params.id,i=t.route.path,l=Object(c.c)(le.a,{className:"TopicFeedList-header",children:[Object(c.b)("div",{className:"TopicFeedList-sort",children:"".concat("unanswered"===i?"热门":"全部","问题")}),Object(c.b)(r.Link,{className:"TopicFeedList-sortSwitch",to:"/topic/".concat(o,"/").concat("unanswered"===i?"questions":"unanswered"),children:"切换为".concat("unanswered"===i?"全部":"热门","问题")})]});return Object(c.b)(Za.b,{selector:".List-item",children:Object(c.b)(Qa.a,{header:l,isDrained:e,isFetching:n,items:a,sort:i,onLoad:this.handleLoad})})}}]),n}(d.Component);jc.fetchData=function(t){var e=t.dispatch,n=t.params.id;return e(Oc(t.route.path,n))};var gc=Object(f.connect)((function(t,e){return Object.assign({},function(t){for(var e,n=arguments.length,a=new Array(n>1?n-1:0),c=1;c<n;c++)a[c-1]=arguments[c];return(e=vc[t]).selector.apply(e,a)}(e.route.path,t,{id:e.params.id}))}),{load:Oc})(jc);function yc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Cc=function(t){Object(l.a)(n,t);var e=yc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleChange=function(e){t.props.onChange(e.target.value)},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.value,n=t.placeholder,a=t.max,r=t.rich,o=t.className,i={value:e,onChange:this.handleChange,placeholder:n,autoFocus:!0,className:o};return Object(c.c)("div",{children:[r?Object(c.b)(L.a,Object.assign({rows:3},i)):Object(c.b)(P.a,Object.assign({spread:!0},i)),a&&Object(c.b)(z.a,{current:Math.round(Object(U.stringWidth)(e)/2),max:a})]})}}]),n}(d.Component);function wc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Tc=function(t){Object(l.a)(n,t);var e=wc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleChange=function(e){var n=t.inputEl.files[0],a=t.props,c=a.onError,r=a.max,o=a.onChange;if(n.size>1024*r*1024)return c(new Error("请上传小于 ".concat(r,"M 的图片。"))),void t.resetUpload();o(e),t.resetUpload()},t.resetUpload=function(){t.inputEl.value=""},t.handleRef=function(e){t.inputEl=e},t.handleClick=function(){return t.inputEl.click()},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.icon,n=t.spread,a=t.masked,r=t.url,o=t.children,i=t.className,l=t.placeholder,s=e||On.a;return Object(c.c)("div",{className:H()("ImageUploader",i,{"ImageUploader--spread":n}),children:[o,r&&Object(c.b)(A.a,{className:"ImageUploader-image",src:r}),Object(c.c)("div",{className:H()("ImageUploader-main",{"is-masked":a}),role:"button",tabIndex:0,"aria-label":"上传图片",onClick:this.handleClick,children:[Object(c.b)(s,{size:36,className:"ImageUploader-icon"}),l&&Object(c.b)("div",{className:"ImageUploader-placeholder",children:l})]}),Object(c.b)("input",{type:"file",accept:"image/png,image/jpeg",style:{display:"none"},ref:this.handleRef,onChange:this.handleChange})]})}}]),n}(d.Component);Tc.propTypes={url:M.a.string,masked:M.a.bool,spread:M.a.bool,placeholder:M.a.string,max:M.a.number,onError:M.a.func,onChange:M.a.func},Tc.defaultProps={masked:!0,placeholder:"添加图片",max:Se.S};var Rc=Tc;function kc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ic=function(t){Object(l.a)(n,t);var e=kc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleChange=function(e){var n=t.props,a=n.uploadImage,c=n.uploadId,r=n.onChange,o=a(e.target.files[0],c);o.then&&o.then((function(){return r(t.props.upload.url,t.props.upload.id)}))},t.handleError=function(e){t.props.showNotification(e.message,"red")},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.value,n=t.isArray;return Object(c.b)(Rc,{className:H()("TopicEditFieldImage",{"TopicEditFieldImage--isArray":n}),url:e,masked:!0,onChange:this.handleChange,placeholder:null,onError:this.handleError})}}]),n}(d.Component),Nc=Object(f.connect)((function(t){return{uploadId:"topic_meta_image",upload:Object(pt.c)(t,{id:"topic_meta_image"})}}),{uploadImage:pt.b,showNotification:ht.h})(Ic),xc=n(264),Sc=n(1398),Ec=n.n(Sc),Ac=n(1228),Bc=["placeholder"];function Mc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}function Pc(t){return t.name.startsWith("创建 ")&&t.name.endsWith(" 话题")}var zc=function(t){Object(l.a)(n,t);var e=Mc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={value:(t.props.value||{}).name,items:[]},t.handleChange=function(e){t.setState({value:e});var n=t.props,a=n.isArray,c=n.onChange;a||c({name:e});var r=t.props.value||[],o=Array.isArray(r)?r:[r];Object(xc.c)(e,o.map((function(t){return t.name})),{topic_filter:1}).then((function(n){n=Object(Ac.a)(n);var a=t.props.currentUser;if(a&&a.canEditTopic){var c=e;n=n.find((function(t){return t.name===c}))?n:[].concat(Object(bn.a)(n),[{urlToken:"topic",name:"创建 ".concat(c," 话题"),token:c}])}t.setState({items:n})}))},t.handleSelect=function(e,n){var a=t.props,c=a.onChange,r=a.isArray,o=a.createTopic;if(Pc(n)){var i=o(n.token);Ec()(i)&&c&&i.then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.payload;c&&c(Object.assign(Object.assign({},e),{},{id:n.id||n.urlToken}))}))}else c&&c(Object.assign(Object.assign({},n),{},{id:n.id||n.urlToken}));r&&t.setState({value:""})},t.handleKeyDown=function(e){if(13===e.keyCode){e.preventDefault();var n=t.props,a=n.onChange,c=n.isArray,r=t.state.value;a&&a({name:r}),c&&t.setState({value:""})}},t.createTopic=function(e){(0,t.props.createTopic)(e).then((function(n){var a=n.payload,c=a.id,r=a.avatarUrl,o=t.props,i=o.value,l=o.onChange;l&&l(i.map((function(t){return t.name===e?{urlToken:c,name:e,avatarUrl:r}:t})))})).catch((function(){var n=t.props,a=n.value,c=n.onChange;c&&c(a.filter((function(t){return t.name!==e})))}))},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){(0,this.props.fillCurrentUserIfNeeded)(["canEditTopic"])}},{key:"render",value:function(){var t=this.state,e=t.value,n=t.items,a=this.props,r=a.placeholder,o=Object(wn.default)(a,Bc);return Object(c.b)(at.b,Object.assign(Object.assign({},o),{},{value:e,onChange:this.handleChange,items:n,autoSelect:!1,onSelect:this.handleSelect,inputProps:{placeholder:r,autoFocus:!0,spread:!0,onKeyDown:this.handleKeyDown}}))}}]),n}(d.Component),Lc=Object(f.connect)((function(t){return{currentUser:Object(ft.b)(t)}}),{createTopic:tt.f,fillCurrentUserIfNeeded:ft.e})(zc);function Uc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Dc=function(t){Object(l.a)(n,t);var e=Uc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleChange=function(e){t.props.onChange(Math.round(new Date(e.target.value).valueOf()/1e3))},t}return Object(i.a)(n,[{key:"render",value:function(){return Object(c.b)(P.a,{className:"TopicFieldDateTime",type:"date",value:Object(ua.toDateString)(this.props.value),onChange:this.handleChange})}}]),n}(d.Component),Wc=["target"];function Vc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var _c=function(t){Object(l.a)(n,t);var e=Vc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleChange=function(e){var n=t.props,a=n.target;(0,n.onChange)(a?Object.assign(Object.assign({},a),{},{value:e}):e)},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.target,n=Object(wn.default)(t,Wc),a=this.props.type||e&&e.type,r=Object.assign(Object.assign({},n),{},{value:e&&e.value,onChange:this.handleChange});switch(a){case"String":return Object(c.b)(Cc,Object.assign({},r));case"Image":return Object(c.b)(Nc,Object.assign({},r));case"Topic":return Object(c.b)(Lc,Object.assign({},r));case"Datetime":return Object(c.b)(Dc,Object.assign({},r));default:return null}}}]),n}(d.Component);function Fc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var qc=function(t){var e=t.target,n=t.onRemove,a="Image"===(t.type||e.type);return Object(c.c)("div",{className:H()("TopicEditArray-item",a?"TopicEditArray-item--block":"TopicEditArray-item--line"),children:[Object(c.b)(Sa,{target:e}),n&&Object(c.b)(N.c,{className:"TopicEditArray-closeButton",preset:"plain",onClick:n,children:Object(c.b)(Sn.a,{center:!0,width:18,height:18,fill:"#d3d3d3"})})]})};var Hc=function(t){Object(l.a)(n,t);var e=Fc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleAdd=function(e,n){var a=t.props,c=a.target,r=a.target.value,o=a.onChange,i=Object(bn.a)(r||[]);i.find((function(t){return t===e||e.id&&t.id===e.id||e.name&&t.name===e.name}))||o(Object.assign(Object.assign({},c),{},{value:[e].concat(Object(bn.a)(i)),rawValue:[n||e].concat(Object(bn.a)(i))}))},t.handleRemove=function(e,n){var a=t.props,c=a.target,r=a.target.value,o=a.onChange,i=Object(bn.a)(r||[]);i.splice(n,1),o(Object.assign(Object.assign({},c),{},{value:i}))},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.target,r=n.type,o=n.value,i=e.placeholder,l=r.replace(/^Array<([^>]+)>/,"$1"),s=(o||[]).map((function(e,n){return Object(c.b)(qc,{target:{type:l,value:e},onRemove:function(){return t.handleRemove(e,n)}},e.id||e.name||e)})),u="Image"===l?[kn,{column:6,margin:8}]:["div"],d=Object(a.a)(u,2),p=d[0],b=d[1];return Object(c.c)(p,Object.assign(Object.assign({className:H()("TopicEditArray",{"TopicEditArray--topic":"Topic"===l})},b),{},{children:[Object(c.b)(_c,{className:"TopicEditArray-input",type:l,placeholder:i,onChange:this.handleAdd,isArray:!0}),s]}))}}]),n}(d.Component);function Gc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Kc=function(t){Object(l.a)(n,t);var e=Gc(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){return this.props.target.type.includes("Array")?Object(c.b)(Hc,Object.assign({},this.props)):Object(c.b)(_c,Object.assign({},this.props))}}]),n}(d.Component);function Zc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Qc=function(t){Object(l.a)(n,t);var e=Zc(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={isEditing:!1,value:(t.props.target||{}).value,rawValue:(t.props.target||{}).value},t.isDisabled=function(){var e=t.state.rawValue;return Boolean(!e||Array.isArray(e)&&!e.length)},t.handleBeforUnload=function(e){if(t.state.isEditing){return(e||window.event).returnValue="尚未保存，确定离开此页？","尚未保存，确定离开此页？"}},t.handleToggleEdit=function(){t.setState({isEditing:!t.state.isEditing})},t.handleChange=function(e){t.setState({value:e.value,rawValue:e.rawValue||e.value})},t.handleSubmit=function(e){if(e.preventDefault(),!t.isDisabled()){var n=t.props,a=n.target.name,c=n.onSubmit,r=t.state.rawValue,o=c(Object(yt.a)({},a,r));o.then&&o.then((function(){return t.setState({isEditing:!1})}))}},t.handleCreateChange=function(e){var n=t.props,a=n.onChange,c=n.name,r=n.target;a({name:c,target:Object.assign(Object.assign({},r),e)})},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.handleBeforUnload)}},{key:"render",value:function(){var t=this.props,e=t.target,n=t.name,a=t.onSubmit,r=t.topicId,o=this.state,i=o.isEditing,l=o.value;return a?Object(c.b)("div",{className:"TopicEditItem",children:i?Object(c.b)("form",{onSubmit:this.handleSubmit,noValidate:!0,children:Object(c.c)("div",{className:"TopicEditItem-formContent",children:[Object(c.b)(Kc,{placeholder:"添加".concat(n),target:Object.assign(Object.assign({},e),{},{value:l}),onChange:this.handleChange}),Object(c.c)("div",{className:"TopicEditItem-formActions",children:[Object(c.b)(N.c,{preset:"primary",color:"blue",type:"submit",disabled:this.isDisabled(),children:"保存"}),Object(c.b)(N.c,{onClick:this.handleToggleEdit,children:"取消"})]})]})}):Object(c.c)("div",{className:"TopicEditItem-displayContent",children:[Object(c.b)(Sa,{topicId:r,target:e}),Object(c.b)("div",{className:"TopicEditItem-displayActions",children:Object(c.b)(N.c,{preset:"link",onClick:this.handleToggleEdit,icon:$.a,label:"修改"})})]})}):Object(c.b)("div",{className:"TopicEditItem",children:Object(c.b)(Kc,{placeholder:"添加".concat(n),target:e,onChange:this.handleCreateChange})})}}]),n}(d.Component),Xc=["target"];function Jc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Yc=function(t){Object(l.a)(n,t);var e=Jc(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.target.value,n=Object(wn.default)(t,Xc);return Object(c.b)("div",{className:"TopicEditTable",children:e.map((function(t){var e=t.target,a=t.name;return Object(c.c)("div",{className:"TopicEditTable-item",children:[Object(c.b)("div",{className:"TopicEditTable-name",children:a}),Object(c.b)("div",{className:"TopicEditTable-value",children:Object(c.b)(Qc,Object.assign(Object.assign({},n),{},{target:e,name:a}))})]},a)}))})}}]),n}(d.Component);function $c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var tr=function(t){Object(l.a)(n,t);var e=$c(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.name,n=t.component,a=void 0===n?"div":n,r=t.children;return Object(c.c)(a,{className:"TopicEditModuleUI",children:[Object(c.b)("div",{className:"TopicEditModuleUI-title",children:e}),r]})}}]),n}(d.Component),er=["module","module","topicId"];function nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var ar=function(t){Object(l.a)(n,t);var e=nr(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"renderContent",value:function(){var t=this.props,e=t.module.target,n=t.module,a=t.topicId,r=Object(wn.default)(t,er);return"Table"===e.type?Object(c.b)(Yc,Object.assign(Object.assign({},n),r)):Array.isArray(e)?Object(c.b)(Yc,Object.assign({target:{value:e}},r)):Object(c.b)(Qc,Object.assign(Object.assign({topicId:a},n),r))}},{key:"render",value:function(){var t=this.props.module.name;return Object(c.b)(tr,{name:t,children:Object(c.b)("div",{className:"TopicEditMoudle-content",children:this.renderContent()})})}}]),n}(d.Component),cr=n(1652);function rr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var or=function(t){Object(l.a)(n,t);var e=rr(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleUpload=function(e){var n=t.props,a=n.target,c=n.uploadImage,r=n.uploadId,o=n.onChange;c(e.target.files[0],r).then((function(){var e=t.props.image;o({target:Object.assign(Object.assign({},a),{},{value:e.url,rawValue:e.id})})}))},t.handleError=function(e){t.props.showNotification(e.message,"red")},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.target,n=e.value,a=e.style,r=t.avatarUrl,o=n||r,i=["rectangle","square"][(a||{}).imageTemplate];return Object(c.b)("div",{className:H()("TopicEditAvatar",Object(yt.a)({},"TopicEditAvatar--".concat(i),i)),children:Object(c.b)(Rc,{spread:!0,masked:!0,url:Object(S.imgUrl)(o,"mdpi"),onChange:this.handleUpload,onError:this.handleError,placeholder:"修改图片",icon:cr.a})})}}]),n}(d.Component),ir=Object(f.connect)((function(t,e){var n=e.topic;if(!n)return{};var a="topic_".concat(n.id,"_meta");return{uploadId:a,image:Object(pt.c)(t,{id:a})}}),{uploadImage:pt.b,showNotification:ht.h})(or);function lr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var sr=function(t){Object(l.a)(n,t);var e=lr(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.title,a=t.id,r=t.modules,o=t.side,i=t.onSubmit,l=i?"form":"div";return Object(c.b)(v.d,{className:"TopicEdit",children:Object(c.c)(l,{onSubmit:i,children:[Object(c.b)(n.Header,{id:a,title:e}),Object(c.c)("div",{className:"TopicEdit-main",children:[Object(c.b)("div",{className:"TopicEdit-modules",children:r}),Object(c.b)("div",{className:"TopicEdit-side",children:o})]}),i&&Object(c.b)(N.c,{className:"TopicEdit-submit",preset:"primary",color:"blue",type:"submit",children:"提交"})]})})}}]),n}(d.Component);sr.Header=function(t){var e=t.title,n=t.id;return Object(c.c)("div",{className:"TopicEdit-header",children:[Object(c.b)("div",{className:"TopicEdit-headerTitle",children:e}),Object(c.b)("div",{children:Object(c.c)(et.a,{preset:"plain",to:"/topic/".concat(n),children:["返回话题主页",Object(c.b)(xn.a,{center:!0})]})})]})};var ur=sr;function dr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var pr=function(t){Object(l.a)(n,t);var e=dr(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleAvatarChange=function(e){var n=e.target,a=n.rawValue,c=n.value;t.handleSubmit({avatar:a||c})},t.handleSubmit=function(e){var n=t.props,a=n.params.id;return(0,n.updateMeta)(a,e)},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.params.id,n=t.topic,a=t.meta,c=t.loadFullTopic,r=t.loadMeta;n||c(e),a||r(e)}},{key:"render",value:function(){var t=this,e=this.props,n=e.params.id,a=e.meta,r=void 0===a?[]:a,o=e.topic,i=r.reduce((function(t,e){return"avatar"===e.target.name?Object.assign(Object.assign({},t),{},{avatar:e}):Object.assign(Object.assign({},t),{},{modules:[].concat(Object(bn.a)(t.modules),[e])})}),{modules:[]}),l=i.modules,s=i.avatar;return Object(c.b)(ur,{id:n,title:"编辑".concat(T[(o.meta||{}).category]||"","信息"),modules:l.map((function(e,a){return Object(c.b)(ar,{topicId:n,module:e,onSubmit:t.handleSubmit},a)})),side:s&&Object(c.b)(ir,Object.assign({topic:o,onChange:this.handleAvatarChange},s))})}}]),n}(d.Component);pr.fetchData=function(t){var e=t.dispatch,n=t.params.id;return Promise.all([e(Object(tt.l)(n)),e(Object(tt.u)(n)).then((function(t){if(t&&t.payload&&"topic"===t.payload.category){var e=new Error;throw e.status=302,e.redirect="/topic/".concat(n),e}return t}))])};var br=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params.id;return{topic:Object(tt.bb)(t,{id:n}),meta:Object(tt.L)(t,{id:n})}}),{loadFullTopic:tt.l,loadMeta:tt.u,updateMeta:tt.ib}))(pr);function hr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var fr=function(t){Object(l.a)(n,t);var e=hr(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={value:{}},t.handleBeforUnload=function(e){if(Object.keys(t.state.value).length){return(e||window.event).returnValue="尚未保存，确定离开此页？","尚未保存，确定离开此页？"}},t.handleSubmit=function(e){e.preventDefault();var n=t.props,a=n.params,c=a.id,r=a.type,o=n.createMeta,i=t.state.value;o(c,r,Object.keys(i).reduce((function(t,e){var n=i[e],a=n.value,c=n.rawValue||a;return Object.assign(Object.assign({},t),{},Object(yt.a)({},e,c))}),{})).then((function(){t.props.router.push("/topic/".concat(c))}))},t.handleChange=function(e){var n=t.state.value,a=e.target.name;t.setState({value:Object.assign(Object.assign({},n),{},Object(yt.a)({},a,e.target))})},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.params.type,n=t.category,a=t.loadMetaCategory;n||a(e),window.addEventListener("beforeunload",this.handleBeforUnload)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.handleBeforUnload)}},{key:"render",value:function(){var t=this,e=this.props,n=e.category,a=e.params,r=a.id,o=a.type,i=this.state.value,l=i.avatar&&i.avatar.value,s=(n||[]).reduce((function(t,e){return"avatar"===e.target.name?Object.assign(Object.assign({},t),{},{avatar:e}):Object.assign(Object.assign({},t),{},{modules:[].concat(Object(bn.a)(t.modules),[e])})}),{modules:[]}),u=s.modules,d=s.avatar;return Object(c.b)(ur,{id:r,title:"编辑为".concat(T[o]||""),modules:u.map((function(e,n){var a=e.target,r=e.target.name,o=i[r]?i[r].value:a.value,l="Table"===a.type?a.value.map((function(t){return Object.assign(Object.assign({},t),{},{target:Object.assign(Object.assign({},t.target),i[t.target.name]&&{value:i[t.target.name].value})})})):o;return Object(c.b)(ar,{module:Object.assign(Object.assign({},e),{},{target:Object.assign(Object.assign({},a),{},{value:l})}),onChange:t.handleChange},n)})),side:d&&Object(c.b)(ir,Object.assign(Object.assign({topic:{id:r},onChange:this.handleChange},d),{},{avatarUrl:l})),onSubmit:this.handleSubmit})}}]),n}(d.Component);fr.fetchData=function(t){var e=t.dispatch,n=t.params.type;return e(Object(tt.w)(n))};var mr=Object(f.connect)((function(t,e){var n=e.params;return{category:Object(tt.K)(t,n)}}),{loadMetaCategory:tt.w,createMeta:tt.e})(fr);function vr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Or=function(t){Object(l.a)(n,t);var e=vr(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.introData,n=e.content.meta.content,a=(n=void 0===n?{}:n).screenshotsCollection,r=void 0===a?[]:a,o=n.photos,i=void 0===o?[]:o,l=e.modules,s=void 0===l?[]:l,u=t.topicData,d=u.avatarUrl,p=u.name,b=u.followersCount,f=u.bestAnswersCount,m=t.params.id,O=i.filter((function(t){return t&&t.olonk&&/zhimg\.com/.test(t.olonk)})).map((function(t){return t.olonk})),j=r,g=(s.find((function(t){return"Array<Image>"===t.target.type}))||{}).target,y=(g=void 0===g?{}:g).value,C=void 0===y?[]:y,w=[].concat(Object(bn.a)(O),Object(bn.a)(j),Object(bn.a)(C)).map((function(t){return{thumbnail:t,origin:Object(S.imgUrl)(t,"r")}}));return Object(c.c)("div",{className:"TopicImage-container",children:[Object(c.b)(h.a,{title:p}),Object(c.c)("div",{className:"TopicImageMain-container",children:[Object(c.b)(v.d,{className:"TopicImageMain-backBar",children:Object(c.b)("a",{href:"/topic/".concat(m,"/intro"),children:"返回话题简介"})}),Object(c.c)(v.d,{className:"TopicImageMain-imageListWrapper",children:[Object(c.b)("b",{children:"图片"}),Object(c.b)("span",{className:"TopicHotIntroItem-imagesLength",children:w.length}),Object(c.b)("div",{className:"TopicImageMain-imageList",children:Object(c.b)(Xn,{max:w.length,images:w})})]})]}),Object(c.c)(Ft.a,{className:"TopicImageSidebar-container",offset:Se.i+10,children:[Object(c.c)(v.d,{children:[Object(c.b)(v.a,{children:"所属话题"}),Object(c.c)("a",{href:"/topic/".concat(m),className:"TopicImageSidebar-content",children:[Object(c.b)("img",{src:Object(S.imgUrl)(d,"xl"),height:40,alt:""}),Object(c.c)("div",{children:[Object(c.b)("div",{className:"TopicImageSidebar-contentTitle",children:p}),Object(c.b)("div",{className:"TopicImageSidebar-contentStatus",children:"".concat(Object(Qt.cnNiceNumber)(b),"关注者 · ").concat(Object(Qt.cnNiceNumber)(f),"精华回答")})]})]})]}),Object(c.b)(_t.a,{})]})]})}}]),n}(d.Component);Or.fetchData=function(t){var e=t.dispatch,n=t.params.id;return Promise.all([e(Object(tt.A)(n)),e(Object(tt.o)(n))])};var jr=Object(f.connect)((function(t,e){var n=Object(tt.X)(t,e.params);return{topicData:Object(tt.bb)(t,e.params),introData:n}}),{loadIntro:tt.o,loadTopic:tt.A})(Or),gr=n(101),yr=n(909),Cr=n(123),wr=n(387),Tr=function(t){var e=t.user,n=t.size;return Object(c.c)(Cr.Box,{css:{position:"relative"},size:n,children:[Object(c.b)(m.a,{url:e.avatarUrl,size:n,round:!0}),Object(c.b)(wr.c,{badge:e.badge,css:Object(wr.f)(n)})]})},Rr=n(2597);function kr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Ir=function(t){Object(l.a)(n,t);var e=kr(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"hasVideo",get:function(){var t=this.props.data.thumbnailExtraInfo;return Boolean(t&&"video"===t.type)}},{key:"render",value:function(){var t=this.props.data,e=t.excerpt,n=t.content,a=t.thumbnail;return Object(c.c)("div",{className:"TopicCreatorWall-userModalContentItemExcerpt",children:[Object(c.b)("div",{className:"TopicCreatorWall-userModalContentItemExcerptText",dangerouslySetInnerHTML:{__html:e||n}}),a&&Object(c.c)("div",{className:"TopicCreatorWall-userModalContentItemExcerptImg",children:[Object(c.b)("img",{className:"TopicCreatorWall-userModalContentItemExcerptImgItem",src:a,alt:""}),this.hasVideo&&Object(c.b)("div",{className:"TopicCreatorWall-userModalContentItemExcerptImgMask",children:Object(c.b)("div",{className:"TopicCreatorWall-userModalContentItemExcerptImgMaskRound",children:Object(c.b)(Rr.a,{size:12,className:"TopicCreatorWall-userModalContentItemExcerptImgMaskIcon"})})})]})]})}}]),n}(d.Component);function Nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var xr=function(t){Object(l.a)(n,t);var e=Nr(n);function n(){var t;Object(o.a)(this,n);for(var c=arguments.length,r=new Array(c),i=0;i<c;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))).getUrl=function(e){var n=t.props,c=Object(a.a)(n.userTopicData.contentList,1)[0],r=n.topic.id,o=n.user,i=o.urlToken,l=o.isOrg,s="https://www.zhihu.com/".concat(l?"org":"people","/").concat(i);return"profile"===e?s:"creation"===e?"".concat(s,"/creations/").concat(r):"content"===e?Object(yr.b)(c.type,c.id):void 0},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.shown,n=t.onClose,r=t.userTopicData,o=t.topic,i=t.user;if(!r||!o||!i)return null;var l=o.name,s=r.answerCount,u=r.articleCount,d=r.totalVotes,p=Object(a.a)(r.contentList,1)[0],b=i.name,h=i.headline,f=[{name:"回答",key:"answerCount",data:s},{name:"文章",key:"articleCount",data:u},{name:"赞同",key:"totalVotes",data:d}],m=p.question,v=p.title,O=m?m.title:v;return Object(c.b)(ct.b,{onClose:n,className:"TopicCreatorWall-userModalWrapper",children:e&&Object(c.c)("div",{children:[Object(c.c)("a",{className:"TopicCreatorWall-userModalHeader",target:"_blank",rel:"noopener noreferrer",href:this.getUrl("profile"),"data-za-detail-view-id":3916,children:[Object(c.b)(Tr,{user:i,size:60}),Object(c.c)("div",{className:"TopicCreatorWall-userModalContent",children:[Object(c.b)("div",{className:"TopicCreatorWall-userModalName",children:b}),h&&Object(c.b)("div",{className:"TopicCreatorWall-userModalHeadline",children:Object(c.b)(jn.a,{html:h})})]})]}),Object(c.c)("a",{className:"TopicCreatorWall-userModalCountSection",target:"_blank",rel:"noopener noreferrer",href:this.getUrl("creation"),"data-za-detail-view-id":3919,children:[Object(c.c)("div",{className:"TopicCreatorWall-userModalCountSectionTitle",children:["在"," 「".concat(l,"」 "),"话题下:"]}),Object(c.b)("div",{className:"TopicCreatorWall-userModalCountSectionData",children:f.map((function(t){return Object(c.c)("div",{className:"TopicCreatorWall-userModalCountSectionDataItem",children:[Object(c.b)("div",{className:"TopicCreatorWall-userModalCountSectionDataItemTitle",children:t.name}),Object(c.b)("div",{className:"TopicCreatorWall-userModalCountSectionDataItemData",children:Object(Qt.cnNiceNumber)(t.data)})]},t.key)}))})]}),Object(c.c)("a",{className:"TopicCreatorWall-userModalContentList",target:"_blank",rel:"noopener noreferrer",href:this.getUrl("content"),"data-za-detail-view-id":3917,children:[Object(c.b)("div",{className:"TopicCreatorWall-userModalContentListTitle",children:"近期优质创作"}),Object(c.c)("div",{className:"TopicCreatorWall-userModalContentItem",children:[Object(c.b)("div",{className:"TopicCreatorWall-userModalContentItemTitle",children:O}),Object(c.b)(Ir,{data:p})]})]}),Object(c.c)("a",{className:"TopicCreatorWall-userModalAllCreation",target:"_blank",rel:"noopener noreferrer",href:this.getUrl("creation"),"data-za-detail-view-id":3918,children:["查看此话题下的全部创作",Object(c.b)(xn.a,{center:!0})]}),Object(c.b)(y.a,{zaId:3915,id:i.urlToken,type:"people",preset:"primary",isFollowing:i.isFollowing,className:"TopicCreatorWall-userModalFollowButton"})]})})}}]),n}(d.Component);xr.propTypes={shown:M.a.bool.isRequired,userTopicData:M.a.object,onClose:M.a.func.isRequired,topic:M.a.object};var Sr=Object(f.connect)((function(t,e){var n=e.creator;return{user:Object(gr.c)(t,n)}}))(xr),Er=n(2206),Ar=n.n(Er),Br=n(388),Mr=Object(d.createContext)(null),Pr=Object(d.createContext)((function(){})),zr=Object(d.createContext)(""),Lr=function(t,e){return function(n){return function(a){return Object(c.b)(t,{children:function(t){return Object(c.b)(n,Object.assign(Object.assign({},a),Object(yt.a)({},e,t)))}})}}};function Ur(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Dr=function(t){Object(l.a)(n,t);var e=Ur(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={showModal:!1,userTopicData:null},t.handleOpenModal=function(e){var n=t.props,a=n.loadTopicCreatorWallUserInfo,c=n.user.member,r=c.urlToken,o=c.id,i=n.topic.id,l=n.openModal;O.a.trackEvent(e.target,{id:3914,action:"Click"}),a(i,r).then((function(t){var e=t.payload;l({userTopicData:e,creator:{urlToken:r,id:o}})}))},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props.user,e=t.member,n=e.name,a=e.headline,r=t.member,o=t.isNew,i=t.totalVotes;return Object(c.c)(v.d,{className:"TopicCreatorWall-userCardContainer",onClick:this.handleOpenModal,children:[Object(c.b)(Tr,{size:80,user:r}),Object(c.b)("div",{className:"TopicCreatorWall-userCardName",children:n}),a&&Object(c.b)("div",{className:"TopicCreatorWall-userCardHeadline",children:Object(c.b)(jn.a,{html:a})}),Object(c.c)("div",{className:"TopicCreatorWall-userCardUpVoteCount",children:["话题下获得"," ".concat(Object(Qt.cnNiceNumber)(i)),"赞同"]}),o&&Object(c.b)("div",{className:"TopicCreatorWall-userCardFirst",children:"首次上墙"})]})}}]),n}(d.Component);Dr.propTypes={user:M.a.object.isRequired};var Wr=Object(I.compose)(Object(f.connect)(null,{loadTopicCreatorWallUserInfo:bt.C}),Object(Tt.b)((function(t){return{module:"UserItem",view:{id:3911},content:{member_hash_id:t.user.member.id},trackCardShow:!0}})),Lr(Pr.Consumer,"openModal"),Lr(Mr.Consumer,"topic"))(Dr);function Vr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var _r=function(t){Object(l.a)(n,t);var e=Vr(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.data,n=t.paging,a=n.isEnd,r=n.loading,o=t.onLoad;if(!e)return null;var i=Array.from(Object.assign(Object.assign({},Ar()(e.map((function(t,e){return Object.assign(Object.assign({},t),{},{index:e})})),(function(t){return t.index%4}))),{},{length:4}));return Object(c.b)(se.b,{isDrained:a,isLoading:r,onLoad:o,placeholder:Object(c.b)(Br.a,{className:"topicCreatorWall-listPlaceHolder"}),children:Object(c.b)("div",{className:"topicCreatorWall-list",children:i.map((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;return Object(c.b)("span",{className:"topicCreatorWall-listColumn",children:t.map((function(t){return Object(c.b)(Wr,{user:t},t.member.urlToken)}))},e)}))})})}}]),n}(d.Component),Fr={weekly:"周",monthly:"月"};function qr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Hr=function(t){Object(l.a)(n,t);var e=qr(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={modalProps:{onClose:function(){},shown:!1}},t.handleLoad=function(){var e=t.props;(0,e.loadCreatorWall)({id:e.params.id})},t.handleOpenModal=function(e){var n=e.userTopicData,a=e.creator,c=t.props.topic;t.setState({modalProps:{userTopicData:n,creator:a,onClose:t.handleCloseModal,shown:!0,topic:c}})},t.handleCloseModal=function(){t.setState({modalProps:Object.assign(Object.assign({},t.state.modalProps),{},{shown:!1})})},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.userDataList,n=t.topic,a=t.loadTopic,c=t.params.id;e&&0!==e.length||this.handleLoad(),n||a(c)}},{key:"render",value:function(){var t=this.props,e=t.creatorWallInfo,n=t.topic,a=t.userDataList,r=this.state.modalProps;if(!n||!e)return null;var o=e.updateFrequency,i=e.paging,l=n.avatarUrl,s=n.name,u=n.followersCount,d=n.questionsCount,p=n.id;return Object(c.c)("div",{children:[Object(c.c)(v.d,{className:"topicCreatorWall-HeaderWrapper",children:[Object(c.b)(h.a,{title:"".concat(n.name," - 话题创作知友墙")}),Object(c.c)("div",{className:"topicCreatorWall-Header",children:[Object(c.c)("div",{children:[Object(c.b)("div",{className:"topicCreatorWall-HeaderTitle",children:"话题创作知友墙"}),Object(c.b)("div",{className:"topicCreatorWall-HeaderUpdateHint",children:o&&"每".concat(Fr[o],"更新")})]}),Object(c.c)("div",{className:"topicCreatorWall-TopicInfo",children:[Object(c.c)("div",{className:"topicCreatorWall-TopicDescription",children:[Object(c.b)("a",{className:"topicCreatorWall-TopicName",href:"/topic/".concat(p),children:"".concat(s," 话题")}),Object(c.b)("div",{className:"topicCreatorWall-TopicDetail",children:"".concat(Object(Qt.formatNumber)(u)," 关注 · ").concat(Object(Qt.formatNumber)(d)," 问题")})]}),Object(c.b)("a",{href:"/topic/".concat(p),children:Object(c.b)(m.a,{url:l,size:48,className:"topicCreatorWall-TopicImg"})})]})]})]}),Object(c.b)(zr.Provider,{value:o,children:Object(c.b)(Mr.Provider,{value:n,children:Object(c.b)(Pr.Provider,{value:this.handleOpenModal,children:Object(c.b)(_r,{data:a,paging:i,onLoad:this.handleLoad})})})}),r.creator&&Object(c.b)(Sr,Object.assign({},r))]})}}]),n}(d.Component);Hr.fetchData=function(t){var e=t.params.id,n=t.dispatch;return Promise.all([n(Object(bt.i)({id:e})),n(Object(bt.y)(e))])};var Gr=Object(I.compose)(Object(f.connect)((function(t,e){var n=e.params.id,a=t.entities,c=t.topic.creatorWall[n];return{topic:a.topics[n],creatorWallInfo:c,userDataList:c&&(c.items||[]).map((function(t){return Object.assign(Object.assign({},t),{},{member:a.users[t.member]})}))}}),{loadCreatorWall:bt.i,loadTopic:bt.y}),Object(Rt.a)(null))(Hr),Kr=n(423),Zr=n(429),Qr=n(1669),Xr=n.n(Qr),Jr=n(40),Yr=n.n(Jr),$r={shown:!1,modalType:"warning",title:"",content:"",hasCancel:!1,cancelText:"取消",submitText:"知道了",onSubmit:function(){},onCancel:function(){}},to={title:"审核未通过",content:"具体原因可以查看私信，你可以继续修改提交新版本"},eo={type:"noIntro",title:"暂无百科内容",content:"当前话题暂无百科内容，已经读取了话题描述，你可在此基础上进行任意修改。",hasCancel:!0,cancelText:"不再提醒",modalType:"tip"},no={type:"sogouWithoutIntro",title:"当前百科内容将被清除",content:"由于当前话题百科的内容来自于搜狗，受版权保护将无法进行编辑，请自行编辑。",hasCancel:!0,cancelText:"不再提醒",modalType:"tip"},ao={type:"sogouWithIntro",title:"当前百科内容将被清除",content:"由于当前话题百科的内容来自于搜狗，受版权保护将无法进行编辑，已经读取了知乎话题描述，你可在此基础上进行任意修改。",hasCancel:!0,cancelText:"不再提醒",modalType:"tip"},co={title:"确认放弃提交？",content:"离开当前页面当前的内容不会被保存，请选择提交或者是对内容进行备份。",hasCancel:!0,submitText:"放弃修改并退出",submitOnLeft:!0},ro={title:"确认提交当前百科内容？",content:"提交后当前内容将无法被编辑，我们将在 2 - 3 个工作日内私信审核结果。",hasCancel:!0,submitText:"提交"},oo=function(){return Yr.a.get("topic:wiki_editor_modal_status")},io=function(t){return Yr.a.set("topic:wiki_editor_modal_status",t)},lo=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=oo()||{},a=void 0!==n[t]?Number(n[t])+1:1,c=Object.assign(Object.assign({},n),{},Object(yt.a)({},t,e?100:a));io(c)},so=function(t){var e=oo()||{};return!!t&&e[t]>=100},uo=n(472);function po(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var bo=function(t){Object(l.a)(n,t);var e=po(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).onSubmit=function(){var e=t.props,n=e.onSubmit,a=e.onClose;n(),a()},t}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.className,n=t.shown,a=t.onCancel,r=t.onClose,o=t.title,i=t.content,l=t.hasCancel,s=t.cancelText,u=t.submitText,d=t.modalType,p=t.submitOnLeft;return Object(c.b)(ct.b,{className:H()("EditorModal",e),onClose:"warning"===d?r:this.onSubmit,children:n&&Object(c.c)("div",{className:"".concat("EditorModal","-content"),children:[Object(c.b)("h3",{className:"".concat("EditorModal","-title"),children:o}),Object(c.b)("p",{className:"".concat("EditorModal","-text"),children:i}),p?Object(c.c)(uo.a,{direction:"horizontal",children:[Object(c.b)(N.c,{className:"".concat("EditorModal","-submit"),preset:"primary",color:"blue",onClick:this.onSubmit,children:u}),l&&Object(c.b)(N.c,{className:"".concat("EditorModal","-cancel"),onClick:a,children:s})]}):Object(c.c)(uo.a,{direction:"horizontal",children:[l&&Object(c.b)(N.c,{className:"".concat("EditorModal","-cancel"),onClick:a,children:s}),Object(c.b)(N.c,{className:"".concat("EditorModal","-submit"),preset:"primary",color:"blue",onClick:this.onSubmit,children:u})]})]})})}}]),n}(d.Component);bo.propTypes={className:M.a.string,shown:M.a.bool,onSubmit:M.a.func,onCancel:M.a.func,onClose:M.a.func,title:M.a.string,content:M.a.string,hasCancel:M.a.bool,cancelText:M.a.string,submitText:M.a.string,modalType:M.a.string,submitOnLeft:M.a.bool},bo.defaultProps={cancelText:"取消",submitText:"知道了",modalType:"warning",submitOnLeft:!1};var ho=n(279),fo=n(160),mo=n(198),vo=n(136),Oo=Object.assign;var jo=function(t){return p.a.createElement(vo.a,Oo({width:"98",height:"30",viewBox:"0 0 98 30"},t),p.a.createElement("g",{fill:"none",fillRule:"evenodd"},p.a.createElement("path",{d:"M6 4h22v22H6z"}),p.a.createElement("path",{fill:"#8590A6",d:"M25.975 12.488v9.898c0 .74-.595 1.34-1.33 1.34H9.577c-.735 0-1.33-.6-1.33-1.34V12.059c0-.502.279-.962.722-1.192l4.818-2.496V6.089c0-.74.595-1.34 1.33-1.34.262 0 .519.078.737.225l9.529 6.4c.37.248.592.667.592 1.114zm-12.51-1.44l-2.882 1.493a.223.223 0 00-.12.199v8.53c0 .123.1.223.222.223h8.456a.224.224 0 10.122-.41L14.38 17.83a1.342 1.342 0 01-.592-1.115v-5.467a.222.222 0 00-.323-.198zm32.541-1.212V20.84h-1.428v-.77h-2.324v.77H40.84V9.836h5.166zm-3.752 8.876h2.324v-7.518h-2.324v7.518zm-6.328-7.098a12.576 12.576 0 01-1.05 1.862l-1.288-.812c.896-1.316 1.54-2.702 1.904-4.172l1.442.322c-.14.49-.28.966-.434 1.414h3.71v1.386h-1.862a28.38 28.38 0 01-.126 2.282h2.128v1.386h-2.324l-.168.84c.84.84 1.694 1.792 2.562 2.828l-.896 1.358c-.826-1.218-1.512-2.156-2.072-2.828-.588 1.414-1.582 2.632-2.996 3.64l-.952-1.176c1.442-1.078 2.38-2.38 2.828-3.92l.168-.742h-2.688v-1.386h2.912c.07-.7.112-1.47.14-2.282h-.938zm12.83 3.36h5.726V10.9a68.897 68.897 0 01-4.676.154l-.462-1.358c4.144 0 7.658-.336 10.542-.994l.728 1.274c-1.344.35-2.898.616-4.662.798v4.2h5.334v1.428h-5.334v3.374c0 1.064-.504 1.596-1.484 1.596h-1.904l-.322-1.428c.602.056 1.176.098 1.722.098.336 0 .518-.224.518-.644v-2.996h-5.726v-1.428zm9.702-3.962l1.428.392c-.364 1.19-.812 2.24-1.372 3.136l-1.344-.49c.49-.798.924-1.806 1.288-3.038zm-6.762.546c.462.77.868 1.61 1.218 2.506l-1.232.546c-.392-.98-.84-1.848-1.316-2.604l1.33-.448zm23.302.546v9.352h-1.47v-.49H66.57v.49h-1.484v-9.352h3.626c.154-.574.28-1.162.364-1.75h-5.432V8.926h12.74v1.428h-5.852c-.098.602-.224 1.19-.378 1.75h4.844zm-8.428 7.434h6.958v-2.366H66.57v2.366zm0-3.71h6.958v-2.31H66.57v2.31zm24.73.098l.238 1.428-1.288.21v3.864h-1.47v-3.626l-4.158.658-.224-1.428 4.382-.7V8.548h1.47v7.546l1.05-.168zm-5.236-6.664c.924.672 1.722 1.33 2.366 1.988l-1.008 1.022c-.56-.63-1.358-1.302-2.394-2.002l1.036-1.008zm-.42 3.22c.952.7 1.75 1.386 2.422 2.072l-1.05 1.05c-.56-.644-1.372-1.358-2.408-2.114l1.036-1.008zm-6.818-.364h2.142v-1.61c-.602.084-1.218.154-1.848.21l-.294-1.372c1.806-.14 3.416-.406 4.844-.826l.518 1.372c-.56.14-1.134.28-1.75.392v1.834h1.736v1.414h-1.736v.476a35.67 35.67 0 012.226 1.862l-.826 1.232c-.546-.686-1.008-1.246-1.4-1.666v5.978h-1.47v-5.852a14.08 14.08 0 01-1.946 3.248l-.644-1.638a10.025 10.025 0 002.408-3.64h-1.96v-1.414z",fillRule:"nonzero"})))};function go(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var yo=function(t){Object(l.a)(n,t);var e=go(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this.props,e=t.topic,n=e.name,a=e.avatarUrl,r=e.headerCard,o=void 0===r?{}:r,i=t.wordCount,l=void 0===i?0:i,s=t.canSubmit,u=t.handleReturnToTopic,d=t.handleSubmit,p=t.notification,b=o.title,h=o.avatarUrl;return Object(c.c)("div",{className:"WikiEditorHeader",children:[Object(c.b)(fo.a,{children:Object(c.b)(ho.a,{notification:p,delay:Se.K,className:"AppHeader-notification"})}),Object(c.c)("div",{className:"".concat("WikiEditorHeader","-Logo"),children:[Object(c.b)("div",{className:"".concat("WikiEditorHeader","-ZhihuLogo"),children:Object(c.b)(mo.a,{})}),Object(c.b)("div",{className:"".concat("WikiEditorHeader","-WikiLogo"),children:Object(c.b)(jo,{})})]}),Object(c.c)("div",{className:"".concat("WikiEditorHeader","-WikiInfo"),children:[Object(c.c)("div",{className:"".concat("WikiEditorHeader","-UserInfo"),children:[Object(c.b)("img",{alt:"",className:"".concat("WikiEditorHeader","-Avatar"),src:h||a}),Object(c.b)("span",{className:"".concat("WikiEditorHeader","-UserName"),children:b||n})]}),Object(c.b)("div",{className:"".concat("WikiEditorHeader","-EditInfo"),children:l?"共 ".concat(l," 字"):""})]}),Object(c.c)("div",{className:"".concat("WikiEditorHeader","-Option"),children:[Object(c.b)(N.c,{className:"".concat("WikiEditorHeader","-Return"),onClick:u,color:"blue",children:"返回话题"}),s&&Object(c.b)(N.c,{className:"".concat("WikiEditorHeader","-Submit"),preset:"primary",onClick:d,color:"blue",disabled:0===l,children:"提交"})]})]})}}]),n}(d.Component),Co=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){return{topicId:e.params.id}})))(yo);function wo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var To=function(t){Object(l.a)(n,t);var e=wo(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={wordCount:0,modalOptions:$r,defaultValue:"",notification:{},safeLeave:!1},t.getExtractedValue=function(t){return t.map((function(t){return t.target.value})).join("")},t.getDefaultValue=function(){var e=t.props,n=e.topic.introduction,a=e.intro,c=e.committedWiki;if(Array.isArray(c)&&c.length>0)return t.getExtractedValue(c);if(!a)return n||"";var r=a.modules,o=(void 0===r?[]:r).filter((function(t){var e=t.target;return e&&e.value}));return t.isSogou||0===o.length?n||"":t.getExtractedValue(o)},t.commitWiki=function(){var e=t.props,n=e.commitWiki,a=e.params,c=t.editable.toHTML();n(a.id,c).then((function(){t.setState({notification:{text:"已提交，我们将在两至三个工作日内审核内容",theme:"white"}},(function(){setTimeout((function(){t.setState({notification:{},safeLeave:!0},(function(){t.returnToTopic()}))}),2e3)}))})).catch((function(){t.setState({notification:{text:"提交失败，请稍后重试",theme:"red"}},(function(){setTimeout((function(){t.setState({notification:{}})}),2400)}))}))},t.returnToTopic=function(){var e=t.props.topic;location.href="/topic/".concat(e.id,"/intro")},t.closeModal=function(){t.setState({modalOptions:$r})},t.checkShowWhichModal=function(){var e=t.props,n=e.hasIntro,a=e.committedWiki;Array.isArray(a)&&a.length>0?t.showEditCommittedWikiModal():n?t.isSogou&&(t.hasCommonIntro?t.showIsSogouWithCommonIntroModal():t.showIsSogouNoCommonIntroModal()):t.hasCommonIntro&&t.showNoIntroModal()},t.showModal=function(e){var n=e.type,a=e.title,c=e.content,r=e.cancelText,o=e.onSubmit,i=void 0===o?function(){}:o,l=e.onCancel,s=void 0===l?t.closeModal:l,u=e.hasCancel,d=void 0!==u&&u,p=e.submitText,b=void 0===p?"知道了":p,h=e.modalType,f=void 0===h?"warning":h,m=e.submitOnLeft,v=void 0!==m&&m;if(!n||!so(n)){var O=t.state.modalOptions;t.setState({modalOptions:Object.assign(Object.assign({},O),{},{shown:!0,title:a,content:c,hasCancel:d,submitText:b,cancelText:r,onSubmit:i,onCancel:s,modalType:f,submitOnLeft:v})})}},t.showEditCommittedWikiModal=function(){t.showModal(to)},t.showEditorStatusModal=function(e){var n=e.type;t.showModal(Object.assign(Object.assign({},e),{},{onSubmit:function(){lo(n),t.closeModal()},onCancel:function(){lo(n,!0),t.closeModal()}}))},t.showNoIntroModal=function(){t.showEditorStatusModal(eo)},t.showIsSogouNoCommonIntroModal=function(){t.showEditorStatusModal(no)},t.showIsSogouWithCommonIntroModal=function(){t.showEditorStatusModal(ao)},t.handleBeforeUnload=function(){if(!t.state.safeLeave)return"编辑内容尚未提交，确定离开此页？"},t.showReturnToTopicModal=function(){t.showModal(Object.assign(Object.assign({},co),{},{onSubmit:t.returnToTopic}))},t.showCommitModal=function(){t.showModal(Object.assign(Object.assign({},ro),{},{onSubmit:t.commitWiki}))},t.onChangeContent=function(e){var n=e.editorState.getCurrentContent().getBlockMap().reduce((function(t,e){return t+e.getText().length}),0);t.setState({wordCount:n})},t.handleReturnToTopic=function(){t.state.wordCount?t.showReturnToTopicModal():t.returnToTopic()},t.handleSubmit=function(){t.showCommitModal()},t.handleError=function(e,n){var a=t.props.showNotification;Object(Zr.b)(e,n,a)},t.handleUploadError=function(e){t.handleError("image-upload-error",e)},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.topic,n=t.intro,a=t.hasIntro,c=t.committedWiki,r=t.params.id,o=t.loadTopic,i=t.loadIntro,l=t.loadTopicCommittedWiki;e||o(r),a&&!n&&i(r),c||l(r);var s=this.getDefaultValue();this.setState({defaultValue:s}),this.checkShowWhichModal(),window.onbeforeunload=this.handleBeforeUnload}},{key:"componentWillUnmount",value:function(){window.onbeforeunload=null}},{key:"isSogou",get:function(){var t=this.props,e=t.hasIntro,n=t.intro;if(!e||!n)return!1;var a=n.copyright;return"sogou"===(a=void 0===a?{}:a).dataSource}},{key:"hasCommonIntro",get:function(){var t=this.props.topic.introduction;return Boolean(t)}},{key:"render",value:function(){var t=this,e=this.props.topic,n=this.state,a=n.modalOptions,r=n.defaultValue,o=n.wordCount,i=n.notification;return Object(c.c)("div",{className:"TopicWikiEditor",children:[Object(c.b)(h.a,{title:"".concat(e.name," - 百科编辑器")}),Object(c.b)(Co,{topic:e,wordCount:o,canSubmit:!0,handleReturnToTopic:this.handleReturnToTopic,handleSubmit:this.handleSubmit,notification:i}),Object(c.b)("div",{className:"".concat("TopicWikiEditor","-main"),children:Object(c.b)(Kr.a,{className:"".concat("TopicWikiEditor","-Editor"),ref:function(e){t.editable=e},allowDragAndDrop:!0,allowMention:!0,allowReference:!0,allowToolbar:!0,allowUploadDocument:!0,allowToolbarSticky:!0,allowFloatImage:!0,allowResizeImage:!0,allowDivider:!1,allowVideo:!1,toolbarStickyOffset:Se.i,minRows:20,defaultValue:r,onChange:this.onChangeContent,onError:this.handleError,onUploadError:this.handleUploadError,logo:Xr.a})}),Object(c.b)(bo,Object.assign({className:"".concat("TopicWikiEditor","-Modal"),onClose:this.closeModal},a))]})}}]),n}(d.Component);To.fetchData=function(t){var e=t.dispatch,n=t.params.id;return Promise.all([e(Object(tt.G)(n)).then((function(t){if(t&&t.payload&&!t.payload.canEdit){var e=new Error;throw e.status=302,e.redirect="/topic/".concat(n,"/intro"),e}return t})),e(Object(tt.A)(n)),e(Object(tt.o)(n)),e(Object(tt.C)(n,"edit"))])};var Ro=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params.id;return{topic:Object(tt.bb)(t,{id:n}),intro:Object(tt.X)(t,{id:n}),hasIntro:Object(tt.i)(t,{id:n}),committedWiki:Object(tt.R)(t,{id:n}),wikiEditInfo:Object(tt.eb)(t,{id:n})}}),{loadIntro:tt.o,loadTopic:tt.A,loadTopicWikiEditInfo:tt.G,loadTopicCommittedWiki:tt.C,commitWiki:tt.c}))(To);function ko(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var Io=function(t){Object(l.a)(n,t);var e=ko(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleReturnToTopic=function(){var e=t.props.id;location.href="/topic/".concat(e,"/intro")},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.topic,n=t.committedWiki,a=t.params.id,c=t.loadTopic,r=t.loadTopicCommittedWiki;e||c(a),n||r(a)}},{key:"render",value:function(){var t=this.props,e=t.topic,n=t.committedWiki,a=t.id;return Object(c.c)("div",{className:"TopicContribution",children:[Object(c.b)(Co,{topic:e,handleReturnToTopic:this.handleReturnToTopic}),Object(c.c)("div",{className:"".concat("TopicContribution","-Main"),children:[Object(c.c)("div",{className:"".concat("TopicContribution","-Info"),children:["已提交，我们将在 2 - 3 个工作日内私信审核结果，如有问题可私信"," ",Object(c.b)(r.Link,{target:"_blank",to:"//www.zhihu.com/people/zhi-shi-ku-21-42",children:"@知识库"})]}),Object(c.b)("div",{className:"".concat("TopicContribution","-Content"),children:Object(c.b)(Ba,{modules:n,id:a,sectionClassName:"".concat("TopicContribution","-Section"),isZhihuWiki:!0})})]})]})}}]),n}(d.Component);Io.fetchData=function(t){var e=t.dispatch,n=t.params.id;return Promise.all([e(Object(tt.A)(n)),e(Object(tt.C)(n))])};var No=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params.id;return{id:n,topic:Object(tt.bb)(t,{id:n}),committedWiki:Object(tt.R)(t,{id:n})}}),{loadTopic:tt.A,loadTopicCommittedWiki:tt.C}))(Io),xo=n(1122),So=n.n(xo),Eo=n(1015),Ao=n(419),Bo=n(2606),Mo=n(889);function Po(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var zo=function(t){Object(l.a)(n,t);var e=Po(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))).state={deleteModalShown:!1,detailModalShown:!1},t.renderHeader=function(){var e=t.props,n=e.title,a=e.url,r=e.author,o="answer"===e.type,i=Object(c.c)("div",{className:"TopicAbstractEditCard-desc",children:[o?"在":"的文章",Object(c.b)("a",{className:"TopicAbstractEditCard-title",href:a,target:"_blank",rel:"noopener noreferrer",children:n}),o&&"的回答"]});return Object(c.b)("div",{className:"TopicAbstractEditCard-header",children:Object(c.b)(Xt.a,{avatarSize:16,className:"TopicAbstractEditCard-author",author:r,preset:"plain",extra:i})})},t.handleToggleModalShown=function(e,n){t.setState((function(t){return Object.assign(Object.assign({},t),{},Object(yt.a)({},e,n))}))},t.renderContent=function(){var e=t.props,n=e.content,a=e.member.name;return Object(c.c)("div",{className:"TopicAbstractEditCard-content",children:[Object(c.b)("div",{className:"TopicAbstractEditCard-text",children:n}),Object(c.c)("div",{className:"TopicAbstractEditCard-tip",children:[Object(c.c)("span",{className:"TopicAbstractEditCard-info",children:[a," 摘录于 ",t.createdFormat]}),Object(c.b)(N.c,{className:"TopicAbstractEditCard-read",icon:Y.a,preset:"plain",onClick:function(){return t.handleToggleModalShown("detailModalShown",!0)},children:"查看完整摘录"}),t.hasDeletePermission&&Object(c.b)(N.c,{className:"TopicAbstractEditCard-delete",preset:"plain",icon:Bo.a,onClick:function(){return t.handleToggleModalShown("deleteModalShown",!0)},children:"删除"})]})]})},t}return Object(i.a)(n,[{key:"createdFormat",get:function(){var t=this.props.created;return Object(Ao.a)(t?new Date(1e3*t):new Date,"yyyy-MM-dd")}},{key:"hasDeletePermission",get:function(){var t=this.props,e=t.isAdmin,n=t.isAuthor;return e||n}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,a=e.sid,r=e.type,o=e.author,i=e.member,l=e.title,s=e.url,u=e.content,d=e.onRemoveItem,p=this.state,b=p.deleteModalShown,h=p.detailModalShown;return Object(c.c)("div",{className:"TopicAbstractEditCard-wrapper",children:[Object(c.c)("div",{className:"TopicAbstractEditCard-main",children:[this.renderHeader(),this.renderContent()]}),Object(c.b)(Mo.a,{className:"TopicAbstractEditCard-deleteModal",title:"删除选择的百科摘录内容？",subtitle:"确认后选择的百科摘录将会被删除，在本话题百科摘录下不予展示。",shown:b,isMobile:!0,onCancel:function(){return t.handleToggleModalShown("deleteModalShown",!1)},onSubmit:function(){d(a)}}),Object(c.b)(ct.b,{onClose:function(){return t.handleToggleModalShown("detailModalShown",!1)},size:"large",title:"完整百科摘录",className:"TopicAbstractEditCard-detailModal",children:h&&Object(c.b)(za.a,{type:r,author:o,member:i,title:l,url:s,content:u,theme:"full"})}),n]})}}]),n}(d.Component);zo.propTypes={title:M.a.string.isRequired,url:M.a.string.isRequired,author:M.a.object,member:M.a.object,content:M.a.string.isRequired,created:M.a.number,onRemoveItem:M.a.func.isRequired,sid:M.a.string.isRequired,isAdmin:M.a.bool.isRequired,isAuthor:M.a.bool.isRequired};var Lo=zo,Uo=n(814),Do=Object(Eo.f)((function(){return Object(c.b)("div",{className:"AbstractSorter-handle",children:Object(c.b)(Uo.a,{className:"AbstractSorter-icon",size:12})})})),Wo=Object(Eo.e)((function(t){var e=t.item,n=e.author,a=e.member,r=e.isAuthor,o=e.title,i=e.url,l=e.content,s=e.objectType,u=e.created,d=e.sid,p=t.itemProps.isAdmin,b=t.onRemoveItem;return Object(c.b)(Lo,{author:n,member:a,created:u,isAuthor:r,isAdmin:p,title:o,url:i,content:l,type:s,sid:d,onRemoveItem:b,children:p&&Object(c.b)(Do,{})})})),Vo=Object(Eo.d)((function(t){var e=t.items,n=t.itemProps,a=t.onRemoveItem;return Object(c.b)("div",{className:"AbstractSorter-list",children:e.map((function(t,e){return Object(c.b)(Wo,{index:e,item:t,itemProps:n,onRemoveItem:a},"item-".concat(e))}))})})),_o=function(t){var e=t.onRemoveItem,n=t.onSortEnd,a=t.abstracts,r=t.isAdmin;return Object(c.b)(Vo,{items:a,onSortEnd:n,itemProps:{isAdmin:r},useDragHandle:!0,onRemoveItem:e})};function Fo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(u.a)(t);if(e){var c=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var qo=function(t){Object(l.a)(n,t);var e=Fo(n);function n(){var t;Object(o.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).handleReturnToTopic=function(){var e=t.props.params.id;location.href="/topic/".concat(e,"/intro")},t.handleRemoveItem=function(e){var n=t.props,a=n.params.id;(0,n.deleteAbstract)({id:a,sid:e})},t.handleSortEnd=function(e){var n=e.oldIndex,a=e.newIndex,c=t.props,r=c.params.id,o=c.intro.abstract,i=c.updateAbstractRank;n!==a&&i({id:r,rank:So()(o,n,a).map((function(t){return t.sid}))})},t}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.topic,n=t.intro,a=t.hasIntro,c=t.params.id,r=t.loadTopic,o=t.loadIntro;e||r(c),a&&!n&&o(c)}},{key:"render",value:function(){var t=this.props,e=t.topic,n=t.intro,a=n.abstract,r=n.isAdmin;return Object(c.c)("div",{className:"TopicAbstractEdit",children:[Object(c.b)(h.a,{title:e.name}),Object(c.b)(Co,{topic:e,handleReturnToTopic:this.handleReturnToTopic}),Object(c.b)("div",{className:"".concat("TopicAbstractEdit","-Main"),children:Object(c.b)("div",{className:"".concat("TopicAbstractEdit","-Content"),children:Object(c.b)(_o,{abstracts:a,isAdmin:r,onRemoveItem:this.handleRemoveItem,onSortEnd:this.handleSortEnd})})})]})}}]),n}(d.Component);qo.fetchData=function(t){var e=t.dispatch,n=t.params.id;return Promise.all([e(Object(tt.A)(n)),e(Object(tt.o)(n))])};var Ho=Object(I.compose)(r.withRouter,Object(f.connect)((function(t,e){var n=e.params.id;return{topic:Object(tt.bb)(t,{id:n}),intro:Object(tt.X)(t,{id:n}),hasIntro:Object(tt.i)(t,{id:n})}}),{loadIntro:tt.o,loadTopic:tt.A,deleteAbstract:tt.h,updateAbstractRank:tt.gb}))(qo);e.default=Object(c.c)(r.Route,{children:[Object(c.b)(r.Route,{path:":id/create/:type",component:mr,name:"TopicEdit"}),Object(c.b)(r.Route,{path:":id/edit",component:br,name:"TopicEdit"}),Object(c.c)(r.Route,{path:":id",component:qe,name:"Topic",children:[Object(c.b)(r.IndexRoute,{component:dc,name:"TopicHot",zaNotTrackPageShow:!0}),Object(c.b)(r.Route,{path:"index",component:pn,name:"TopicIndex"}),Object(c.b)(r.Route,{path:"intro",component:Ka,name:"TopicIntro"}),[["hot","TopicHot"],["newest","TopicNewest"]].map((function(t){var e=Object(a.a)(t,2),n=e[0],o=e[1];return Object(c.b)(r.Route,{path:n,component:dc,name:o},o)})),Object(c.b)(r.Route,{path:"top-answers",component:fc,name:"TopicTop"}),[["unanswered","TopicUnanswered"],["questions","TopicQuestions"]].map((function(t){var e=Object(a.a)(t,2),n=e[0],o=e[1];return Object(c.b)(r.Route,{path:n,component:gc,name:o},o)}))]}),Object(c.b)(r.Route,{path:":id/images",component:jr,name:"TopicImage"}),Object(c.b)(r.Route,{path:":id/creator_wall",component:Gr,name:"TopicCreatorWall",zaPageShowId:3913}),Object(c.b)(r.Route,{path:":id/wiki-editor",component:Ro,name:"TopicWikiEditor",showAppHeader:!1,authRequired:!0}),Object(c.b)(r.Route,{path:":id/my-contribution",component:No,name:"TopicContribution",showAppHeader:!1}),Object(c.b)(r.Route,{path:":id/abstract-edit",component:Ho,name:"TopicAbstractEdit",showAppHeader:!1}),Object(c.b)(r.Redirect,{path:":id/community_video",to:":id"})]})},927:function(t,e,n){"use strict";var a=n(13),c=n(14),r=n(15),o=n(17),i=n(9),l=n(1),s=n(3),u=n.n(s),d=n(2),p=n(18),b=n(24),h=n(11),f=n.n(h),m=n(31),v=n(2587),O=n(2627),j=n(30),g=n(377),y=n(398),C=n(0),w=n(5),T=Object(w.a)("live",["UPDATE_LIKED","UPDATE_COURSE_LIKED"]);var R=Object(w.a)("ebook",["FOLLOW","UNFOLLOW"]);var k=n(402),I=n(1032),N=n(395),x=n(25);function S(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(i.a)(t);if(e){var c=Object(i.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(o.a)(this,n)}}var E={ebook:"updateEBookVoters",live:"updateLiveLiked",live_course:"updateLiveCourseLiked",article:"updateArticleLike",promotion:"updatePromotionLike",pin:"updatePinsLike"},A=function(t){Object(r.a)(n,t);var e=S(n);function n(){var t;Object(a.a)(this,n);for(var c=arguments.length,r=new Array(c),o=0;o<c;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).handleToggleVote=t.context.authRequired((function(e){var n=t.props,a=n.liked,c=n.type,r=n.id,o=!a;j.a.trackEvent(e.target,{action:o?"Upvote":"UnUpvote",element:"Button"});var i=E[c];t.props[i](r,o)}),x.X.vote),t.handleClick=function(e){var n=t.props,a=n.disableAuth,c=n.handleToggleGuide,r=n.onClick;r&&r(e)||(a?c(e):t.handleToggleVote(e))},t}return Object(c.a)(n,[{key:"render",value:function(){var t=this.props,e=t.liked,n=t.count,a=t.className,c=t.icon,r=void 0===c?"like":c,o=t.disabled;return Object(l.c)(m.c,{className:f()("LikeButton",{"is-active":e},a),onClick:this.handleClick,disabled:o,children:["thank"===r?Object(l.b)(v.a,{center:!0}):Object(l.b)(O.a,{center:!0})," ",Object(g.cnNiceNumber)(n).trim()]})}}]),n}(d.Component);A.contextTypes={authRequired:u.a.func},A.propTypes={type:u.a.oneOf(y.a).isRequired,id:u.a.oneOfType([u.a.number,u.a.string]).isRequired,icon:u.a.string,liked:u.a.bool,count:u.a.number};e.a=Object(p.compose)(Object(b.connect)(null,{updateEBookVoters:function(t){return function(e,n){var a=n().entities.ebooks[t],c=!(a.relationship||{}).voting;return e({API:{types:R.FOLLOW,method:c?"POST":"DELETE",endpoint:"v3/books/".concat(t,"/voters")},UPDATE:{request:{ebooks:Object(C.a)({},t,{relationship:Object.assign(Object.assign({},a.relationship),{},{voting:c}),voteupCount:a.voteupCount+(c?1:-1)})},failure:{ebooks:Object(C.a)({},t,a)}}})}},updateLiveLiked:function(t){return function(e,n){var a=n().entities.lives[t],c=!a.isLiked;return e({API:{types:T.UPDATE_LIKED,endpoint:"v3/lives/".concat(t,"/like"),method:c?"POST":"DELETE"},UPDATE:{request:{lives:Object(C.a)({},t,{isLiked:c,likedNum:a.likedNum+(c?1:-1)})},failure:{lives:Object(C.a)({},t,a)}}})}},updateLiveCourseLiked:function(t){return function(e,n){var a=n().entities.liveCourses[t],c=!a.isLiked;return e({API:{types:T.UPDATE_COURSE_LIKED,endpoint:"v3/lives/course/".concat(t,"/like"),method:c?"POST":"DELETE"},UPDATE:{request:{liveCourses:Object(C.a)({},t,{isLiked:c,likedNum:a.likedNum+(c?1:-1)})},failure:{liveCourses:Object(C.a)({},t,a)}}})}},updateArticleLike:k.f,updatePromotionLike:I.a,updatePinsLike:N.h}))(A)},947:function(t,e,n){"use strict";var a=n(1),c=n(11),r=n.n(c),o=n(123),i=n(2592),l=n(585),s=n(377),u=n(182),d=n(31),p=n(30),b=n(247),h=n.n(b),f=n(376),m=n(94),v=n(104),O=n(839);e.a=function(t){var e,n,c=t.question,b=t.question,j=b.id,g=b.title,y=b.answerCount,C=b.followerCount,w=b.updatedTime,T=b.created,R=t.headerInfo,k=t.showTime,I=t.extraFooterInfo,N=t.renderItem,x=t.enableIgnore,S=t.handleIgnoreQuestion,E=void 0===S?h.a:S,A=t.zaId,B=(A=void 0===A?{}:A).titleClick,M=A.writeAnswer,P=A.cardShow,z=A.ignoreQuestion,L=t.className,U=t.button,D=t.titleLink,W=t.zaContent,V=t.isNewZa,_=Object(m.i)().trackEvent;if(N)return N(c);var F="/question/".concat(j),q="https://www.zhihu.com/question/".concat(j),H=R?Object(a.c)(o.Flex,{mb:12,color:"GBL05A",alignItems:"center",css:{fontSize:"15px"},children:[Object(a.b)("img",{alt:"",className:r()("QuestionItem-head--avatar",{"QuestionItem-head--avatarCircle":"circle"===(null===(e=R.avatar)||void 0===e?void 0:e.shape)}),src:null===(n=R.avatar)||void 0===n?void 0:n.url}),Object(a.b)("div",{className:"QuestionItem-head--reason",children:R.reason}),R.extra&&Object(a.b)("div",{className:"QuestionItem-head--extra",children:R.extra})]}):null,G=Object(a.b)("div",{className:"QuestionItem-title",children:Object(a.b)("a",Object.assign(Object.assign(Object.assign({href:D||F,target:"_blank",rel:"noopener noreferrer","data-za-detail-view-name":"Title"},B&&{"data-za-detail-view-id":B}),V&&{onClick:function(){_({eventType:"Click",action:"OpenUrl",elementLocation:{type:"Card"}},{link:{url:D||F}})}}),{},{children:g}))});return Object(a.b)(f.a,{module:"QuestionItem",content:W||{type:"Question",token:String(j)},trackCardShow:Boolean(P),view:{id:P},children:Object(a.c)("div",{role:"listitem",className:r()("QuestionItem",L),children:[H,Object(a.b)(O.e,{data:c,link:D||F,lastreadTouchable:!1,title:G,children:Object(a.c)(o.Flex,{mt:20,children:[U||Object(a.b)(v.a,{className:"QuestionItem-footer--writeAnswerButton",icon:i.a,label:"写回答",href:"".concat(q,"#write"),target:"_blank","data-za-not-track-link":!0,onClick:function(t){M&&p.a.trackEvent(t.target,{id:M,action:"OpenUrl"}),V&&_({eventType:"Click",action:"OpenUrl",elementLocation:{type:"Button",text:"写回答"}},{link:{url:"".concat(q,"#write")}})}}),Object(a.b)(o.Box,{ml:16,children:Object(a.b)(O.d,{children:I||["".concat(Object(s.formatNumber)(y)," 回答"),"".concat(Object(s.formatNumber)(C)," 关注"),k&&"".concat(Object(u.toRelativeString)(w||T))]})})]})}),x&&Object(a.b)(d.c,{className:"QuestionItem-ignoreButton",preset:"plain","data-tooltip":"不感兴趣","data-tooltip-preset":"white","data-tooltip-classname":"QuestionItem-ignoreButtonTooltip",color:"GBL07A",icon:l.a,onClick:function(t){E(j),p.a.trackEvent(t.target,{id:z,action:"Click"}),V&&_({eventType:"Click",elementLocation:{type:"Button",text:"不感兴趣"}})}})]})})}},962:function(t,e,n){"use strict";var a=n(42),c=n(13),r=n(14),o=n(67),i=n(15),l=n(17),s=n(9),u=n(1),d=n(2),p=n(18),b=n(11),h=n.n(b),f=n(3),m=n.n(f),v=n(37),O=n(24),j=n(2645),g=n(2646),y=n(1091),C=n(415),w=n(376),T=n(31),R=n(963),k=n(158),I=n(30),N=n(382),x=n(0),S=n(5),E=Object(S.a)("brand",["GET_URL"]),A=n(331),B=n.n(A);function M(t,e){var n=t.trackUrl,a=void 0===n?[]:n,c=t.id;if(0===a.length)return null;var r="other";e.Android?r="android":e.iOS&&(r="ios");var o=B()();return a.forEach((function(t){(new Image).src=t.replace("__OS__",r).replace("__ADPLATFORM__",r).replace("__REQUESTID__",o).replace("__SESSIONID__",o).replace("__ATOKEN__",c).replace("__PAGETYPE__","article")})),{os:r,pageId:c,sessionId:o,pageType:"article"}}var P=n(54),z=n(402),L=n(955),U=n(892),D=n(1334),W=n(1335),V=n(1030),_=n(269),F=n(1117),q=n(853),H=n(847),G=n(927),K=n(928),Z=n(1011),Q=n(1054),X=n(1320),J=n(985),Y=n(25),$=n(885),tt=n(854),et=n(851),nt=n(393),at=n(839),ct=n(860),rt=n(875),ot=n(964),it=n(1076),lt=n(1131),st=(n(1227),n(1333));function ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(s.a)(t);if(e){var c=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return Object(l.a)(this,n)}}var dt=function(t){return"plain"===t||"special-plain"===t},pt=dt,bt=function(t){return t.thumbnailExtraInfo&&"video"===t.thumbnailExtraInfo.type?{cover:t.thumbnail,hasVideo:!0}:{cover:t.imageUrl||t.thumbnail,hasVideo:!1}},ht=function(t){Object(i.a)(n,t);var e=ut(n);function n(){var t,a,r,i,l;Object(c.a)(this,n);for(var s=arguments.length,d=new Array(s),p=0;p<s;p++)d[p]=arguments[p];return(t=e.call.apply(e,[this].concat(d))).state={commentsShown:!1,commentsAutoFocus:!0,favlistsShown:!1,commentPattern:"fixed",positionStatus:null,guideShown:!1,contentExpanded:!1,hasFetchedLabels:!1,shownCatalogModal:!1},t.disableAuth=(a=t.props,r=a.router,i=(r=void 0===r?{}:r).location,l=(i=void 0===i?{}:i).pathname,a.isMobile&&!t.context.currentUser&&!l.startsWith("/topic")),t.handleCommentsShown=function(e,n){t.props.shouldOia?t.createOpenInAppHandler("comment_article")(e):t.setState(n)},t.handleCommentsHide=function(){t.setState({commentsShown:!1})},t.handlePositionStatusChange=function(e){t.setState({positionStatus:e})},t.handleFavButtonClick=function(e){var n=t.props,a=n.zaInfos.favlists;n.shouldOia?t.createOpenInAppHandler("comment_article")(e):(I.a.trackEvent(t.favButtonRef,Object.assign({action:"Collect",element:"Button",is_intent:!0},a&&{id:a})),t.disableAuth?t.handleToggleGuide():t.handleFavlistsShown())},t.handleFavlistsShown=t.context.authRequired((function(){return t.setState({favlistsShown:!0})}),Y.X.favlists),t.handleFavlistHide=function(){t.setState({favlistsShown:!1})},t.handleToggleGuide=function(){t.setState({guideShown:!t.state.guideShown})},t.toggleCatalogModal=function(){t.setState({shownCatalogModal:!t.state.shownCatalogModal})},t.handleVote=function(e){var n=t.props,a=n.article.id;(0,n.updateArticleVote)(a,e)},t.handleLogMoreClick=function(){var e=t.props.zaInfos.options;I.a.trackEvent(Object(o.a)(t),Object.assign({action:"Click",element_name:"MoreAction"},e&&{id:e}))},t.loadArticleConcernedVoters=function(){var e=t.props,n=e.concernedUpvoters,a=e.article,c=e.loadArticleConcernedVoters;!n&&t.context.currentUser&&c(a.id)},t.handleToggleExpand=function(e){var n=t.props,a=n.onToggleExpand,c=n.getTrackUrl,r=n.article,o=n.ua,i=n.trackPromotionClick;(a&&a(e),e)&&((r.trackUrl?Promise.resolve():c(r.id)).then((function(){return M(t.props.article,o)})),t.loadArticleConcernedVoters(),i&&i());t.setState({contentExpanded:e})},t.renderPrefix=function(){var e=t.props.article,n=e.labelInfo,a=e.hermesLabel,c=t.state.contentExpanded;return!n&&!a||c?null:Object(u.b)(Z.a,{labelInfo:n||a})},t.createOpenInAppHandler=function(e){var n=t.props.article.id;return function(t){t.preventDefault(),Object(N.e)(Object($.a)({type:"article",id:n}),{utm_content:e})}},t.handleLike=function(e){return!!t.props.shouldOia&&(t.createOpenInAppHandler("like_article")(e),!0)},t}return Object(r.a)(n,[{key:"renderLabels",value:function(){if(!this.state.contentExpanded)return null;var t=this.props,e=t.article,n=t.useNewLabels,a=e.annotationDetail,c=e.reviewInfo,r=(c=void 0===c?{}:c).isReviewing,o=c.tips;return r?Object(u.b)("div",{className:"ArticleItem-status",children:o}):Object(u.b)(Q.a,{useOldLabels:!n,annotationProps:a&&{annotationDetail:a},item:e})}},{key:"renderArticleExtraInfo",value:function(){var t=this.props,e=t.actor,n=t.action,a=t.article,c=a.voteupCount,r=a.id,o=a.type,i=t.concernedUpvoters,l=void 0===i?[]:i,s=e&&e.urlToken;return c?Object(u.b)("div",{className:"ArticleItem-extraInfo",children:Object(u.b)(X.a,{id:r,type:o,voteupCount:c,upvotedFollowees:null==l?void 0:l.filter((function(t){return s!==t.urlToken})),too:"voted"===n})},"articleExtraInfo"):null}},{key:"renderMeta",value:function(){var t=function(t){var e=t.title,n=t.id,a=t.created,c=t.updated,r=t.commentCount,o=t.imageUrl,i=t.thumbnail;return{headline:e,url:"".concat(Y.m,"/p/").concat(n),datePublished:new Date(1e3*a).toISOString(),dateModified:new Date(1e3*c).toISOString(),commentCount:r,image:o||i}}(this.props.article);return Object.keys(t).map((function(e){return Object(u.b)("meta",{itemProp:e,content:t[e]},e)}))}},{key:"renderSuggestEdit",value:function(){var t=this.props.article,e=t.isNormal,n=void 0===e||e,a=t.suggestEdit,c=(a=void 0===a?{}:a).title,r=a.status,o=a.reason;return r&&!n?Object(u.c)("div",{className:"AnswerItem-statusContent",children:[Object(u.b)("div",{className:"AnswerItem-statusReason",children:o}),Object(u.c)("div",{className:"AnswerItem-statusDescription",children:["作者修改内容通过后，文章会重新显示恢复正常 ",Object(u.b)("a",{target:"_blank",href:"/question/24752645",className:"AnswerItem-statusLink",children:c})]})]}):null}},{key:"render",value:function(){var t=this,e=this.props,n=e.article,c=e.article,r=c.id,o=c.title,i=c.author,l=c.excerpt,s=c.content,d=c.voteupCount,p=c.voting,b=c.type,f=c.created,m=c.updated,v=c.imageUrl,O=c.commentCount,C=c.adminClosedComment,w=c.reviewInfo,I=(w=void 0===w?{}:w).isReviewing,N=w.editType,x=c.annotationDetail,S=c.vessayInfo,E=e.preset,A=e.lastreadTouchable,B=e.itemProp,M=void 0===B?"article":B,P=e.ua,z=e.lessExcerpt,F=e.formatContent,Z=e.zaInfos,Q=Z.expand,X=Z.title,lt=Z.voteUp,ut=Z.voteDown,ht=Z.toggleComment,ft=Z.share,mt=Z.report,vt=Z.options,Ot=Z.getCommentAction,jt=e.renderOptions,gt=e.isSticky,yt=e.handleToggleSticky,Ct=e.trackPromotionClick,wt=e.renderActionButtons,Tt=e.className,Rt=e.isMobile,kt=e.ecommerce,It=e.useVessayV2,Nt=this.state,xt=Nt.positionStatus,St=Nt.favlistsShown,Et=Nt.commentsShown,At=Nt.commentsAutoFocus,Bt=Nt.commentPattern,Mt=Nt.contentExpanded,Pt=Nt.shownCatalogModal,zt=this.context.currentUser,Lt="".concat(Y.m,"/p/").concat(r),Ut=!(I&&"create"===N),Dt=zt&&zt.urlToken===i.urlToken,Wt=this.renderSuggestEdit(),Vt="function"==typeof yt,_t=!function(t){return"special-plain"===t}(E)&&Object(u.b)(q.a,Object.assign(Object.assign({},pt(E)&&{preset:"plain"}),{},{author:i,userLinkV2:!0,className:"ArticleItem-authorInfo"}),"authorInfo"),Ft=this.renderArticleExtraInfo(),qt=dt(E)?[_t,Ft]:[[_t,Ft],null],Ht=Object(a.a)(qt,2),Gt=Ht[0],Kt=Ht[1],Zt=!Wt||Dt,Qt=F?F(s||l,n):s||l,Xt=Ut&&!Rt&&Mt&&Object(V.a)(n,"article"),Jt=Boolean(null==S?void 0:S.enableVideoTranslate);return Object(u.c)(at.e,{className:h()("ArticleItem",Tt),onRef:function(e){t.contentItem=e},"data-zop":JSON.stringify({authorName:i.name,itemId:r,title:o,type:"article"}),data:n,link:Lt,title:Object(u.c)(u.a,{children:[Vt&&gt&&Object(u.b)(ot.a,{}),Object(u.b)("a",Object.assign(Object.assign({href:Lt,target:"_blank",rel:"noopener noreferrer","data-za-detail-view-element_name":"Title"},X&&{"data-za-detail-view-id":X}),{},{onClick:Ct,children:o}))]}),meta:Gt,lastreadTouchable:A,itemProp:M,itemType:"http://schema.org/SocialMediaPosting",itemScope:!0,children:[this.renderMeta(),this.renderLabels(),Zt?Object(u.b)(ct.b,Object.assign(Object.assign(Object.assign({itemProp:"articleBody",data:n,excerpt:F?F(l,n):l,html:Qt,ecommerce:kt,onToggleExpend:this.handleToggleExpand,prefix:this.renderPrefix(),before:Object(u.c)("div",{children:[Kt,v&&Object(u.b)(R.a,{className:"ArticleItem-image",thumbnail:Object(k.imgUrl)(v,"60w"),url:v,alt:o})]}),after:Object(u.b)(ct.a,{href:Lt,created:f,updated:m})},z?{limit:74}:{}),{},{onPositionStatusChange:this.handlePositionStatusChange},bt(n)),{},{zaIds:{expand:Q},children:wt({componentList:[{name:"vote",component:Ut&&!_.b.includes(r)&&(Rt?Object(u.b)(G.a,{id:r,type:b,liked:Boolean(p),count:d,disabled:Dt,onClick:this.handleLike,handleToggleGuide:this.handleToggleGuide,disableAuth:this.disableAuth},"vote"):Object(u.b)(K.a,{type:b,count:d,onVote:this.handleVote,voting:p,isOwner:Dt,handleToggleGuide:this.handleToggleGuide,zaIds:{voteUp:lt,voteDown:ut}},"vote"))},{name:"comment",component:Ut&&Object(u.b)("div",{css:_.b.includes(r)?{marginLeft:-24}:{},children:Object(u.b)(tt.a,{onClick:this.handleCommentsShown,commentsShown:Et,commentClosed:C,count:O,positionStatus:xt,zaInfos:{toggleComment:ht,getCommentAction:Ot}},"comment")})},{name:"catalog",component:Xt&&Object(u.b)(D.a,{html:Qt,sourceId:n.id,onClick:this.toggleCatalogModal},"catalog")},{name:"share",component:Ut&&Object(u.b)(H.a,{id:r,type:"article",url:Lt,title:o,authorName:i&&i.name,positionStatus:xt,zaShareId:ft},"share")},{name:"favlist",component:Ut&&(!zt||!zt.isOrg)&&Object(u.b)(U.a,{onRef:function(e){return t.favButtonRef=e},onClick:this.handleFavButtonClick,label:Rt?"":"收藏"},"favlist")},{name:"sticky",component:!Rt&&Vt&&Dt&&Object(L.a)(zt)&&Object(u.b)(T.c,{preset:"plain",onClick:yt,icon:gt?j.a:g.a,label:gt?"取消置顶":"置顶"},"sticky")},{name:"report",component:Ut&&!Dt&&!Rt&&zt&&Object(u.b)(nt.a,{id:r,type:b,zaReportId:mt},"report")},{name:"vessay",component:!Rt&&Dt&&Jt&&Object(u.b)(st.a,{type:"article",id:r,useVessayV2:It,isAuthor:Dt},"vessay")},{name:"options",component:!Rt&&Ut&&(null==jt?void 0:jt((function(){return t.contentItem}),vt))},{name:"annotation",component:!Mt&&Object(u.b)(J.a,{annotationDetail:x},"annotation")}]})})):this.renderSuggestEdit(),Zt&&Object(u.b)(it.a,{content:s,type:"article",urlToken:String(r)}),this.disableAuth&&this.state.guideShown&&Object(u.b)(y.a,{redirectUrl:Lt,urlScheme:Object($.a)({type:"article",id:r}),buttons:[P.Wechat?{name:"wechat",text:"快速登录",fill:"#fff"}:"zhihu"],onClose:this.handleToggleGuide}),Object(u.b)(et.a,{parent:n,commentPattern:Bt,shown:Et,autoFocus:At,onClose:this.handleCommentsHide}),Object(u.b)(rt.a,{id:r,type:"article",shown:St,onClose:this.handleFavlistHide,zaEnabled:!0}),Xt&&Object(u.b)(W.a,{shown:Pt,html:Qt,sourceId:n.id,onClose:this.toggleCatalogModal,created:f,updated:m,author:i,zaContent:{type:"Answer",token:String(n.id)}})]})}}]),n}(d.Component);ht.contextTypes={currentUser:m.a.object,authRequired:m.a.func,isMobile:m.a.bool},ht.propTypes={preset:m.a.string,lessExperpt:m.a.bool,formatContent:m.a.func,renderOptions:m.a.func,zaInfos:m.a.object,trackPromotionClick:m.a.func,renderActionButtons:m.a.func},ht.defaultProps={preset:"primary",zaInfos:{},renderActionButtons:lt.b};e.a=Object(p.compose)(Object(w.b)((function(t){var e=t.article,n=t.trackCardShow,a=void 0===n||n,c=t.zaInfos,r=(c=void 0===c?{}:c).cardShow;return Object.assign(Object.assign({module:"PostItem",card:{has_image:Boolean(e.thumbnailExtraInfo&&"image"===e.thumbnailExtraInfo.type),has_video:Boolean(e.thumbnailExtraInfo&&"video"===e.thumbnailExtraInfo.type),content:{type:"Post",token:e.id.toString(),upvote_num:e.voteupCount,comment_num:e.commentCount,publish_timestamp:1e3*e.created,parent_token:e.column&&e.column.id,author_member_hash_id:e.author.id,video_id:e.thumbnailExtraInfo&&e.thumbnailExtraInfo.videoId}}},r&&{view:{id:r}}),{},{trackCardShow:a})})),Object(O.connect)((function(t,e){var n=e.article;return{ua:t.env.userAgent,ecommerce:Object(C.c)(t,{type:"article",urlToken:e.article.id}),shouldOia:Object(P.h)(t),isMobile:Object(P.d)(t),concernedUpvoters:Object(z.a)(t,{id:n.id}),useVessayV2:Object(P.a)(t,F.b)===F.a}}),{updateArticleVote:z.g,getTrackUrl:function(t){return{API:{types:E.GET_URL,endpoint:"/brand/track",method:"GET",fetchOptions:{credentials:"include",failsafe:!0,timeout:100},query:{target_url:"https://zhuanlan.zhihu.com/p/".concat(t)}},FAILSAFE:!0,UPDATE:{success:function(e){return{articles:Object(x.a)({},t,{trackUrl:e.data||[]})}}}}},loadArticleConcernedVoters:z.d}),v.withRouter,Z.c)(ht)}}]);
//# sourceMappingURL=main.topic-routes.8fed827f65514041bb89.js.map